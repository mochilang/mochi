#!/usr/bin/env escript
-module(main).

-export([main/1]).

% Generated by Mochi transpiler v0.10.33 (9f2177b9e) on 2025-07-21 18:06 +0700
main(_) ->
    Items = [#{"cat" => "a", "val" => 10, "flag" => true}, #{"cat" => "a", "val" => 5, "flag" => false}, #{"cat" => "b", "val" => 20, "flag" => true}],
    Result = lists:map(fun (T) ->     element(2, T)
 end, lists:sort(fun (A, B) ->     (element(1, A) =< element(1, B))
 end, lists:map(fun (P) ->     Key = element(1, P),
    Items2 = element(2, P),
    {Key, #{"cat" => Key, "share" => (lists:sum([(case (maps:get("flag", X) /= nil) of
        true ->         maps:get("val", X)
;
        _ ->         0

    end) || X <- Items2]) div lists:sum([maps:get("val", X) || X <- Items2]))}}
 end, maps:to_list(lists:foldl(fun (P, Acc) ->     K = element(1, P),
    V = element(2, P),
    maps:put(K, (maps:get(K, Acc, []) ++ [V]), Acc)
 end, #{}, [{maps:get("cat", I), I} || I <- Items]))))),
    io:format("~p~n", [Result])
.
