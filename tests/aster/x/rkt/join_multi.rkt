;; Generated by Mochi 0.10.34 on 2025-07-22 05:10 +0700


#lang racket


(require racket/list racket/string json)


(define customers
  (list
    (hash "id" 1 "name" "Alice")
    (hash "id" 2 "name" "Bob")))


(define orders
  (list
    (hash "id" 100 "customerId" 1)
    (hash "id" 101 "customerId" 2)))


(define items
  (list
    (hash "orderId" 100 "sku" "a")
    (hash "orderId" 101 "sku" "b")))


(define result
  (for*/list
    ((o orders)
      (c customers)
      (i items)) #:when
    (and
      (=
        (hash-ref o "customerId")
        (hash-ref c "id"))
      (=
        (hash-ref o "id")
        (hash-ref i "orderId")))
    (hash "name"
      (hash-ref c "name") "sku"
      (hash-ref i "sku"))))


(displayln "--- Multi Join ---")


(for
  ((r result))
  (displayln
    (string-join
      (filter
        (lambda
          (s)
          (not
            (string=? s "")))
        (list
          (format "~a"
            (hash-ref r "name"))
          (format "~a" "bought item")
          (format "~a"
            (hash-ref r "sku")))) " ")))
