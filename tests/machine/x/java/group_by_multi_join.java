// Generated by Mochi compiler v0.10.27 on 1970-01-01T00:00:00Z
// group_by_multi_join.mochi
import java.util.*;

class Nation {
    int id;
    String name;
    Nation(int id, String name) {
        this.id = id;
        this.name = name;
    }
    @Override public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Nation other)) return false;
        return Objects.equals(this.id, other.id) && Objects.equals(this.name, other.name);
    }
    @Override public int hashCode() {
        return Objects.hash(id, name);
    }
    int size() { return 2; }
}
class Supplier {
    int id;
    int nation;
    Supplier(int id, int nation) {
        this.id = id;
        this.nation = nation;
    }
    @Override public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Supplier other)) return false;
        return Objects.equals(this.id, other.id) && Objects.equals(this.nation, other.nation);
    }
    @Override public int hashCode() {
        return Objects.hash(id, nation);
    }
    int size() { return 2; }
}
class Partsupp {
    int part;
    int supplier;
    double cost;
    int qty;
    Partsupp(int part, int supplier, double cost, int qty) {
        this.part = part;
        this.supplier = supplier;
        this.cost = cost;
        this.qty = qty;
    }
    @Override public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Partsupp other)) return false;
        return Objects.equals(this.part, other.part) && Objects.equals(this.supplier, other.supplier) && Objects.equals(this.cost, other.cost) && Objects.equals(this.qty, other.qty);
    }
    @Override public int hashCode() {
        return Objects.hash(part, supplier, cost, qty);
    }
    int size() { return 4; }
}
class Filtered {
    int part;
    double value;
    Filtered(int part, double value) {
        this.part = part;
        this.value = value;
    }
    @Override public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Filtered other)) return false;
        return Objects.equals(this.part, other.part) && Objects.equals(this.value, other.value);
    }
    @Override public int hashCode() {
        return Objects.hash(part, value);
    }
    int size() { return 2; }
}
class Grouped {
    int part;
    double total;
    Grouped(int part, double total) {
        this.part = part;
        this.total = total;
    }
    @Override public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Grouped other)) return false;
        return Objects.equals(this.part, other.part) && Objects.equals(this.total, other.total);
    }
    @Override public int hashCode() {
        return Objects.hash(part, total);
    }
    int size() { return 2; }
}
public class GroupByMultiJoin {
    static class Group<K,V> implements Iterable<V> {
        K key;
        List<V> items;
        Group(K key, List<V> items) { this.key = key; this.items = items; }
        public Iterator<V> iterator() { return items.iterator(); }
        int size() { return items.size(); }
    }
    public static void main(String[] args) {
        List<Nation> nations = new ArrayList<>(Arrays.asList(new Nation(1, "A"), new Nation(2, "B")));
        List<Supplier> suppliers = new ArrayList<>(Arrays.asList(new Supplier(1, 1), new Supplier(2, 2)));
        List<Partsupp> partsupp = new ArrayList<>(Arrays.asList(new Partsupp(100, 1, 10.000000, 2), new Partsupp(100, 2, 20.000000, 1), new Partsupp(200, 1, 5.000000, 3)));
        List<Filtered> filtered = (new java.util.function.Supplier<List<Filtered>>(){public List<Filtered> get(){
    List<Filtered> res0 = new ArrayList<>();
    for (var ps : partsupp) {
        for (var s : suppliers) {
            if (!(s.id == ps.supplier)) continue;
            for (var n : nations) {
                if (!(n.id == s.nation)) continue;
                if (!(Objects.equals(n.name, "A"))) continue;
                res0.add(new Filtered(ps.part, ps.cost * ps.qty));
            }
        }
    }
    return res0;
}}).get();
        List<Grouped> grouped = (new java.util.function.Supplier<List<Grouped>>(){public List<Grouped> get(){
    List<Grouped> res1 = new ArrayList<>();
    Map<Integer,List<Filtered>> groups2 = new LinkedHashMap<>();
    for (var x : filtered) {
        var row3 = x;
        int key4 = x.part;
        List<Filtered> bucket5 = groups2.get(key4);
        if (bucket5 == null) { bucket5 = new ArrayList<>(); groups2.put(key4, bucket5); }
        bucket5.add(row3);
    }
    for (Map.Entry<Integer,List<Filtered>> __e : groups2.entrySet()) {
        int g_key = __e.getKey();
        Group<Integer,Filtered> g = new Group<>(g_key, __e.getValue());
        res1.add(new Grouped(g.key, (new java.util.function.Supplier<List<Double>>(){public List<Double> get(){
    List<Double> res6 = new ArrayList<>();
    for (var r : g) {
        res6.add(r.value);
    }
    return res6;
}}).get().stream().mapToDouble(n -> ((Number)n).doubleValue()).sum()));
    }
    return res1;
}}).get();
        System.out.println(grouped);
    }
}
