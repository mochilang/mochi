" Generated by Mochi compiler v0.10.26 on 2025-07-16T17:40:19Z
"
| big people |
people := {Dictionary from: {'name' -> 'Alice'. 'city' -> 'Paris'}. Dictionary from: {'name' -> 'Bob'. 'city' -> 'Hanoi'}. Dictionary from: {'name' -> 'Charlie'. 'city' -> 'Paris'}. Dictionary from: {'name' -> 'Diana'. 'city' -> 'Hanoi'}. Dictionary from: {'name' -> 'Eve'. 'city' -> 'Paris'}. Dictionary from: {'name' -> 'Frank'. 'city' -> 'Hanoi'}. Dictionary from: {'name' -> 'George'. 'city' -> 'Paris'}}.
big := [ | groups res |
  groups := Dictionary new.
  people do: [:p |
    | g k |
    k := p.city.
    g := groups at: k ifAbsentPut: [OrderedCollection new].
    g add: p.
  ]
  res := OrderedCollection new.
  groups keysAndValuesDo: [:k :items |
    | g |
    g := Dictionary from: {#key->k. #items->items}.
    (((g size) >= 4)) ifTrue: [
      res add: Dictionary from: {'city' -> g.key. 'num' -> (g size)}.
    ].
  ].
  res
] value.
json value: big.
