(define (map-get m k)
    (let ((p (assoc k m)))
        (if p (cdr p) '()))
)
(define (map-set m k v)
    (let ((p (assoc k m)))
        (if p
            (begin (set-cdr! p v) m)
            (cons (cons k v) m)))
)

(define customers (list (list (cons "id" 1) (cons "name" "Alice")) (list (cons "id" 2) (cons "name" "Bob")) (list (cons "id" 3) (cons "name" "Charlie")) (list (cons "id" 4) (cons "name" "Diana"))))
(define orders (list (list (cons "id" 100) (cons "customerId" 1) (cons "total" 250)) (list (cons "id" 101) (cons "customerId" 2) (cons "total" 125)) (list (cons "id" 102) (cons "customerId" 1) (cons "total" 300)) (list (cons "id" 103) (cons "customerId" 5) (cons "total" 80))))
(define result (let ((_res '()))
  (for-each (lambda (o)
    (for-each (lambda (c)
      (when (equal? (map-get o 'customerId) (map-get c 'id))
        (set! _res (append _res (list (list (cons "order" o) (cons "customer" c)))))
      )) (if (string? customers) (string->list customers) customers))
  ) (if (string? orders) (string->list orders) orders))
  _res))
(begin (display "--- Outer Join using syntax ---") (newline))
(let loop ((row_idx 0))
  (if (< row_idx (length result))
    (begin
      (let ((row (list-ref result row_idx)))
        (if (map-get row 'order)
          (begin
            (if (map-get row 'customer)
              (begin
                (begin (display "Order") (display " ") (display (map-get (map-get row 'order) 'id)) (display " ") (display "by") (display " ") (display (map-get (map-get row 'customer) 'name)) (display " ") (display "- $") (display " ") (display (map-get (map-get row 'order) 'total)) (newline))
              )
              (begin
                (begin (display "Order") (display " ") (display (map-get (map-get row 'order) 'id)) (display " ") (display "by") (display " ") (display "Unknown") (display " ") (display "- $") (display " ") (display (map-get (map-get row 'order) 'total)) (newline))
              )
            )
          )
          (begin
            (begin (display "Customer") (display " ") (display (map-get (map-get row 'customer) 'name)) (display " ") (display "has no orders") (newline))
          )
        )
      )
      (loop (+ row_idx 1))
    )
  '()
  )
)
