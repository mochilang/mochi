// Generated by Mochi compiler v0.10.25 on 2025-07-13T05:12:15Z
object group_by_multi_join {
  case class Filtered(part: Int, value: Double)
  case class Grouped(part: Any, total: Double)
  case class Grouped1(part: Int, total: Double)
  case class Nation(id: Int, name: String)
  case class Partsupp(part: Int, supplier: Int, cost: Double, qty: Int)
  case class Supplier(id: Int, nation: Int)

  case class _Group[K,T](key: K, items: List[T]) extends Iterable[T] { def iterator: Iterator[T] = items.iterator }

  def main(args: Array[String]): Unit = {
    val nations = List(Nation(id = 1, name = "A"), Nation(id = 2, name = "B"))
    val suppliers = List(Supplier(id = 1, nation = 1), Supplier(id = 2, nation = 2))
    val partsupp = List(Partsupp(part = 100, supplier = 1, cost = 10, qty = 2), Partsupp(part = 100, supplier = 2, cost = 20, qty = 1), Partsupp(part = 200, supplier = 1, cost = 5, qty = 3))
    val filtered = for { ps <- partsupp; s <- suppliers; if (s.id).asInstanceOf[Int] == ps.supplier; n <- nations; if (n.id).asInstanceOf[Int] == s.nation; if n.name == "A" } yield Filtered(part = ps.part, value = ps.cost * ps.qty)
    val grouped = ((for { x <- filtered } yield (x.part, x)).groupBy(_._1).map{ case(k,list) => _Group(k, list.map(_._2)) }.toList).map{ g => Grouped(part = g.key, total = (for { r <- g } yield r.value).sum) }.toList
    println(grouped)
  }
}
