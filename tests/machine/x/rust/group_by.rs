// Generated by Mochi compiler v0.10.26 on 1970-01-01T00:00:00Z
#[derive(Default, Debug, Clone, PartialEq, Eq, Hash, PartialOrd, Ord)]
struct People {
    name: &'static str,
    age: i32,
    city: &'static str,
}

#[derive(Default, Debug, Clone, PartialEq, Eq, Hash, PartialOrd, Ord)]
struct Group {
    key: &'static str,
    items: Vec<People>,
}

#[derive(Default, Debug, Clone, PartialEq, PartialOrd)]
struct Result {
    city: &'static str,
    count: i32,
    avg_age: f64,
}

fn avg<T>(v: &[T]) -> f64 where T: Into<f64> + Copy {
    let sum: f64 = v.iter().map(|&x| x.into()).sum();
    sum / v.len() as f64
}

fn main() {
    let people = vec![People { name: "Alice", age: 30, city: "Paris" }, People { name: "Bob", age: 15, city: "Hanoi" }, People { name: "Charlie", age: 65, city: "Paris" }, People { name: "Diana", age: 45, city: "Hanoi" }, People { name: "Eve", age: 70, city: "Paris" }, People { name: "Frank", age: 22, city: "Hanoi" }];
    let stats = { let mut tmp1 = std::collections::HashMap::new();for person in &people { let key = person.city; tmp1.entry(key).or_insert_with(Vec::new).push(person.clone()); } let mut tmp2 = Vec::<Group>::new(); for (k,v) in tmp1 { tmp2.push(Group { key: k, items: v }); } tmp2.sort_by(|a,b| a.key.partial_cmp(&b.key).unwrap()); let mut result = Vec::new(); for g in tmp2 { result.push(Result { city: g.key, count: g.clone().items.len() as i32, avg_age: avg(&{ let mut tmp3 = Vec::new();for p in &g.clone().items { tmp3.push(p.age); } tmp3 }) }); } result };
    println!("--- People grouped by city ---");
    for s in stats {
        println!("{} {} {} {} {}", s.city, ": count =", s.count, ", avg_age =", s.avg_age);
    }
}
