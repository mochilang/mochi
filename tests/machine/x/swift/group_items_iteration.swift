// Generated by Mochi compiler v0.10.27 on 2006-01-02T15:04:05Z
struct Data: Equatable {
    var tag: String
    var val: Int
}

struct Group: Equatable {
    var items: [Data]
    var key: String
}

var data = [Data(tag: "a", val: 1), Data(tag: "a", val: 2), Data(tag: "b", val: 3)]
var groups = { () -> [(key: String, items: [Data])] in
    var _groups: [String:[Data]] = [:]
    for d in data {
        let _k = d.tag
        _groups[_k, default: []].append(d)
    }
    var _tmp: [(key: String, items: [Data])] = []
    for (k, v) in _groups {
        _tmp.append((key: k, items: v))
    }
    return _tmp
}()
var tmp: [[String:Any]] = []
for g in groups {
    var total = 0
    for x in g.items {
        total = total + x.val
    }
    tmp = tmp + [["tag": g.key, "total": total]]
}
var result = tmp.map { r in (value: r, key: (r["tag"] as! String)) }.sorted { $0.key < $1.key }.map { $0.value }
print(result)
