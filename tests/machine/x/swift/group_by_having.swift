// Generated by Mochi compiler v0.10.26 on 2006-01-02T15:04:05Z
import Foundation

func _json(_ v: Any) {
    func _sort(_ x: Any) -> Any {
        if let a = x as? [Any] { return a.map { _sort($0) } }
        if let m = x as? [String:Any] {
            var out: [String:Any] = [:]
            for k in m.keys.sorted() { out[k] = _sort(m[k]!) }
            return out
        }
        return x
    }
    let obj = _sort(v)
    if JSONSerialization.isValidJSONObject(obj),
       let data = try? JSONSerialization.data(withJSONObject: obj, options: [.sortedKeys]),
       let s = String(data: data, encoding: .utf8) {
        print(s)
    } else {
        print(obj)
    }
}
struct People: Equatable {
    var city: String
    var name: String
}

var people = [People(city: "Paris", name: "Alice"), People(city: "Hanoi", name: "Bob"), People(city: "Paris", name: "Charlie"), People(city: "Hanoi", name: "Diana"), People(city: "Paris", name: "Eve"), People(city: "Hanoi", name: "Frank"), People(city: "Paris", name: "George")]
var big = { () -> [Any] in
    var _groups: [String:[People]] = [:]
    for p in people {
        let _k = p.city
        _groups[_k, default: []].append(p)
    }
    var _tmp: [(key: String, items: [People])] = []
    for (k, v) in _groups {
        _tmp.append((key: k, items: v))
    }
    _tmp = _tmp.filter { g in g.items.count >= 4 }
    return _tmp.map { g in ["city": g.key, "num": g.items.count] }
}()
_json(big)
