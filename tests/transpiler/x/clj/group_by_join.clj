;; Generated by Mochi v0.10.33 on 2025-07-21 16:22:56 GMT+7
(ns main)

(require 'clojure.set)

(defrecord Anon2 [id customerId])

(defrecord Anon1 [id name])

(def customers [{:id 1 :name "Alice"} {:id 2 :name "Bob"}])

(def orders [{:id 100 :customerId 1} {:id 101 :customerId 1} {:id 102 :customerId 2}])

(def stats (for [g (for [[k rows] (group-by :key (for [o orders c customers :when (= (:customerId o) (:id c)) :let [k (:name c)]] {:key k :item {:o o :c c}})) :let [g {:key k :items (map :item rows)}]] g)] {:name (:key g) :count (count (:items g))}))

(defn -main []
  (println "--- Orders per customer ---")
  (doseq [s stats] (println (:name s) "orders:" (:count s))))

(-main)
