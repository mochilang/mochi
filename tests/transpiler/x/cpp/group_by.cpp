// Generated by Mochi transpiler v0.10.32 on 2025-07-21 13:07:39 GMT+7
#include <iostream>
#include <string>
#include <vector>
#include <map>
#include <numeric>
#include <sstream>
#include <iomanip>
#include <unordered_map>

struct PeopleItem {
    std::string name;
    int age;
    std::string city;
};

struct GGroup {
    std::string key;
    std::vector<PeopleItem> items;
    auto begin() { return items.begin(); }
    auto end() { return items.end(); }
    size_t size() const { return items.size(); }
};

struct StatsItem {
    std::string city;
    int count;
    double avg_age;
};

std::vector<PeopleItem> people = std::vector{PeopleItem{.name = std::string("Alice"), .age = 30, .city = std::string("Paris")}, PeopleItem{.name = std::string("Bob"), .age = 15, .city = std::string("Hanoi")}, PeopleItem{.name = std::string("Charlie"), .age = 65, .city = std::string("Paris")}, PeopleItem{.name = std::string("Diana"), .age = 45, .city = std::string("Hanoi")}, PeopleItem{.name = std::string("Eve"), .age = 70, .city = std::string("Paris")}, PeopleItem{.name = std::string("Frank"), .age = 22, .city = std::string("Hanoi")}};
std::vector<StatsItem> stats = ([]{ std::vector<StatsItem> __items;
std::vector<GGroup> __groups;
std::unordered_map<std::string, size_t> __idx;
for (auto person : people) {
        auto __key = person.city;
        auto it = __idx.find(__key);
        if(it == __idx.end()) {
            GGroup __g{__key, {}};
            __g.items.push_back(person);
            __idx[__key] = __groups.size();
            __groups.push_back(__g);
        } else {
            __groups[it->second].items.push_back(person);
        }
}
for(auto &__g : __groups) {
    GGroup g = __g;
    __items.push_back(StatsItem{.city = g.key, .count = g.size(), .avg_age = ([&]{ auto tmp = ([&]{ std::vector<int> __items;
for (auto p : g) {
        __items.push_back(p.age);
}
return __items; }()); return tmp.empty() ? 0.0 : std::accumulate(tmp.begin(), tmp.end(), 0.0) / tmp.size(); }())});
}
return __items; }());

int main() {
    { std::ostringstream __ss; __ss << std::boolalpha << std::setprecision(17); if(false) __ss << " "; __ss << std::string("--- People grouped by city ---"); auto __line = __ss.str(); if(!__line.empty() && __line.back() == ' ') __line.pop_back(); std::cout << __line << std::endl; }
    for (auto s : stats) {
        { std::ostringstream __ss; __ss << std::boolalpha << std::setprecision(17); if(false) __ss << " "; __ss << s.city; if(true) __ss << " "; __ss << std::string(": count ="); if(true) __ss << " "; __ss << s.count; if(true) __ss << " "; __ss << std::string(", avg_age ="); if(true) __ss << " "; __ss << s.avg_age; auto __line = __ss.str(); if(!__line.empty() && __line.back() == ' ') __line.pop_back(); std::cout << __line << std::endl; }
    }
    return 0;
}
