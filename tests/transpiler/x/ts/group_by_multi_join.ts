// Generated by Mochi v0.10.32 on 2025-07-20 22:13:02 GMT+7

interface Nation { id: number; name: string };
interface Supplier { id: number; nation: number };
interface Partsupp { part: number; supplier: number; cost: number; qty: number };
interface Result { part: any; value: any };
const nations: Nation[] = [{id: 1, name: "A"}, {id: 2, name: "B"}];
const suppliers: Supplier[] = [{id: 1, nation: 1}, {id: 2, nation: 2}];
const partsupp: Partsupp[] = [{part: 100, supplier: 1, cost: 10, qty: 2}, {part: 100, supplier: 2, cost: 20, qty: 1}, {part: 200, supplier: 1, cost: 5, qty: 3}];
const filtered: Result[] = (() => {
  let _items = partsupp.map(v => [v])
  { const _joined = []
    const _arr = suppliers
    for (const _left of _items) {
      const [ps] = _left;
      let _m = false;
      for (let _ri=0; _ri < _arr.length; _ri++) {
        const s = _arr[_ri];
        if (!((s["id"] == ps["supplier"]))) continue;
        _m = true; _joined.push([..._left, s]) }
    }
    _items = _joined;
  }
  { const _joined = []
    const _arr = nations
    for (const _left of _items) {
      const [ps, s] = _left;
      let _m = false;
      for (let _ri=0; _ri < _arr.length; _ri++) {
        const n = _arr[_ri];
        if (!((n["id"] == s["nation"]))) continue;
        _m = true; _joined.push([..._left, n]) }
    }
    _items = _joined;
  }
  let _rows = _items
  _rows = _rows.filter(r => { const [ps, s, n] = r; return (n["name"] == "A") })
  const result: Result[] = []
  for (const r of _rows) { const [ps, s, n] = r; result.push({part: ps["part"], value: (ps["cost"] * ps["qty"])}) }
  return result
})();
const grouped: Result[] = (() => {
  const result: Result[] = []
  for (const x of filtered) {
    result.push({part: g["key"], total: (() => {
  const result = []
  for (const r of g) {
    result.push(r["value"])
  }
  const out = result
  return out
})().reduce((a, b) => a + b, 0)})
  }
  const out = result
  return out
})();
console.log(grouped.map((x) => JSON.stringify(x).replace(RegExp(":", "g"), ": ").replace(RegExp(",", "g"), ", ")).join(" "));
