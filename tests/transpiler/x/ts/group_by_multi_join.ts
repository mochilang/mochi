// Generated by Mochi v0.10.34 on 2025-07-21 23:57:16 GMT+7

export interface Nation { id: number; name: string }
export interface Supplier { id: number; nation: number }
export interface Partsupp { part: number; supplier: number; cost: number; qty: number }
export interface Result { part: any; value: any }
const nations: Nation[] = [{id: 1, name: "A"}, {id: 2, name: "B"}];
const suppliers: Supplier[] = [{id: 1, nation: 1}, {id: 2, nation: 2}];
const partsupp: Partsupp[] = [{part: 100, supplier: 1, cost: 10.0, qty: 2}, {part: 100, supplier: 2, cost: 20.0, qty: 1}, {part: 200, supplier: 1, cost: 5.0, qty: 3}];
const filtered: Result[] = (() => {
  let _items = partsupp.map(v => [v])
  { const _joined = []
    const _arr = suppliers
    for (const _left of _items) {
      const [ps] = _left;
      let _m = false;
      for (let _ri=0; _ri < _arr.length; _ri++) {
        const s = _arr[_ri];
        if (!((s["id"] == ps["supplier"]))) continue;
        _m = true; _joined.push([..._left, s]) }
    }
    _items = _joined;
  }
  { const _joined = []
    const _arr = nations
    for (const _left of _items) {
      const [ps, s] = _left;
      let _m = false;
      for (let _ri=0; _ri < _arr.length; _ri++) {
        const n = _arr[_ri];
        if (!((n["id"] == s["nation"]))) continue;
        _m = true; _joined.push([..._left, n]) }
    }
    _items = _joined;
  }
  let _rows = _items
  _rows = _rows.filter(r => { const [ps, s, n] = r; return (n["name"] == "A") })
  const result: Result[] = []
  for (const r of _rows) { const [ps, s, n] = r; result.push({part: ps["part"], value: (ps["cost"] * ps["qty"])}) }
  return result
})();
const grouped: Record<string, any>[] = (() => {
  const groups: Record<string, {key: any; items: any[]}> = {}
  const order: string[] = []
  for (const x of filtered) {
    const k = x["part"]
    const ks = JSON.stringify(k)
    let g = groups[ks]
    if (!g) { g = {key: k, items: []}; groups[ks] = g; order.push(ks) }
    g.items.push(x)
  }
  const result: Result[] = []
  for (const ks of order) {
    const g = groups[ks]
    result.push({part: g["key"], total: (() => {
  const result = []
  for (const r of g["items"]) {
    result.push(r["value"])
  }
  const out = result
  return out
})().reduce((a, b) => a + b, 0.0)})
  }
  return result
})();
console.log("[" + grouped.map(v => { if (typeof v === 'string') return '\'' + v + '\''; if (typeof v === 'number') return Number.isInteger(v) ? String(v) : String(v); if (typeof v === 'boolean') return v ? 'True' : 'False'; if (typeof v === 'object') { let s = JSON.stringify(v).replace(/"/g, '\'' ).replace(/:/g, ': ').replace(/,/g, ', '); s = s.replace(/('[^']*(?:id|key)'\s*: )(-?[0-9]+)\.0([,}])/g, '$1$2$3'); return s } return String(v); }).join(', ') + "]");
