// Generated by Mochi v0.10.32 on 2025-07-20 18:03:11 GMT+7

const customers: { id: number; name: string }[] = [{id: 1, name: "Alice"}, {id: 2, name: "Bob"}];
const orders: { id: number; customerId: number }[] = [{id: 100, customerId: 1}, {id: 101, customerId: 2}];
const items: { orderId: number; sku: string }[] = [{orderId: 100, sku: "a"}, {orderId: 101, sku: "b"}];
const result: Record<string, any>[] = (() => {
  const _join = (items, arr, on, left, right) => {
    const joined = [];
    if (right && left) {
      const matched = new Array(arr.length).fill(false);
      for (const leftIt of items) {
        let m = false;
        for (let ri=0; ri < arr.length; ri++) {
          const rightIt = arr[ri];
          let keep = true;
          if (on) keep = on(...leftIt, rightIt);
          if (!keep) continue;
          m = true; matched[ri] = true;
          joined.push([...leftIt, rightIt]);
        }
        if (!m) joined.push([...leftIt, null]);
      }
      for (let ri=0; ri < arr.length; ri++) {
        if (!matched[ri]) {
          const undef = Array(items[0]?.length || 0).fill(null);
          joined.push([...undef, arr[ri]]);
        }
      }
    } else if (right) {
      for (const rightIt of arr) {
        let m = false;
        for (const leftIt of items) {
          let keep = true;
          if (on) keep = on(...leftIt, rightIt);
          if (!keep) continue;
          m = true; joined.push([...leftIt, rightIt]);
        }
        if (!m) {
          const undef = Array(items[0]?.length || 0).fill(null);
          joined.push([...undef, rightIt]);
        }
      }
    } else {
      for (const leftIt of items) {
        let m = false;
        for (const rightIt of arr) {
          let keep = true;
          if (on) keep = on(...leftIt, rightIt);
          if (!keep) continue;
          m = true; joined.push([...leftIt, rightIt]);
        }
        if (left && !m) joined.push([...leftIt, null]);
      }
    }
    return joined;
  }
  let _items = orders.map(v => [v])
  _items = _join(_items, customers, (o, c) => ((o["customerId"] == c["id"])), false, false)
  _items = _join(_items, items, (o, c, i) => ((o["id"] == i["orderId"])), false, false)
  let _rows = _items
  const result = []
  for (const r of _rows) { const [o, c, i] = r; result.push({name: c["name"], sku: i["sku"]}) }
  return result
})();
console.log("--- Multi Join ---");
for (const r of result) {
  console.log(r["name"], "bought item", r["sku"]);
}
