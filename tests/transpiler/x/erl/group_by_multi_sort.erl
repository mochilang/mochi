#!/usr/bin/env escript
-module(main).
-export([main/1]).

% Generated by Mochi transpiler v0.10.34 (bd320f941) on 2025-07-22 08:53 +0700

main(_) ->
    Items = [#{"a" => "x", "b" => 1, "val" => 2}, #{"a" => "x", "b" => 2, "val" => 3}, #{"a" => "y", "b" => 1, "val" => 4}, #{"a" => "y", "b" => 2, "val" => 1}],
    Grouped = lists:map(fun(T) ->
        element(2, T) end, lists:sort(fun(A, B) ->
        (element(1, A) =< element(1, B)) end, lists:map(fun(P) ->
        Key = element(1, P),
        Items2 = element(2, P),
        {-lists:sum([maps:get("val", X) ||
        X <- Items2]), #{"a" => maps:get("a", Key), "b" => maps:get("b", Key), "total" => lists:sum([maps:get("val", X) ||
        X <- Items2])}} end, maps:to_list(lists:foldl(fun(P, Acc) ->
        K = element(1, P),
        V = element(2, P),
        maps:put(K, (maps:get(K, Acc, []) ++ [V]), Acc) end, #{}, [{#{"a" => maps:get("a", I), "b" => maps:get("b", I)}, I} ||
        I <- Items]))))),
    io:format("~p~n", [Grouped]).
