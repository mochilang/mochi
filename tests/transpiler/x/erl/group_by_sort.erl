#!/usr/bin/env escript
-module(main).
-export([main/1]).

% Generated by Mochi transpiler v0.10.32 (b88d08eca) on 2025-07-21 13:50 +0700

main(_) ->
    Items = [#{"cat" => "a", "val" => 3}, #{"cat" => "a", "val" => 1}, #{"cat" => "b", "val" => 5}, #{"cat" => "b", "val" => 2}],
    Grouped = lists:map(fun(T) ->
    try
        element(2, T)
    catch
        {return, V} -> V
    end end, lists:sort(fun(A, B) ->
    try
        (element(1, A) =< element(1, B))
    catch
        {return, V} -> V
    end end, lists:map(fun(P) ->
    try
        Key = element(1, P),
        Items2 = element(2, P),
        {-lists:sum([maps:get("val", X) || X <- Items2]), #{"cat" => Key, "total" => lists:sum([maps:get("val", X) || X <- Items2])}}
    catch
        {return, V} -> V
    end end, maps:to_list(lists:foldl(fun(X, Acc) ->
    try
        maps:put(maps:get("cat", X), (maps:get(maps:get("cat", X), Acc, []) ++ [X]), Acc)
    catch
        {return, V} -> V
    end end, #{}, Items))))),
    io:format("~p~n", [Grouped]).
