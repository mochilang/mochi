#!/usr/bin/env escript
-module(main).
-export([main/1]).

% Generated by Mochi transpiler v0.10.34 (121bd3e1b) on 2025-07-22 05:10 +0700

main(_) ->
    Data = [#{"tag" => "a", "val" => 1}, #{"tag" => "a", "val" => 2}, #{"tag" => "b", "val" => 3}],
    Groups = lists:map(fun(P) ->
        Key = element(1, P),
        Items = element(2, P),
        #{"key" => Key, "items" => Items} end, maps:to_list(lists:foldl(fun(P, Acc) ->
        K = element(1, P),
        V = element(2, P),
        maps:put(K, (maps:get(K, Acc, []) ++ [V]), Acc) end, #{}, [{maps:get("tag", D), D} ||
        D <- Data]))),
    Tmp = [],
    lists:foreach(fun(G) ->
    Total = 0,
    lists:foreach(fun(X) ->
    Total2 = (Total + maps:get("val", X))
end, maps:get("items", G)),
    Tmp2 = lists:append(Tmp, [#{"tag" => maps:get("key", G), "total" => Total}])
end, Groups),
    Result = lists:map(fun({_,V}) -> V end, lists:sort(fun({K1,_},{K2,_}) -> K1 =< K2 end, [{maps:get("tag", R), R} ||
        R <- Tmp])),
    io:format("~p~n", [Result]).
