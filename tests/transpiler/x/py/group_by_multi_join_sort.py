# Code generated by Mochi v0.10.33 - DO NOT EDIT
from collections import defaultdict

nation = [{"n_nationkey": 1, "n_name": "BRAZIL"}]
customer = [{"c_custkey": 1, "c_name": "Alice", "c_acctbal": 100.0, "c_nationkey": 1, "c_address": "123 St", "c_phone": "123-456", "c_comment": "Loyal"}]
orders = [{"o_orderkey": 1000, "o_custkey": 1, "o_orderdate": "1993-10-15"}, {"o_orderkey": 2000, "o_custkey": 1, "o_orderdate": "1994-01-02"}]
lineitem = [{"l_orderkey": 1000, "l_returnflag": "R", "l_extendedprice": 1000.0, "l_discount": 0.1}, {"l_orderkey": 2000, "l_returnflag": "N", "l_extendedprice": 500.0, "l_discount": 0.0}]
start_date = "1993-10-01"
end_date = "1994-01-01"
_result_groups = defaultdict(list)
for c in customer:
    for o in [o for o in orders if o["o_custkey"] == c["c_custkey"]]:
        for l in [l for l in lineitem if l["l_orderkey"] == o["o_orderkey"]]:
            for n in [n for n in nation if n["n_nationkey"] == c["c_nationkey"]]:
                if o["o_orderdate"] >= start_date and o["o_orderdate"] < end_date and l["l_returnflag"] == "R":
                    _result_groups[tuple([c["c_custkey"], c["c_name"], c["c_acctbal"], c["c_address"], c["c_phone"], c["c_comment"], n["n_name"]])].append({"c": c, "o": o, "l": l, "n": n})
result = []
for _p in _result_groups.items():
    g = {"key": {"c_custkey": _p[0][0], "c_name": _p[0][1], "c_acctbal": _p[0][2], "c_address": _p[0][3], "c_phone": _p[0][4], "c_comment": _p[0][5], "n_name": _p[0][6]}, "items": _p[1]}
    result.append({"c_custkey": g["key"]["c_custkey"], "c_name": g["key"]["c_name"], "revenue": sum([x["l"]["l_extendedprice"] * (1 - x["l"]["l_discount"]) for x in g["items"]]), "c_acctbal": g["key"]["c_acctbal"], "n_name": g["key"]["n_name"], "c_address": g["key"]["c_address"], "c_phone": g["key"]["c_phone"], "c_comment": g["key"]["c_comment"]})
print(result)
