# Code generated by Mochi v0.10.33 - DO NOT EDIT
from collections import defaultdict

nations = [{"id": 1, "name": "A"}, {"id": 2, "name": "B"}]
suppliers = [{"id": 1, "nation": 1}, {"id": 2, "nation": 2}]
partsupp = [{"part": 100, "supplier": 1, "cost": 10.0, "qty": 2}, {"part": 100, "supplier": 2, "cost": 20.0, "qty": 1}, {"part": 200, "supplier": 1, "cost": 5.0, "qty": 3}]
filtered = [{"part": ps["part"], "value": ps["cost"] * ps["qty"]} for ps in partsupp for s in suppliers for n in nations if s["id"] == ps["supplier"] and n["id"] == s["nation"] and n["name"] == "A"]
_grouped_groups = defaultdict(list)
for x in filtered:
    _grouped_groups[x["part"]].append(x)
grouped = []
for _p in _grouped_groups.items():
    g = {"key": _p[0], "items": _p[1]}
    grouped.append({"part": g["key"], "total": sum([r["value"] for r in g["items"]])})
print(grouped)
