# Generated by Mochi transpiler on 2025-07-21 19:10 +0700
people = [%{name: "Alice", age: 30, city: "Paris"}, %{name: "Bob", age: 15, city: "Hanoi"}, %{name: "Charlie", age: 65, city: "Paris"}, %{name: "Diana", age: 45, city: "Hanoi"}, %{name: "Eve", age: 70, city: "Paris"}, %{name: "Frank", age: 22, city: "Hanoi"}]
stats = Enum.map(Enum.group_by(people, fn person -> person.city end), fn {key, items} ->
  g = %{key: key, items: items}
  %{city: g.key, count: Enum.count(g.items), avg_age: (if rem(Enum.sum(for p <- g.items do
  p.age
end), Enum.count(for p <- g.items do
  p.age
end)) == 0, do: div(Enum.sum(for p <- g.items do
  p.age
end), Enum.count(for p <- g.items do
  p.age
end)), else: Enum.sum(for p <- g.items do
  p.age
end) / Enum.count(for p <- g.items do
  p.age
end))}
end)
IO.puts("--- People grouped by city ---")
Enum.each(stats, fn s ->
  IO.puts("#{Kernel.inspect(s.city)} : count = #{Kernel.inspect(s.count)} , avg_age = #{Kernel.inspect(s.avg_age)}")
end)
