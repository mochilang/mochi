# Code generated by Mochi transpiler 2025-07-22 06:19 +0700
items = [%{a: "x", b: 1, val: 2}, %{a: "x", b: 2, val: 3}, %{a: "y", b: 1, val: 4}, %{a: "y", b: 2, val: 1}]
grouped = Enum.group_by(items, fn i -> %{a: i.a, b: i.b} end)
  |> Enum.map(fn {key, items} -> %{key: key, items: items} end)
  |> Enum.sort_by(fn g -> -Enum.sum(for x <- g.items do
  x.val
end) end)
  |> Enum.map(fn g ->
    %{a: g.key.a, b: g.key.b, total: Enum.sum(for x <- g.items do
  x.val
end)}
  end)
IO.inspect(grouped)
