# Generated by Mochi transpiler on 2025-07-21 19:10 +0700
data = [%{tag: "a", val: 1}, %{tag: "a", val: 2}, %{tag: "b", val: 3}]
groups = Enum.map(Enum.group_by(data, fn d -> d.tag end), fn {key, items} ->
  g = %{key: key, items: items}
  g
end)
tmp = []
Enum.each(groups, fn g ->
  total = 0
  Enum.each(g.items, fn x ->
    total = total + x.val
  end)
  tmp = (tmp ++ [%{tag: g.key, total: total}])
end)
result = Enum.map(Enum.sort_by(for r <- tmp do
  %{
    k: r.tag,
    v: r
  }
end, fn x ->
  x.k
end), fn x ->
  x.v
end)
IO.inspect(result)
