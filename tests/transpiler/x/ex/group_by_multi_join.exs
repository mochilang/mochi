# Generated by Mochi transpiler on 2025-07-21 19:10 +0700
nations = [%{id: 1, name: "A"}, %{id: 2, name: "B"}]
suppliers = [%{id: 1, nation: 1}, %{id: 2, nation: 2}]
partsupp = [%{part: 100, supplier: 1, cost: 10, qty: 2}, %{part: 100, supplier: 2, cost: 20, qty: 1}, %{part: 200, supplier: 1, cost: 5, qty: 3}]
filtered = for ps <- partsupp, s <- suppliers, n <- nations, n.name == "A" do
  %{
    part: ps.part,
    value: ps.cost * ps.qty
  }
end
grouped = Enum.map(Enum.group_by(filtered, fn x -> x.part end), fn {key, items} ->
  g = %{key: key, items: items}
  %{part: g.key, total: Enum.sum(for r <- g.items do
  r.value
end)}
end)
IO.inspect(grouped)
