# Generated by Mochi transpiler on 2025-07-21 13:50 +0700
items = [%{cat: "a", val: 3}, %{cat: "a", val: 1}, %{cat: "b", val: 5}, %{cat: "b", val: 2}]
grouped = Enum.group_by(items, fn i -> i.cat end) |> Enum.map(fn {key, items} -> %{key: key, items: items} end) |> Enum.sort_by(fn g -> -Enum.sum(for x <- g.items do
  x.val
end) end) |> Enum.map(fn g ->
  g = g
  %{cat: g.key, total: Enum.sum(for x <- g.items do
  x.val
end)}
end)
IO.puts(Kernel.inspect(grouped))
