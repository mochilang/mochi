# Generated by Mochi transpiler on 2025-07-21 19:10 +0700
items = [%{cat: "a", val: 10, flag: true}, %{cat: "a", val: 5, flag: false}, %{cat: "b", val: 20, flag: true}]
result = Enum.group_by(items, fn i -> i.cat end) |> Enum.map(fn {key, items} -> %{key: key, items: items} end) |> Enum.sort_by(fn g -> g.key end) |> Enum.map(fn g ->
  g = g
  %{cat: g.key, share: Enum.sum(for x <- g.items do
  if x.flag, do: x.val, else: 0
end) / Enum.sum(for x <- g.items do
  x.val
end)}
end)
IO.inspect(result)
