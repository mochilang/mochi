;; Generated by Mochi 0.10.34 on 2025-07-21 22:29 +0700
#lang racket
(require racket/list racket/string json)

(define customers (list (hash "id" 1 "name" "Alice") (hash "id" 2 "name" "Bob") (hash "id" 3 "name" "Charlie")))
(define orders (list (hash "id" 100 "customerId" 1) (hash "id" 101 "customerId" 1) (hash "id" 102 "customerId" 2)))
(define stats (let ([_groups (make-hash)] [_res '()])
  (for ([c customers])
    (let ([matched #f])
      (for ([o orders])
        (when (= (hash-ref o "customerId") (hash-ref c "id"))
          (set! matched #t)
          (let* ([_key (hash-ref c "name")][_g (hash-ref _groups _key (lambda () (let ([h (make-hash)]) (hash-set! h "key" _key) (hash-set! h "items" '()) (hash-set! _groups _key h) h)))])
            (hash-set! _g "items" (append (hash-ref _g "items") (list (hash "c" c "o" o))))
        )
      )
      (when (not matched)
        (let* ([o #f][_key (hash-ref c "name")][_g (hash-ref _groups _key (lambda () (let ([h (make-hash)]) (hash-set! h "key" _key) (hash-set! h "items" '()) (hash-set! _groups _key h) h)))])
          (hash-set! _g "items" (append (hash-ref _g "items") (list (hash "c" c "o" o))))
        )
      )
    ))
  )
  (for ([g (hash-values _groups)])
    (let ([val (hash "name" (hash-ref g "key") "count" (cond [(string? (let ([_res '()])
  (for ([r (hash-ref g "items")])
    (when (hash-ref r "o")
    (set! _res (append _res (list r)))
    )
  )
  _res)) (string-length (let ([_res '()])
  (for ([r (hash-ref g "items")])
    (when (hash-ref r "o")
    (set! _res (append _res (list r)))
    )
  )
  _res))] [(hash? (let ([_res '()])
  (for ([r (hash-ref g "items")])
    (when (hash-ref r "o")
    (set! _res (append _res (list r)))
    )
  )
  _res)) (hash-count (let ([_res '()])
  (for ([r (hash-ref g "items")])
    (when (hash-ref r "o")
    (set! _res (append _res (list r)))
    )
  )
  _res))] [else (length (let ([_res '()])
  (for ([r (hash-ref g "items")])
    (when (hash-ref r "o")
    (set! _res (append _res (list r)))
    )
  )
  _res))]))])
      (set! _res (append _res (list val))))
  )
  _res))
(displayln "--- Group Left Join ---")
(for ([s stats])
(displayln (string-join (filter (lambda (s) (not (string=? s ""))) (list (format "~a" (hash-ref s "name")) (format "~a" "orders:") (format "~a" (hash-ref s "count")))) " "))
)
