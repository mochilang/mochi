// Generated by Mochi transpiler v0.10.33 on 2025-07-21 19:30:52 GMT+7
import Foundation

let nations = [["id": 1, "name": "A"], ["id": 2, "name": "B"]]
let suppliers = [["id": 1, "nation": 1], ["id": 2, "nation": 2]]
let partsupp = [["part": 100, "supplier": 1, "cost": 10, "qty": 2], ["part": 100, "supplier": 2, "cost": 20, "qty": 1], ["part": 200, "supplier": 1, "cost": 5, "qty": 3]]
let filtered = ({ var _res: [[String: Any]] = []
for ps in partsupp {
    for s in suppliers {
        if ((s["id"]! as! Int) == (ps["supplier"]! as! Int)) {
            for n in nations {
                if ((n["id"]! as! Int) == (s["nation"]! as! Int)) {
                    if ((n["name"]! as! String) == "A") {
                        _res.append(["part": ps["part"]!, "value": (ps["cost"]! * ps["qty"]!)])
                    }
                }
            }
        }
    }
}
return _res })()
let grouped = ({ var _groups: [String: [String: Any]] = [:]
var _res: [[String: Any]] = []
for x in filtered {
    let _key = x["part"]!
    let _ks = String(describing: _key)
    var _g = _groups[_ks] ?? ["key": _key, "items": []]
    var _item: [String: Any] = ["__join__": true]
    _item["x"] = x
    _g["items"] = (_g["items"] as! [Any]) + [_item]
    _groups[_ks] = _g
}
var _list = Array(_groups.values)
_list.sort { a, b in String(describing: a["key"]) < String(describing: b["key"]) }
for g in _list {
    _res.append(["part": g["key"]!, "total": ((({ var _res: [Any] = []
    for r in g["items"] as! [[String: Any]] {
        _res.append(r["value"]!)
    }
    return _res })().reduce(0,+)) as! Double)])
}
return _res })()
print(String(describing: grouped))
