// Generated by Mochi
using System;
using System.Collections.Generic;
using System.Linq;

class Group<K,T> : IEnumerable<T> {
    public K key;
    List<T> items;
    public Group(K k, IEnumerable<T> it) { key = k; items = new List<T>(it); }
    public IEnumerator<T> GetEnumerator() => items.GetEnumerator();
    System.Collections.IEnumerator IEnumerable.GetEnumerator() => items.GetEnumerator();
}

class Program {
    static Dictionary<string, object>[] items = new[]{new Dictionary<string, object>{{"cat", "a"}, {"val", 3}}, new Dictionary<string, object>{{"cat", "a"}, {"val", 1}}, new Dictionary<string, object>{{"cat", "b"}, {"val", 5}}, new Dictionary<string, object>{{"cat", "b"}, {"val", 2}}};
    static Dictionary<string, object>[] grouped = (from i in items group i by ((dynamic)(i["cat"])) into gTmp let g = new Group<object, Dictionary<string, object>>(gTmp.Key, gTmp) orderby ((from x in g select ((dynamic)(x["val"]))).ToArray().Sum()) descending select new Dictionary<string, object>{{"cat", g.key}, {"total", ((from x in g select ((dynamic)(x["val"]))).ToArray().Sum())}}).ToArray();
    static void Main() {
        Console.WriteLine(grouped);
    }
}
