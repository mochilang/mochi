# Generated by Mochi transpiler v0.10.34 on 2025-07-21 21:57 +0700
require 'json'
People = Struct.new(:name, :city, keyword_init: true)
people = [People.new(name: "Alice", city: "Paris"), People.new(name: "Bob", city: "Hanoi"), People.new(name: "Charlie", city: "Paris"), People.new(name: "Diana", city: "Hanoi"), People.new(name: "Eve", city: "Paris"), People.new(name: "Frank", city: "Hanoi"), People.new(name: "George", city: "Paris")]
Big = Struct.new(:city, :num, keyword_init: true)
big = (begin
  groups = {}
  people.each do |p|
    k = p.city
    groups[k] ||= []
    groups[k] << {"p" => p}
  end
  pairs = groups.to_a
  result = []
  pairs.each do |k, items|
    g = { "key" => k, "items" => items }
    if g.length >= 4
      result << Big.new(city: g["key"], num: g.length)
    end
  end
  result
end)
puts(JSON.pretty_generate(big))
