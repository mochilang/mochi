# Generated by Mochi transpiler v0.10.34 on 2025-07-21 22:29 +0700
Data = Struct.new(:tag, :val, keyword_init: true)
data = [Data.new(tag: "a", val: 1), Data.new(tag: "a", val: 2), Data.new(tag: "b", val: 3)]
groups = (begin
  groups = {}
  data.each do |d|
    k = d.tag
    groups[k] ||= []
    groups[k] << {"d" => d}
  end
  pairs = groups.to_a
  result = []
  pairs.each do |k, items|
    g = { "key" => k, "items" => items }
    result << g
  end
  result
end)
tmp = []
groups.each do |g|
  total = 0
  g["items"].each do |x|
    total = total + x["val"]
  end
  tmp = tmp + [{"tag" => g["key"], "total" => total}]
end
result = (begin
  _res = []
  tmp.each do |r|
    _res << r
  end
  _res = _res.each_with_index.sort_by do |r, __i|
    [r["tag"], __i]
  end.map{ |x, _| x }
_res
end)
puts(("[" + (result).map{ |x| x.is_a?(String) ? '\'' + x + '\'' : x.to_s }.join(', ') + "]"))
