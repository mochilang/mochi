// Generated by Mochi compiler v0.10.26 on 2006-01-02T15:04:05Z
open System

let dim: int = 16
let newPile (d) =
    let mutable b: obj = [||]
    let mutable y: int = 0
    while y < d do
        let mutable row: obj = [||]
        let mutable x: int = 0
        while x < d do
            row <- row @ [0]
            x <- x + 1
        b <- b @ [row]
        y <- y + 1
    b
let handlePile (pile) (x) (y) =
    if pile.[y].[x] >= 4 then
        pile.[y].[x] <- pile.[y].[x] - 4
        if y > 0 then
            pile.[y - 1].[x] <- pile.[y - 1].[x] + 1
            if pile.[y - 1].[x] >= 4 then
                pile <- handlePile pile x y - 1
        if x > 0 then
            pile.[y].[x - 1] <- pile.[y].[x - 1] + 1
            if pile.[y].[x - 1] >= 4 then
                pile <- handlePile pile x - 1 y
        if y < dim - 1 then
            pile.[y + 1].[x] <- pile.[y + 1].[x] + 1
            if pile.[y + 1].[x] >= 4 then
                pile <- handlePile pile x y + 1
        if x < dim - 1 then
            pile.[y].[x + 1] <- pile.[y].[x + 1] + 1
            if pile.[y].[x + 1] >= 4 then
                pile <- handlePile pile x + 1 y
        pile <- handlePile pile x y
    pile
let drawPile (pile) (d) =
    let chars: string list = [" "; "░"; "▓"; "█"]
    let mutable row: int = 0
    while row < d do
        let mutable line: string = ""
        let mutable col: int = 0
        while col < d do
            let mutable v: obj = pile.[row].[col]
            if v > 3 then
                v <- 3
            line <- line + chars.[v]
            col <- col + 1
        printfn "%s" line
        row <- row + 1
let main () =
    let mutable pile: obj = newPile 16
    let hdim: int = 7
    pile.[hdim].[hdim] <- 16
    pile <- handlePile pile hdim hdim
    printfn "%A" (drawPile pile 16)
printfn "%A" (main())
