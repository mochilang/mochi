// Generated by Mochi compiler v0.10.26 on 2006-01-02T15:04:05Z
open System

exception Break
exception Continue

let listStr (xs) =
    let mutable s: string = "["
    let mutable i: int = 0
    while i < List.length xs do
        s <- s + string xs.[i]
        if i < List.length xs - 1 then
            s <- s + " "
        i <- i + 1
    s <- s + "]"
    s
let llStr (lst) =
    let mutable s: string = "["
    let mutable i: int = 0
    while i < List.length lst do
        s <- s + listStr lst.[i]
        if i < List.length lst - 1 then
            s <- s + " "
        i <- i + 1
    s <- s + "]"
    s
let cartN (lists) =
    if lists = () then
        []
    let a: obj = lists
    if List.length a = 0 then
        [[]]
    let mutable c: int = 1
    for xs in a do
        c <- c * List.length xs
    if c = 0 then
        []
    let mutable res: obj = [||]
    let mutable idx: obj = [||]
    for _ in a do
        idx <- idx @ [0]
    let mutable n: obj = List.length a
    let mutable count: int = 0
    try
        while count < c do
            try
                let mutable row: obj = [||]
                let mutable j: int = 0
                while j < n do
                    row <- row @ [a.[j].[idx.[j]]]
                    j <- j + 1
                res <- res @ [row]
                let mutable k: obj = n - 1
                try
                    while k >= 0 do
                        try
                            idx.[k] <- idx.[k] + 1
                            if idx.[k] < List.length a.[k] then
                                raise Break
                            idx.[k] <- 0
                            k <- k - 1
                        with Continue -> ()
                with Break -> ()
                count <- count + 1
            with Continue -> ()
    with Break -> ()
    res
let main () =
    printfn "%A" (llStr cartN [[1; 2]; [3; 4]])
    printfn "%A" (llStr cartN [[3; 4]; [1; 2]])
    printfn "%A" (llStr cartN [[1; 2]; []])
    printfn "%A" (llStr cartN [[]; [1; 2]])
    printfn "%s" ""
    printfn "%s" "["
    for p in cartN [[1776; 1789]; [7; 12]; [4; 14; 23]; [0; 1]] do
        printfn "%s" (" " + listStr p)
    printfn "%s" "]"
    printfn "%A" (llStr cartN [[1; 2; 3]; [30]; [500; 100]])
    printfn "%A" (llStr cartN [[1; 2; 3]; []; [500; 100]])
    printfn "%s" ""
    printfn "%A" (llStr cartN ())
    printfn "%A" (llStr cartN [])
printfn "%A" (main())
