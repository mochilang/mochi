let _inputData: string[] | null = null;
function _input(): string {
  if (_inputData === null) {
    const fs = require("fs");
    const d = fs.readFileSync(0, "utf8");
    _inputData = d.split(/\r?\n/);
  }
  const v = _inputData.shift();
  return v === undefined ? "" : v;
}

var _nowSeed = 0;
var _nowSeeded = false;
{
  const s =
    typeof Deno !== "undefined"
      ? Deno.env.get("MOCHI_NOW_SEED")
      : process.env.MOCHI_NOW_SEED || "";
  if (s) {
    const v = parseInt(s, 10);
    if (!isNaN(v)) {
      _nowSeed = v;
      _nowSeeded = true;
    }
  }
}
function _now(): number {
  if (_nowSeeded) {
    _nowSeed = (_nowSeed * 1664525 + 1013904223) % 2147483647;
    return _nowSeed;
  }
  return Date.now() * 1000;
}

// Generated by Mochi compiler v0.10.30 on 2025-07-18T18:07:42Z
// Source: /workspace/mochi/tests/rosetta/x/Mochi/21-game.mochi

function parseIntStr(str: string): number {
  var i = 0;
  var neg = false;
  if (str.length > 0 && str.slice(0, 1) == "-") {
    neg = true;
    i = 1;
  }
  var n = 0;
  let digits = {
    _: 0,
    _: 1,
    _: 2,
    _: 3,
    _: 4,
    _: 5,
    _: 6,
    _: 7,
    _: 8,
    _: 9,
  };
  while (i < str.length) {
    n = n * 10 + digits[str.slice(i, i + 1)];
    i = i + 1;
  }
  if (neg) {
    n = -n;
  }
  return n;
}

function main(): void {
  var total = 0;
  var computer = _now() % 2 == 0;
  console.log("Enter q to quit at any time\n");
  if (computer) {
    console.log("The computer will choose first");
  } else {
    console.log("You will choose first");
  }
  console.log("\n\nRunning total is now 0\n\n");
  var round = 1;
  var done = false;
  while (!done) {
    console.log(`ROUND ${String(round)}:

`);
    var i = 0;
    while (i < 2 && !done) {
      if (computer) {
        var choice = 0;
        if (total < 18) {
          choice = (_now() % 3) + 1;
        } else {
          choice = 21 - total;
        }
        total = total + choice;
        console.log(`The computer chooses ${String(choice)}`);
        console.log(`Running total is now ${String(total)}`);
        if (total == 21) {
          console.log("\nSo, commiserations, the computer has won!");
          done = true;
        }
      } else {
        while (true) {
          console.log("Your choice 1 to 3 : ");
          let line = _input();
          if (line == "q" || line == "Q") {
            console.log("OK, quitting the game");
            done = true;
            break;
          }
          var num = parseIntStr(line);
          if (num < 1 || num > 3) {
            if (total + num > 21) {
              console.log("Too big, try again");
            } else {
              console.log("Out of range, try again");
            }
            continue;
          }
          if (total + num > 21) {
            console.log("Too big, try again");
            continue;
          }
          total = total + num;
          console.log(`Running total is now ${String(total)}`);
          break;
        }
        if (total == 21) {
          console.log("\nSo, congratulations, you've won!");
          done = true;
        }
      }
      console.log("\n");
      computer = !computer;
      i = i + 1;
    }
    round = round + 1;
  }
}

main();
