// Generated by Mochi compiler v0.10.26 on 2025-07-16T09:12:37Z
// Source: /workspace/mochi/tests/rosetta/x/Mochi/averages-simple-moving-average.mochi

function indexOf(s: string, ch: string): number {
  var i = 0;
  while ((i < s.length)) {
    if ((s.substring(i, i + (i + 1)) == ch)) {
      return i;
    }
    i = i + 1;
  }
  return (-1);
}

function fmt3(x: number): string {
  var y = ((x * 1000) + 0.5) / 1000;
  var s = String(y);
  var dot = indexOf(s, ".");
  if ((dot == (0 - 1))) {
    s = `${s}.000`;
  } else {
    var decs = (s.length - dot) - 1;
    if ((decs > 3)) {
      s = s.substring(0, (0) + (dot + 4));
    } else {
      while ((decs < 3)) {
        s = `${s}0`;
        decs = decs + 1;
      }
    }
  }
  return s;
}

function pad(s: string, width: number): string {
  var out = s;
  while ((out.length < width)) {
    out = ` ${out}`;
  }
  return out;
}

function smaSeries(xs: number[], period: number): number[] {
  var res: number[] = [];
  var sum = 0;
  var i = 0;
  while ((i < xs.length)) {
    sum = sum + xs[i];
    if ((i >= period)) {
      sum = sum - xs[i - period];
    }
    var denom = i + 1;
    if ((denom > period)) {
      denom = period;
    }
    res = [...res, sum / denom];
    i = i + 1;
  }
  return res;
}

function main(): void {
  var xs = [
    1,
    2,
    3,
    4,
    5,
    5,
    4,
    3,
    2,
    1,
  ];
  var sma3 = smaSeries(xs, 3);
  var sma5 = smaSeries(xs, 5);
  console.log("x       sma3   sma5");
  var i = 0;
  while ((i < xs.length)) {
    let line = `${pad(fmt3(xs[i]), 5)}  ${pad(fmt3(sma3[i]), 5)}  ${
      pad(fmt3(sma5[i]), 5)
    }`;
    console.log(line);
    i = i + 1;
  }
}

function main(): void {
  main();
}
main();
