//go:build ignore

// Generated by Mochi compiler v0.10.28 on 2006-01-02T15:04:05Z

package main

import (
	"fmt"
	"strings"
)

type v map[string]any

// line 1
func image() [][]int {
	return [][]int{[]int{0, 0, 10000}, []int{65535, 65535, 65535}, []int{65535, 65535, 65535}}
}

// line 5
func histogram(g [][]int, bins int) []int {
	if bins <= 0 {
		bins = len(any(g[0]))
	}
	var h []int = []int{}
	i := 0
	for i < bins {
		h = append(_toAnySlice(h), any(0))
		i = (i + 1)
	}
	y := 0
	for y < len(any(g)) {
		row := g[y]
		x := 0
		for x < len(any(row)) {
			p := row[x]
			idx := int((float64((p * (bins - 1))) / float64(65535)))
			h[idx] = (h[idx] + 1)
			x = (x + 1)
		}
		y = (y + 1)
	}
	return h
}

// line 28
func medianThreshold(h []int) int {
	lb := 0
	ub := (len(any(h)) - 1)
	lSum := 0
	uSum := 0
	for lb <= ub {
		if (lSum + h[lb]) < (uSum + h[ub]) {
			lSum = (lSum + h[lb])
			lb = (lb + 1)
		} else {
			uSum = (uSum + h[ub])
			ub = (ub - 1)
		}
	}
	return int((float64((ub * 65535)) / float64(len(any(h)))))
}

// line 45
func threshold(g [][]int, t int) [][]int {
	var out [][]int = [][]int{}
	y := 0
	for y < len(any(g)) {
		row := g[y]
		var newRow []int = []int{}
		x := 0
		for x < len(any(row)) {
			if row[x] < t {
				newRow = append(_toAnySlice(newRow), any(0))
			} else {
				newRow = append(_toAnySlice(newRow), any(65535))
			}
			x = (x + 1)
		}
		out = append(_toAnySlice(out), any(newRow))
		y = (y + 1)
	}
	return out
}

// line 66
func printImage(g [][]int) {
	y := 0
	for y < len(any(g)) {
		row := g[y]
		line := ""
		x := 0
		for x < len(any(row)) {
			if row[x] == 0 {
				line = line + "0"
			} else {
				line = line + "1"
			}
			x = (x + 1)
		}
		fmt.Println(strings.TrimSuffix(fmt.Sprintln(any(line)), "\n"))
		y = (y + 1)
	}
}

// line 85
func main() {
	img := image()
	h := histogram(img, 0)
	fmt.Println(strings.TrimSuffix(fmt.Sprintln(any("Histogram: "+fmt.Sprint(any(h)))), "\n"))
	t := medianThreshold(h)
	fmt.Println(strings.TrimSuffix(fmt.Sprintln(any("Threshold: "+fmt.Sprint(any(t)))), "\n"))
	bw := threshold(img, t)
	printImage(bw)
}

func main() {
	main()
}

func _toAnySlice[T any](s []T) []any {
	out := make([]any, len(s))
	for i, v := range s {
		out[i] = v
	}
	return out
}
