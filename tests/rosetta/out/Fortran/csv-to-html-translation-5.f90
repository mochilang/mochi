! Generated by Mochi compiler v0.10.26 on 2006-01-02T15:04:05Z
program csv_to_html_translation_5
  implicit none
  character(len=100) :: c
  integer, allocatable, dimension(:) :: rows
  integer :: line
  integer :: i0
    integer, allocatable, dimension(:) :: app1
  integer :: row
  integer :: i2
    character(len=100) :: cells
    integer :: cell
    integer :: i3
    integer, allocatable, dimension(:) :: out
    integer :: start
    integer :: i
    integer :: n
        integer, allocatable, dimension(:) :: app4
    integer, allocatable, dimension(:) :: app5
      integer :: ch
  c = trim(trim(trim(trim('Character,Speech'//char(10)//'' // 'The multitude,The messiah! Show us the messiah!'//char(10)//'') // 'Brians mother,<angry>Now you listen here! He''s not the messiah; he''s a very naughty boy! Now go away!</angry>'//char(10)//'') // 'The multitude,Who are you?'//char(10)//'') // 'Brians mother,I''m his mother; that''s who!'//char(10)//'') // 'The multitude,Behold his mother! Behold his mother!'
  allocate(rows(0))
  do i0 = 1, size(split(c,''//char(10)//''))
    line = split(c,''//char(10)//'')(i0)
    if (allocated(app1)) deallocate(app1)
    allocate(app1(size(rows)+1))
    app1(1:size(rows)) = rows
    app1(size(rows)+1) = split(line,',')
    rows = app1
  end do
  print *, '<table>'
  do i2 = 1, size(rows)
    row = rows(i2)
    cells = ''
    do i3 = 1, size(row)
      cell = row(i3)
      cells = trim(trim(cells // '<td>') // htmlEscape(cell)) // '</td>'
    end do
    print *, trim('    <tr>' // cells) // '</tr>'
  end do
  print *, '</table>'
  contains
  recursive integer function split(s,sep) result(res)
    character(len=100), intent(in) :: s
    character(len=100), intent(in) :: sep
    allocate(out(0))
    start = 0
    i = 0
    n = size(sep)
    do while (((i <= size(s)) - n))
      if ((s(i+1:(i + n)) == sep)) then
        if (allocated(app4)) deallocate(app4)
        allocate(app4(size(out)+1))
        app4(1:size(out)) = out
        app4(size(out)+1) = s(start+1:i)
        out = app4
        i = (i + n)
        start = i
      else
        i = (i + 1)
      end if
    end do
    if (allocated(app5)) deallocate(app5)
    allocate(app5(size(out)+1))
    app5(1:size(out)) = out
    app5(size(out)+1) = s(start+1:size(s))
    out = app5
    res = out
    return
  end function split
  recursive character(len=100) function htmlEscape(s) result(res)
    character(len=100), intent(in) :: s
    out = ''
    i = 0
    do while ((i < size(s)))
      ch = s(i+1:(i + 1))
      if ((ch == '&')) then
        out = out // '&amp;'
      else if ((ch == '<')) then
        out = out // '&lt;'
      else if ((ch == '>')) then
        out = out // '&gt;'
      else
        out = (out + ch)
      end if
      i = (i + 1)
    end do
    res = out
    return
  end function htmlEscape
end program csv_to_html_translation_5
