// Generated by Mochi compiler v0.10.28 on 2025-07-18T10:24:07Z
// Generated by Mochi compiler v0.10.28 on 2025-07-18T10:24:07Z
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct {
  int len;
  int *data;
} list_int;
static list_int list_int_create(int len) {
  list_int l;
  l.len = len;
  l.data = calloc(len, sizeof(int));
  if (!l.data && len > 0) {
    fprintf(stderr, "alloc failed\n");
    exit(1);
  }
  return l;
}
typedef struct {
  int len;
  char **data;
} list_string;
static list_string list_string_create(int len) {
  list_string l;
  l.len = len;
  l.data = calloc(len, sizeof(char *));
  if (!l.data && len > 0) {
    fprintf(stderr, "alloc failed\n");
    exit(1);
  }
  return l;
}
static list_string concat_list_string(list_string a, list_string b) {
  list_string r = list_string_create(a.len + b.len);
  for (int i = 0; i < a.len; i++)
    r.data[i] = a.data[i];
  for (int i = 0; i < b.len; i++)
    r.data[a.len + i] = b.data[i];
  return r;
}
static char *concat_string(char *a, char *b) {
  size_t len1 = strlen(a);
  size_t len2 = strlen(b);
  char *buf = (char *)malloc(len1 + len2 + 1);
  memcpy(buf, a, len1);
  memcpy(buf + len1, b, len2);
  buf[len1 + len2] = '\0';
  return buf;
}
static char *_str(int v) {
  char *buf = (char *)malloc(32);
  sprintf(buf, "%d", v);
  return buf;
}
static char *slice_string(char *s, int start, int end) {
  int len = strlen(s);
  if (start < 0)
    start += len;
  if (end < 0)
    end += len;
  if (start < 0)
    start = 0;
  if (end > len)
    end = len;
  if (start > end)
    start = end;
  char *buf = (char *)malloc(end - start + 1);
  memcpy(buf, s + start, end - start);
  buf[end - start] = '\0';
  return buf;
}
static list_string slice_list_string(list_string v, int start, int end) {
  if (start < 0)
    start += v.len;
  if (end < 0)
    end += v.len;
  if (start < 0)
    start = 0;
  if (end > v.len)
    end = v.len;
  if (start > end)
    start = end;
  list_string r = list_string_create(end - start);
  for (int i = 0; i < r.len; i++)
    r.data[i] = v.data[start + i];
  return r;
}
list_int randInt(int s, int n) {
  int next = (s * 1664525 + 1013904223) % 2147483647;
  list_int tmp1 = list_int_create(2);
  tmp1.data[0] = next;
  tmp1.data[1] = next % n;
  return tmp1;
}

char *padLeft(char *s, int w) {
  char *res = "";
  int n = w - strlen(s);
  while (n > 0) {
    char *tmp2 = concat_string(res, " ");
    res = tmp2;
    n = n - 1;
  }
  char *tmp3 = concat_string(res, s);
  return tmp3;
}

list_int makeSeq(int s, int le) {
  char *bases = "ACGT";
  char *out = "";
  int i = 0;
  while (i < le) {
    list_int r = randInt(s, 4);
    s = r.data[0];
    int idx = (int)(r.data[1]);
    char *tmp4 = concat_string(out, slice_string(bases, idx, idx + 1));
    out = tmp4;
    i = i + 1;
  }
  list_int tmp5 = list_int_create(2);
  tmp5.data[0] = s;
  tmp5.data[1] = out;
  return tmp5;
}

list_int mutate(int s, char *dna, list_int w) {
  char *bases = "ACGT";
  int le = strlen(dna);
  list_int r = randInt(s, le);
  s = r.data[0];
  int p = (int)(r.data[1]);
  r = randInt(s, 300);
  s = r.data[0];
  int x = (int)(r.data[1]);
  list_string arr = list_string_create(0);
  int i = 0;
  while (i < le) {
    list_string tmp6 = list_string_create(1);
    tmp6.data[0] = slice_string(dna, i, i + 1);
    list_string tmp7 = concat_list_string(arr, tmp6);
    arr = tmp7;
    i = i + 1;
  }
  if (x < w.data[0]) {
    r = randInt(s, 4);
    s = r.data[0];
    int idx = (int)(r.data[1]);
    char *b = slice_string(bases, idx, idx + 1);
    char *tmp8 = _str(p);
    char *tmp9 = concat_string("  Change @", padLeft(tmp8, 3));
    char *tmp10 = concat_string(tmp9, " '");
    char *tmp11 = concat_string(tmp10, arr.data[p]);
    char *tmp12 = concat_string(tmp11, "' to '");
    char *tmp13 = concat_string(tmp12, b);
    char *tmp14 = concat_string(tmp13, "'");
    printf("%s\n", tmp14);
    arr.data[p] = b;
  } else if (x < w.data[0] + w.data[1]) {
    char *tmp15 = _str(p);
    char *tmp16 = concat_string("  Delete @", padLeft(tmp15, 3));
    char *tmp17 = concat_string(tmp16, " '");
    char *tmp18 = concat_string(tmp17, arr.data[p]);
    char *tmp19 = concat_string(tmp18, "'");
    printf("%s\n", tmp19);
    int j = p;
    while (j < arr.len - 1) {
      arr.data[j] = arr.data[j + 1];
      j = j + 1;
    }
    list_string tmp20 = slice_list_string(arr, 0, arr.len - 1);
    arr = tmp20;
  } else {
    r = randInt(s, 4);
    s = r.data[0];
    int idx2 = (int)(r.data[1]);
    char *b = slice_string(bases, idx2, idx2 + 1);
    list_string tmp21 = list_string_create(1);
    tmp21.data[0] = "";
    list_string tmp22 = concat_list_string(arr, tmp21);
    arr = tmp22;
    int j = arr.len - 1;
    while (j > p) {
      arr.data[j] = arr.data[j - 1];
      j = j - 1;
    }
    char *tmp23 = _str(p);
    char *tmp24 = concat_string("  Insert @", padLeft(tmp23, 3));
    char *tmp25 = concat_string(tmp24, " '");
    char *tmp26 = concat_string(tmp25, b);
    char *tmp27 = concat_string(tmp26, "'");
    printf("%s\n", tmp27);
    arr.data[p] = b;
  }
  char *out = "";
  i = 0;
  while (i < arr.len) {
    char *tmp28 = concat_string(out, arr.data[i]);
    out = tmp28;
    i = i + 1;
  }
  list_int tmp29 = list_int_create(2);
  tmp29.data[0] = s;
  tmp29.data[1] = out;
  return tmp29;
}

int prettyPrint(char *dna, int rowLen) {
  printf("SEQUENCE:\n");
  int le = strlen(dna);
  int i = 0;
  while (i < le) {
    int k = i + rowLen;
    if (k > le) {
      k = le;
    }
    char *tmp30 = _str(i);
    char *tmp31 = concat_string(padLeft(tmp30, 5), ": ");
    char *tmp32 = slice_string(dna, i, k);
    char *tmp33 = concat_string(tmp31, tmp32);
    printf("%s\n", tmp33);
    i = i + rowLen;
  }
  int a = 0;
  int c = 0;
  int g = 0;
  int t = 0;
  int idx = 0;
  while (idx < le) {
    char *ch = slice_string(dna, idx, idx + 1);
    if ((strcmp(ch, "A") == 0)) {
      a = a + 1;
    } else {
      if ((strcmp(ch, "C") == 0)) {
        c = c + 1;
      } else {
        if ((strcmp(ch, "G") == 0)) {
          g = g + 1;
        } else {
          if ((strcmp(ch, "T") == 0)) {
            t = t + 1;
          }
        }
      }
    }
    idx = idx + 1;
  }
  printf("\n");
  printf("BASE COUNT:\n");
  char *tmp34 = _str(a);
  char *tmp35 = concat_string("    A: ", padLeft(tmp34, 3));
  printf("%s\n", tmp35);
  char *tmp36 = _str(c);
  char *tmp37 = concat_string("    C: ", padLeft(tmp36, 3));
  printf("%s\n", tmp37);
  char *tmp38 = _str(g);
  char *tmp39 = concat_string("    G: ", padLeft(tmp38, 3));
  printf("%s\n", tmp39);
  char *tmp40 = _str(t);
  char *tmp41 = concat_string("    T: ", padLeft(tmp40, 3));
  printf("%s\n", tmp41);
  printf("    ------\n");
  char *tmp42 = _str(le);
  char *tmp43 = concat_string("    Î£: ", tmp42);
  printf("%s\n", tmp43);
  printf("    ======\n");
}

char *wstring(list_int w) {
  char *tmp44 = _str(w.data[0]);
  char *tmp45 = concat_string("  Change: ", tmp44);
  char *tmp46 = concat_string(tmp45, "\n  Delete: ");
  char *tmp47 = _str(w.data[1]);
  char *tmp48 = concat_string(tmp46, tmp47);
  char *tmp49 = concat_string(tmp48, "\n  Insert: ");
  char *tmp50 = _str(w.data[2]);
  char *tmp51 = concat_string(tmp49, tmp50);
  char *tmp52 = concat_string(tmp51, "\n");
  return tmp52;
}

int mochi_main() {
  int seed = 1;
  list_int res = makeSeq(seed, 250);
  seed = res.data[0];
  char *dna = (char *)(res.data[1]);
  prettyPrint(dna, 50);
  int muts = 10;
  list_int w = list_int_create(3);
  w.data[0] = 100;
  w.data[1] = 100;
  w.data[2] = 100;
  printf("\\nWEIGHTS (ex 300):\n");
  list_int tmp53 = list_int_create(3);
  tmp53.data[0] = 100;
  tmp53.data[1] = 100;
  tmp53.data[2] = 100;
  list_int tmp54 = list_int_create(3);
  tmp54.data[0] = 100;
  tmp54.data[1] = 100;
  tmp54.data[2] = 100;
  printf("%d\n", wstring(tmp54));
  char *tmp55 = _str(muts);
  char *tmp56 = concat_string("MUTATIONS (", tmp55);
  char *tmp57 = concat_string(tmp56, "):");
  printf("%s\n", tmp57);
  int i = 0;
  while (i < muts) {
    list_int tmp58 = list_int_create(3);
    tmp58.data[0] = 100;
    tmp58.data[1] = 100;
    tmp58.data[2] = 100;
    res = mutate(seed, dna, tmp58);
    seed = res.data[0];
    dna = (char *)(res.data[1]);
    i = i + 1;
  }
  printf("\n");
  prettyPrint(dna, 50);
}

int _mochi_main() {
  mochi_main();
  return 0;
}
int main() { return _mochi_main(); }
