// Generated by Mochi compiler v0.10.26 on 2025-07-16T12:10:53Z
// bitmap-write-a-ppm-file.mochi
import java.util.*;

class Colour {
    int R;
    int G;
    int B;
    Colour(int R, int G, int B) {
        this.R = R;
        this.G = G;
        this.B = B;
    }
    @Override public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Colour other)) return false;
        return Objects.equals(this.R, other.R) && Objects.equals(this.G, other.G) && Objects.equals(this.B, other.B);
    }
    @Override public int hashCode() {
        return Objects.hash(R, G, B);
    }
}
class Bitmap {
    int width;
    int height;
    List<List<Object>> pixels;
    Bitmap(int width, int height, List<List<Object>> pixels) {
        this.width = width;
        this.height = height;
        this.pixels = pixels;
    }
    @Override public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Bitmap other)) return false;
        return Objects.equals(this.width, other.width) && Objects.equals(this.height, other.height) && Objects.equals(this.pixels, other.pixels);
    }
    @Override public int hashCode() {
        return Objects.hash(width, height, pixels);
    }
}
public class BitmapWriteAPpmFile {
    static Object newBitmap(int w, int h, Object c) {
        List<List<Object>> rows = Arrays.asList();
        int y = 0;
        while (y < h) {
            List<Object> row = Arrays.asList();
            int x = 0;
            while (x < w) {
                row.add(c);
                x = (int)(x + 1);
            }
            rows.add(row);
            y = (int)(y + 1);
        }
        return new Bitmap(w, h, rows);
    }
    static void setPixel(Object b, int x, int y, Object c) {
        Object rows = ((Map<?,?>)b).get("pixels");
        Object row = ((Map<?,?>)rows).get(y);
        ((Map<?,?>)row).put(x, c);
        ((Map<?,?>)rows).put(y, row);
        b.pixels = rows;
    }
    static void fillRect(Object b, int x, int y, int w, int h, Object c) {
        int yy = y;
        while (yy < y + h) {
            int xx = x;
            while (xx < x + w) {
                setPixel(b, xx, yy, c);
                xx = (int)(xx + 1);
            }
            yy = (int)(yy + 1);
        }
    }
    static String pad(int n, int width) {
        String s = String.valueOf(n);
        while (s.length() < width) {
            s = " " + s;
        }
        return s;
    }
    static String writePPMP3(Object b) {
        int maxv = 0;
        int y = 0;
        while (y < ((Number)((Map<?,?>)b).get("height")).doubleValue()) {
            int x = 0;
            while (x < ((Number)((Map<?,?>)b).get("width")).doubleValue()) {
                Object p = ((Map<?,?>)((?)((Map<?,?>)b).get("pixels")).get(y)).get(x);
                if (((Number)((Map<?,?>)p).get("R")).doubleValue() > maxv) {
                    maxv = (int)(((Map<?,?>)p).get("R"));
                }
                if (((Number)((Map<?,?>)p).get("G")).doubleValue() > maxv) {
                    maxv = (int)(((Map<?,?>)p).get("G"));
                }
                if (((Number)((Map<?,?>)p).get("B")).doubleValue() > maxv) {
                    maxv = (int)(((Map<?,?>)p).get("B"));
                }
                x = (int)(x + 1);
            }
            y = (int)(y + 1);
        }
        int out = ((Number)((Number)((Number)((Number)((Number)"P3\n# generated from Bitmap.writeppmp3\n" + ((Number)String.valueOf(((Map<?,?>)b).get("width"))).doubleValue()).doubleValue() + " ").doubleValue() + ((Number)String.valueOf(((Map<?,?>)b).get("height"))).doubleValue()).doubleValue() + "\n").doubleValue() + String.valueOf(maxv)).doubleValue() + "\n";
        int numsize = String.valueOf(maxv).size();
        y = (int)(((Number)((Map<?,?>)b).get("height")).doubleValue() - 1);
        while (y >= 0) {
            String line = "";
            int x = 0;
            while (x < ((Number)((Map<?,?>)b).get("width")).doubleValue()) {
                Object p = ((Map<?,?>)((?)((Map<?,?>)b).get("pixels")).get(y)).get(x);
                line = ((Number)((Number)((Number)((Number)line + "   " + ((Number)pad(((Map<?,?>)p).get("R"), numsize)).doubleValue()).doubleValue() + " ").doubleValue() + ((Number)pad(((Map<?,?>)p).get("G"), numsize)).doubleValue()).doubleValue() + " ").doubleValue() + ((Number)pad(((Map<?,?>)p).get("B"), numsize)).doubleValue();
                x = (int)(x + 1);
            }
            out = (int)(out + line);
            if (y > 0) {
                out = (int)(out + "\n");
            }
            else {
                out = (int)(out + "\n");
            }
            y = (int)(y - 1);
        }
        return out;
    }
    static void main() {
        Colour black = new Colour(0, 0, 0);
        Colour white = new Colour(255, 255, 255);
        Object bm = newBitmap(4, 4, black);
        fillRect(bm, 1, 0, 1, 2, white);
        setPixel(bm, 3, 3, new Colour(127, 0, 63));
        String ppm = writePPMP3(bm);
        System.out.println(ppm);
    }
    static <T> List<T> append(List<T> list, T item) {
        List<T> res = new ArrayList<>(list);
        res.add(item);
        return res;
    }
    public static void main(String[] args) {
    main();
    }
}
