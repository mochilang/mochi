// Generated by Mochi compiler v0.10.26 on 2025-07-16T11:36:08Z
program ApplyADigitalFilterDirectFormIiTransposed;
{$mode objfpc}
{$modeswitch nestedprocvars}
uses SysUtils, fgl, fphttpclient, Classes, Variants, fpjson, jsonparser, fpjsonrtti;

type
  generic TArray<T> = array of T;

function applyFilter(input: specialize TArray<double>; a: specialize TArray<double>; b: specialize TArray<double>): specialize TArray<double>;
var
  i: integer;
  j: integer;
  out: specialize TArray<double>;
  scale: double;
  tmp: double;
begin
  out := specialize TArray<double>([]);
  scale := 1 div specialize _indexList<double>(a, 0);
  i := 0;
  while (i < Length(input)) do
  begin
    tmp := 0;
    j := 0;
    while ((j <= i) and (j < Length(b))) do
    begin
      tmp := tmp + specialize _indexList<double>(b, j) * specialize _indexList<integer>(input, i - j);
      j := j + 1;
    end;
    j := 0;
    while ((j < i) and (j + 1 < Length(a))) do
    begin
      tmp := tmp - specialize _indexList<double>(a, j + 1) * out[i - j - 1];
      j := j + 1;
    end;
    out := specialize _appendList<Variant>(out, tmp * scale);
    i := i + 1;
  end;
  result := out;
  exit;
end;

generic function _appendList<T>(arr: specialize TArray<T>; val: T): specialize TArray<T>;
var i,n: Integer;
begin
  n := Length(arr);
  SetLength(Result, n + 1);
  for i := 0 to n - 1 do
    Result[i] := arr[i];
  Result[n] := val;
end;

generic function _indexList<T>(arr: specialize TArray<T>; i: integer): T;
begin
  if i < 0 then i := Length(arr) + i;
  if (i < 0) or (i >= Length(arr)) then
    raise Exception.Create('index out of range');
  Result := arr[i];
end;

var
  a: specialize TArray<double>;
  b: specialize TArray<double>;
  k: integer;
  res: specialize TArray<double>;
  sig: specialize TArray<double>;

begin
  a := specialize TArray<double>([1, -2.7756e-16, 0.33333333, -1.85e-17]);
  b := specialize TArray<double>([0.16666667, 0.5, 0.5, 0.16666667]);
  sig := specialize TArray<double>([-0.917843918645, 0.141984778794, 1.20536903482, 0.190286794412, -0.662370894973, -1.00700480494, -0.404707073677, 0.800482325044, 0.743500089861, 1.01090520172, 0.741527555207, 0.277841675195, 0.400833448236, -0.2085993586, -0.172842103641, -0.134316096293, 0.0259303398477, 0.490105989562, 0.549391221511, 0.9047198589]);
  res := applyFilter(sig, a, b);
  k := 0;
  while (k < Length(res)) do
  begin
    writeln(specialize _indexList<double>(res, k));
    k := k + 1;
  end;
end.
