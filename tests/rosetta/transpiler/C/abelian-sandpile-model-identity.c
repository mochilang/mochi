// Generated by Mochi 0.10.32 on 2025-07-25 17:54 +0700
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <malloc.h>

size_t neighborsList_len;
size_t *neighborsList_lens;
size_t plus_len;

static char* str_concat(const char *a, const char *b) {
    size_t len1 = strlen(a);
    size_t len2 = strlen(b);
    char *res = malloc(len1 + len2 + 1);
    memcpy(res, a, len1);
    memcpy(res + len1, b, len2);
    res[len1 + len2] = 0;
    return res;
}

static char* str_int(int v) {
    if(v==0) return strdup("false");
    if(v==1) return strdup("true");
    char buf[32];
    snprintf(buf, sizeof(buf), "%d", v);
    return strdup(buf);
}

static int* list_append_int(int *arr, size_t *len, int val) {
    arr = realloc(arr, (*len + 1) * sizeof(int));
    arr[*len] = val;
    (*len)++;
    return arr;
}

#include <time.h>
#include <stdlib.h>
static int seeded_now = 0;
static long long now_seed = 0;
static long long _now(void) {
    if (!seeded_now) {
        const char *s = getenv("MOCHI_NOW_SEED");
        if (s && *s) {
            now_seed = atoll(s);
            seeded_now = 1;
        }
    }
    if (seeded_now) {
        now_seed = (now_seed * 1664525 + 1013904223) % 2147483647;
        return now_seed;
    }
    struct timespec ts;
    clock_gettime(CLOCK_REALTIME, &ts);
    return (long long)(ts.tv_sec * 1000000000LL + ts.tv_nsec);
}

static long long _mem(void) {
    struct mallinfo mi = mallinfo();
    return (long long)mi.uordblks;
}

int s4[] = {4, 3, 3, 3, 1, 2, 0, 2, 3};
size_t s4_len = 9;
int s1[] = {1, 2, 0, 2, 1, 1, 0, 1, 3};
size_t s1_len = 9;
int s2[] = {2, 1, 3, 1, 0, 1, 0, 1, 0};
size_t s2_len = 9;
int s3[] = {3, 3, 3, 3, 3, 3, 3, 3, 3};
size_t s3_len = 9;
int s3_id[] = {2, 1, 2, 1, 0, 1, 2, 1, 2};
size_t s3_id_len = 9;

int * * neighborsList() {
    return neighborsList_lens = (size_t[]){2, 3, 2, 3, 4, 3, 2, 3, 2}, neighborsList_len = 9, (int*[]){ (int[]){ 1, 3 }, (int[]){ 0, 2, 4 }, (int[]){ 1, 5 }, (int[]){ 0, 4, 6 }, (int[]){ 1, 3, 5, 7 }, (int[]){ 2, 4, 8 }, (int[]){ 3, 7 }, (int[]){ 4, 6, 8 }, (int[]){ 5, 7 } };
}

int * plus(int * a, size_t a_len, int * b, size_t b_len) {
    int *res = NULL;
    size_t res_len = 0;
    int i = 0;
    while (i < a_len) {
        res = list_append_int(res, &res_len, a[i] + b[i]);
        i = i + 1;
    }
    return plus_len = res_len, res;
}

int isStable(int * p, size_t p_len) {
    for (size_t __i = 0; __i < p_len; __i++) {
        int v = p[__i];
        if (v > 3) {
            return 0;
        }
    }
    return 1;
}

int topple(int * p, size_t p_len) {
    int **neighbors = neighborsList();
    size_t neighbors_len = neighborsList_len;
    size_t *neighbors_lens = neighborsList_lens;
    size_t neighbors_lens_len = neighborsList_len;
    int i = 0;
    while (i < p_len) {
        if (p[i] > 3) {
            p[i] = p[i] - 4;
            int *nbs = neighbors[i];
            size_t nbs_len = neighbors_lens[i];
            for (size_t __i = 0; __i < nbs_len; __i++) {
                int j = nbs[__i];
                p[j] = p[j] + 1;
            }
            return 0;
        }
        i = i + 1;
    }
    return 0;
}

const char* pileString(int * p, size_t p_len) {
    const char* s = "";
    int r = 0;
    while (r < 3) {
        int c = 0;
        while (c < 3) {
            s = str_concat(str_concat(s, str_int(p[(3 * r) + c])), " ");
            c = c + 1;
        }
        s = str_concat(s, "\n");
        r = r + 1;
    }
    return s;
}

int main(void) {
    {
        long long __start = _now();
        long long __mem_start = _mem();
        puts("Avalanche of topplings:\n");
        puts(pileString(s4, s4_len));
        while (!(isStable(s4, s4_len))) {
            topple(s4, s4_len);
            puts(pileString(s4, s4_len));
        }
        puts("Commutative additions:\n");
        int *s3_a = plus(s1, s1_len, s2, s2_len);
        size_t s3_a_len = plus_len;
        while (!(isStable(s3_a, s3_a_len))) {
            topple(s3_a, s3_a_len);
        }
        int *s3_b = plus(s2, s2_len, s1, s1_len);
        size_t s3_b_len = plus_len;
        while (!(isStable(s3_b, s3_b_len))) {
            topple(s3_b, s3_b_len);
        }
        puts(str_concat(str_concat(str_concat(str_concat(pileString(s1, s1_len), "\nplus\n\n"), pileString(s2, s2_len)), "\nequals\n\n"), pileString(s3_a, s3_a_len)));
        puts(str_concat(str_concat(str_concat(str_concat(str_concat("and\n\n", pileString(s2, s2_len)), "\nplus\n\n"), pileString(s1, s1_len)), "\nalso equals\n\n"), pileString(s3_b, s3_b_len)));
        puts("Addition of identity sandpile:\n");
        int *s4b = plus(s3, s3_len, s3_id, s3_id_len);
        size_t s4b_len = plus_len;
        while (!(isStable(s4b, s4b_len))) {
            topple(s4b, s4b_len);
        }
        puts(str_concat(str_concat(str_concat(str_concat(pileString(s3, s3_len), "\nplus\n\n"), pileString(s3_id, s3_id_len)), "\nequals\n\n"), pileString(s4b, s4b_len)));
        puts("Addition of identities:\n");
        int *s5 = plus(s3_id, s3_id_len, s3_id, s3_id_len);
        size_t s5_len = plus_len;
        while (!(isStable(s5, s5_len))) {
            topple(s5, s5_len);
        }
        puts(str_concat(str_concat(str_concat(str_concat(pileString(s3_id, s3_id_len), "\nplus\n\n"), pileString(s3_id, s3_id_len)), "\nequals\n\n"), pileString(s5, s5_len)));
        long long __end = _now();
        long long __mem_end = _mem();
        long long __dur_us = (__end - __start) / 1000;
        long long __mem_bytes = __mem_end - __mem_start;
        printf("{\n  \"duration_us\": %-lld,\n  \"memory_bytes\": %-lld,\n  \"name\": \"main\"\n}\n", __dur_us, __mem_bytes);
    }
    return 0;
}
