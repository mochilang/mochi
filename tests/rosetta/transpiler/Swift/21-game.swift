// Generated by Mochi transpiler v0.10.37 on 2025-07-23 10:47:35 GMT+7
import Foundation

func parseIntStr(_ str: String) -> Int {
    var str = str
    var i = 0
    var neg = false
    if ((Int(((String(str)).count)) > 0) && (String(String(Array(str)[0..<1])) == "-")) {
        neg = true
        i = 1
    }
    var n = 0
    let digits = ["0": 0, "1": 1, "2": 2, "3": 3, "4": 4, "5": 5, "6": 6, "7": 7, "8": 8, "9": 9]
    while (Int(i) < Int(((String(str)).count))) {
        n = (((Int(n) * 10) + (digits[String(String(Array(str)[Int(i)..<(Int(i) + 1)]))] as! Int)) as! Int)
        i = ((Int(i) + 1) as! Int)
    }
    if (neg as! Bool) {
        n = (-Int(n) as! Int)
    }
    return Int(n)
}
func main() {
    var total = 0
    var computer = (((Int(Int.random(in: 0..<Int.max)) % 2) == 0) as! Bool)
    print("Enter q to quit at any time\n")
    if (computer as! Bool) {
        print("The computer will choose first")
    } else {
        print("You will choose first")
    }
    print("\n\nRunning total is now 0\n\n")
    var round = 1
    var done = false
    while (!(done as! Bool)) {
        print((("ROUND " + String(String(Int(round)))) + ":\n\n"))
        var i = 0
        while ((Int(i) < 2) && ((!(done as! Bool)) as! Bool)) {
            if (computer as! Bool) {
                var choice = 0
                if (Int(total) < 18) {
                    choice = (((Int(Int.random(in: 0..<Int.max)) % 3) + 1) as! Int)
                } else {
                    choice = ((21 - Int(total)) as! Int)
                }
                total = ((Int(total) + Int(choice)) as! Int)
                print(("The computer chooses " + String(String(Int(choice)))))
                print(("Running total is now " + String(String(Int(total)))))
                if (Int(total) == 21) {
                    print("\nSo, commiserations, the computer has won!")
                    done = true
                }
            } else {
                while true {
                    print("Your choice 1 to 3 : ")
                    let line = String((readLine() ?? ""))
                    if ((String(line) == "q") || (String(line) == "Q")) {
                        print("OK, quitting the game")
                        done = true
                        break
                    }
                    var num = Int(parseIntStr(String(line)))
                    if ((Int(num) < 1) || (Int(num) > 3)) {
                        if ((Int(total) + Int(num)) > 21) {
                            print("Too big, try again")
                        } else {
                            print("Out of range, try again")
                        }
                        continue
                    }
                    if ((Int(total) + Int(num)) > 21) {
                        print("Too big, try again")
                        continue
                    }
                    total = ((Int(total) + Int(num)) as! Int)
                    print(("Running total is now " + String(String(Int(total)))))
                    break
                }
                if (Int(total) == 21) {
                    print("\nSo, congratulations, you've won!")
                    done = true
                }
            }
            print("\n")
            computer = ((!(computer as! Bool)) as! Bool)
            i = ((Int(i) + 1) as! Int)
        }
        round = ((Int(round) + 1) as! Int)
    }
}
main()
