// Generated by Mochi transpiler
class Pixel {
  int r;
  int g;
  int b;
  Pixel({required this.r, required this.g, required this.b});
}

final int b3Seg = 30;
Pixel pixelFromRgb(int rgb) {
  final int r = rgb ~/ 65536 % 256 as int;
  final int g = rgb ~/ 256 % 256 as int;
  final int b = rgb % 256 as int;
  return Pixel(r: r, g: g, b: b);
}

Map<String, dynamic> newBitmap(int cols, int rows) {
  List<List<Pixel>> d = [];
  int y = 0;
  while (y < rows) {
    List<Pixel> row = [];
    int x = 0;
    while (x < cols) {
    row = [...row, Pixel(r: 0, g: 0, b: 0)];
    x = x + 1;
  }
    d = [...d, row];
    y = y + 1;
  }
  return {"cols": cols, "rows": rows, "data": d};
}

void setPx(Map<String, dynamic> b, int x, int y, Pixel p) {
  final int cols = b["cols"]!! as int;
  final int rows = b["rows"]!! as int;
  if (x >= 0 && x < cols && y >= 0 && y < rows) {
    b["data"]!![y]![x] = p;
  }
}

void fill(Map<String, dynamic> b, Pixel p) {
  final int cols = b["cols"]!! as int;
  final int rows = b["rows"]!! as int;
  int y = 0;
  while (y < rows) {
    int x = 0;
    while (x < cols) {
    b["data"]!![y]![x] = p;
    x = x + 1;
  }
    y = y + 1;
  }
}

void fillRgb(Map<String, dynamic> b, int rgb) {
  fill(b, pixelFromRgb(rgb));
}

void line(Map<String, dynamic> b, int x0, int y0, int x1, int y1, Pixel p) {
  int dx = x1 - x0;
  if (dx < 0) {
    dx = -dx;
  }
  int dy = y1 - y0;
  if (dy < 0) {
    dy = -dy;
  }
  int sx = -1;
  if (x0 < x1) {
    sx = 1;
  }
  int sy = -1;
  if (y0 < y1) {
    sy = 1;
  }
  int err = dx - dy;
  while (true) {
    setPx(b, x0, y0, p);
    if (x0 == x1 && y0 == y1) {
    break;
  }
    final int e2 = 2 * err;
    if (e2 > 0 - dy) {
    err = err - dy;
    x0 = x0 + sx;
  }
    if (e2 < dx) {
    err = err + dx;
    y0 = y0 + sy;
  }
  }
}

void bezier3(Map<String, dynamic> b, int x1, int y1, int x2, int y2, int x3, int y3, int x4, int y4, Pixel p) {
  List<int> px = [];
  List<int> py = [];
  int i = 0;
  while (i <= b3Seg) {
    px = [...px, 0];
    py = [...py, 0];
    i = i + 1;
  }
  final num fx1 = (x1).toDouble();
  final num fy1 = (y1).toDouble();
  final num fx2 = (x2).toDouble();
  final num fy2 = (y2).toDouble();
  final num fx3 = (x3).toDouble();
  final num fy3 = (y3).toDouble();
  final num fx4 = (x4).toDouble();
  final num fy4 = (y4).toDouble();
  i = 0;
  while (i <= b3Seg) {
    final num d = ((i).toDouble()) / ((b3Seg).toDouble());
    num a = 1.0 - d;
    num bcoef = a * a;
    num ccoef = d * d;
    num a2 = a * bcoef;
    num b2 = 3.0 * bcoef * d;
    num c2 = 3.0 * a * ccoef;
    num d2 = ccoef * d;
    px[i] = (a2 * fx1 + b2 * fx2 + c2 * fx3 + d2 * fx4).toInt();
    py[i] = (a2 * fy1 + b2 * fy2 + c2 * fy3 + d2 * fy4).toInt();
    i = i + 1;
  }
  int x0 = px[0];
  int y0 = py[0];
  i = 1;
  while (i <= b3Seg) {
    final int x = px[i];
    final int y = py[i];
    line(b, x0, y0, x, y, p);
    x0 = x;
    y0 = y;
    i = i + 1;
  }
}

Map<String, dynamic> b = newBitmap(400, 300);
void main() {
  fillRgb(b, 16773055);
  bezier3(b, 20, 200, 700, 50, -300, 50, 380, 150, pixelFromRgb(4165615));
}
