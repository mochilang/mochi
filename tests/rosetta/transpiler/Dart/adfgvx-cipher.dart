// Generated by Mochi transpiler
import 'dart:io';

int _nowSeed = 0;
bool _nowSeeded = false;
void _initNow() {
  var s = Platform.environment['MOCHI_NOW_SEED'];
  if (s != null && s.isNotEmpty) {
    var v = int.tryParse(s);
    if (v != null) {
      _nowSeed = v;
      _nowSeeded = true;
    }
  }
}
int _now() {
  if (_nowSeeded) {
    _nowSeed = (_nowSeed * 1664525 + 1013904223) % 2147483647;
    return _nowSeed;
  }
  return DateTime.now().microsecondsSinceEpoch;
}

String adfgvx = "ADFGVX";
String alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
String shuffleStr(String s) {
  List<String> arr = [];
  int i = 0;
  while (i < s.length) {
    arr = [...arr, s.substring(i, i + 1)];
    i = i + 1;
  }
  int j = arr.length - 1;
  while (j > 0) {
    final int k = _now() % (j + 1);
    final String tmp = arr[j];
    arr[j] = arr[k];
    arr[k] = tmp;
    j = j - 1;
  }
  String out = "";
  i = 0;
  while (i < arr.length) {
    out = out + arr[i];
    i = i + 1;
  }
  return out;
}

List<String> createPolybius() {
  final String shuffled = shuffleStr(alphabet);
  List<String> labels = [];
  int li = 0;
  while (li < adfgvx.length) {
    labels = [...labels, adfgvx.substring(li, li + 1)];
    li = li + 1;
  }
  print("6 x 6 Polybius square:\n");
  print("  | A D F G V X");
  print("---------------");
  List<String> p = [];
  int i = 0;
  while (i < 6) {
    String row = shuffled.substring(i * 6, (i + 1) * 6);
    p = [...p, row];
    String line = labels[i] + " | ";
    int j = 0;
    while (j < 6) {
    line = line + row.substring(j, j + 1) + " ";
    j = j + 1;
  }
    print(line);
    i = i + 1;
  }
  return p;
}

String createKey(int n) {
  if (n < 7 || n > 12) {
    print("Key should be within 7 and 12 letters long.");
  }
  String pool = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  String key = "";
  int i = 0;
  while (i < n) {
    final int idx = _now() % pool.length;
    key = key + pool.substring(idx, idx + 1);
    pool = pool.substring(0, idx) + pool.substring(idx + 1, pool.length);
    i = i + 1;
  }
  print("\nThe key is " + key);
  return key;
}

List<int> orderKey(String key) {
  List<dynamic> pairs = [];
  int i = 0;
  while (i < key.length) {
    pairs = [...pairs, [key.substring(i, i + 1), i]];
    i = i + 1;
  }
  int n = pairs.length;
  int m = 0;
  while (m < n) {
    int j = 0;
    while (j < n - 1) {
    if (pairs[j]![0] > pairs[j + 1]![0]) {
    final tmp = pairs[j];
    pairs[j] = pairs[j + 1];
    pairs[j + 1] = tmp;
  }
    j = j + 1;
  }
    m = m + 1;
  }
  List<dynamic> res = [];
  i = 0;
  while (i < n) {
    res = [...res, pairs[i]![1]! as int];
    i = i + 1;
  }
  return List<int>.from(res);
}

String encrypt(List<String> polybius, String key, String plainText) {
  List<String> labels = [];
  int li = 0;
  while (li < adfgvx.length) {
    labels = [...labels, adfgvx.substring(li, li + 1)];
    li = li + 1;
  }
  String temp = "";
  int i = 0;
  while (i < plainText.length) {
    int r = 0;
    while (r < 6) {
    int c = 0;
    while (c < 6) {
    if (polybius[r]!.sublist(c, c + 1) == plainText.substring(i, i + 1)) {
    temp = temp + labels.sublist(r, r + 1) + labels.sublist(c, c + 1);
  }
    c = c + 1;
  }
    r = r + 1;
  }
    i = i + 1;
  }
  int colLen = temp.length ~/ key.length;
  if (temp.length % key.length > 0) {
    colLen = colLen + 1;
  }
  List<List<String>> table = [];
  int rIdx = 0;
  while (rIdx < colLen) {
    List<String> row = [];
    int j = 0;
    while (j < key.length) {
    row = [...row, ""];
    j = j + 1;
  }
    table = [...table, row];
    rIdx = rIdx + 1;
  }
  int idx = 0;
  while (idx < temp.length) {
    final int row = idx ~/ key.length;
    final int col = idx % key.length;
    table[row]![col] = temp.substring(idx, idx + 1);
    idx = idx + 1;
  }
  final List<int> order = orderKey(key);
  List<String> cols = [];
  int ci = 0;
  while (ci < key.length) {
    String colStr = "";
    int ri = 0;
    while (ri < colLen) {
    colStr = colStr + table[ri]![order[ci]];
    ri = ri + 1;
  }
    cols = [...cols, colStr];
    ci = ci + 1;
  }
  String result = "";
  ci = 0;
  while (ci < cols.length) {
    result = result + cols[ci];
    if (ci < cols.length - 1) {
    result = result + " ";
  }
    ci = ci + 1;
  }
  return result;
}

int indexOf(String s, String ch) {
  int i = 0;
  while (i < s.length) {
    if (s.substring(i, i + 1) == ch) {
    return i;
  }
    i = i + 1;
  }
  return -1;
}

String decrypt(List<String> polybius, String key, String cipherText) {
  List<String> colStrs = [];
  int start = 0;
  int i = 0;
  while (i <= cipherText.length) {
    if (i == cipherText.length || cipherText.substring(i, i + 1) == " ") {
    colStrs = [...colStrs, cipherText.substring(start, i)];
    start = i + 1;
  }
    i = i + 1;
  }
  int maxColLen = 0;
  i = 0;
  while (i < colStrs.length) {
    if (colStrs[i].length > maxColLen) {
    maxColLen = colStrs[i].length;
  }
    i = i + 1;
  }
  List<List<String>> cols = [];
  i = 0;
  while (i < colStrs.length) {
    String s = colStrs[i];
    List<String> ls = [];
    int j = 0;
    while (j < s.length) {
    ls = [...ls, s.substring(j, j + 1)];
    j = j + 1;
  }
    if (s.length < maxColLen) {
    List<String> pad = [];
    int k = 0;
    while (k < maxColLen) {
    if (k < ls.length) {
    pad = [...pad, ls[k]];
  } else {
    pad = [...pad, ""];
  }
    k = k + 1;
  };
    cols = [...cols, pad];
  } else {
    cols = [...cols, ls];
  }
    i = i + 1;
  }
  List<List<String>> table = [];
  int r = 0;
  while (r < maxColLen) {
    List<String> row = [];
    int c = 0;
    while (c < key.length) {
    row = [...row, ""];
    c = c + 1;
  }
    table = [...table, row];
    r = r + 1;
  }
  final List<int> order = orderKey(key);
  r = 0;
  while (r < maxColLen) {
    int c = 0;
    while (c < key.length) {
    table[r]![order[c]] = cols[c]![r];
    c = c + 1;
  }
    r = r + 1;
  }
  String temp = "";
  r = 0;
  while (r < table.length) {
    int j = 0;
    while (j < table[r].length) {
    temp = temp + table[r]![j];
    j = j + 1;
  }
    r = r + 1;
  }
  String plainText = "";
  int idx = 0;
  while (idx < temp.length) {
    final int rIdx = indexOf(adfgvx, temp.substring(idx, idx + 1));
    final int cIdx = indexOf(adfgvx, temp.substring(idx + 1, idx + 2));
    plainText = plainText + polybius[rIdx]![cIdx];
    idx = idx + 2;
  }
  return plainText;
}

void main() {
  final String plainText = "ATTACKAT1200AM";
  final List<String> polybius = createPolybius();
  final String key = createKey(9);
  print("\nPlaintext : " + plainText);
  final String cipherText = encrypt(polybius, key, plainText);
  print("\nEncrypted : " + cipherText);
  final String plainText2 = decrypt(polybius, key, cipherText);
  print("\nDecrypted : " + plainText2);
}

void _start() {
  _initNow();
  main();
}
