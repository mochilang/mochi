// Generated by Mochi transpiler
import 'dart:io';

int _nowSeed = 0;
bool _nowSeeded = false;
void _initNow() {
  var s = Platform.environment['MOCHI_NOW_SEED'];
  if (s != null && s.isNotEmpty) {
    var v = int.tryParse(s);
    if (v != null) {
      _nowSeed = v;
      _nowSeeded = true;
    }
  }
}
int _now() {
  if (_nowSeeded) {
    _nowSeed = (_nowSeed * 1664525 + 1013904223) % 2147483647;
    return _nowSeed;
  }
  return DateTime.now().microsecondsSinceEpoch;
}

class S1 {
  final int idx;
  final bool ok;
  const S1({required this.idx, required this.ok});
}

List<int> board = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0];
final List<int> solved = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0];
int empty = 15;
int moves = 0;
bool quit = false;
int randMove() {
  return _now() % 4;
}

bool isSolved() {
  int i = 0;
  while (i < 16) {
    if (board[i] != solved[i]) {
    return false;
  }
    i = i + 1;
  }
  return true;
}

S1 isValidMove(m) {
  if (m == 0) {
    return S1(idx: empty - 4, ok: empty ~/ 4 > 0);
  }
  if (m == 1) {
    return S1(idx: empty + 4, ok: empty ~/ 4 < 3);
  }
  if (m == 2) {
    return S1(idx: empty + 1, ok: empty % 4 < 3);
  }
  if (m == 3) {
    return S1(idx: empty - 1, ok: empty % 4 > 0);
  }
  return S1(idx: 0, ok: false);
}

bool doMove(m) {
  final S1 r = isValidMove(m);
  if (!r.ok) {
    return false;
  }
  final int i = empty;
  final j = r.idx as int;
  final int tmp = board[i];
  board[i] = board[j];
  board[j] = tmp;
  empty = j;
  moves = moves + 1;
  return true;
}

void shuffle(n) {
  int i = 0;
  while (i < n || isSolved()) {
    if (doMove(randMove())) {
    i = i + 1;
  }
  }
}

void printBoard() {
  String line = "";
  int i = 0;
  while (i < 16) {
    final int val = board[i];
    if (val == 0) {
    line = line + "  .";
  } else {
    final String s = (val).toString();
    if (val < 10) {
    line = line + "  " + s;
  } else {
    line = line + " " + s;
  };
  }
    if (i % 4 == 3) {
    print(line);
    line = "";
  }
    i = i + 1;
  }
}

void playOneMove() {
  while (true) {
    print("Enter move #" + (moves + 1).toString() + " (U, D, L, R, or Q): ");
    final String s = stdin.readLineSync() ?? '';
    if (s == "") {
    continue;
  }
    final String c = s.substring(0, 1);
    int m = 0;
    if (c == "U" || c == "u") {
    m = 0;
  } else {
    if (c == "D" || c == "d") {
    m = 1;
  } else {
    if (c == "R" || c == "r") {
    m = 2;
  } else {
    if (c == "L" || c == "l") {
    m = 3;
  } else {
    if (c == "Q" || c == "q") {
    print("Quiting after " + (moves).toString() + " moves.");
    quit = true;
    return;
  } else {
    print("Please enter \"U\", \"D\", \"L\", or \"R\" to move the empty cell\n" + "up, down, left, or right. You can also enter \"Q\" to quit.\n" + "Upper or lowercase is accepted and only the first non-blank\n" + "character is important (i.e. you may enter \"up\" if you like).");
    continue;
  };
  };
  };
  };
  }
    if (!doMove(m)) {
    print("That is not a valid move at the moment.");
    continue;
  }
    return;
  }
}

void play() {
  print("Starting board:");
  while (!quit && isSolved() == false) {
    print("");
    printBoard();
    playOneMove();
  }
  if (isSolved()) {
    print("You solved the puzzle in " + (moves).toString() + " moves.");
  }
}

void main() {
  shuffle(50);
  play();
}

void _start() {
  _initNow();
  main();
  main();
}
