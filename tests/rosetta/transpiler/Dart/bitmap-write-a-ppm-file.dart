// Generated by Mochi transpiler
class Colour {
  int R;
  int G;
  int B;
  Colour({required this.R, required this.G, required this.B});
}

class Bitmap {
  int width;
  int height;
  List<List<Colour>> pixels;
  Bitmap({required this.width, required this.height, required this.pixels});
}

Bitmap newBitmap(int w, int h, Colour c) {
  List<List<Colour>> rows = [];
  int y = 0;
  while (y < h) {
    List<Colour> row = [];
    int x = 0;
    while (x < w) {
    row = [...row, c];
    x = x + 1;
  }
    rows = [...rows, row];
    y = y + 1;
  }
  return Bitmap(width: w, height: h, pixels: rows);
}

void setPixel(Bitmap b, int x, int y, Colour c) {
  List<List<Colour>> rows = b.pixels;
  List<Colour> row = rows[y];
  row[x] = c;
  rows[y] = row;
  b.pixels = rows;
}

void fillRect(Bitmap b, int x, int y, int w, int h, Colour c) {
  int yy = y;
  while (yy < y + h) {
    int xx = x;
    while (xx < x + w) {
    setPixel(b, xx, yy, c);
    xx = xx + 1;
  }
    yy = yy + 1;
  }
}

String pad(int n, int width) {
  String s = (n).toString();
  while (s.length < width) {
    s = " " + s;
  }
  return s;
}

String writePPMP3(Bitmap b) {
  int maxv = 0;
  int y = 0;
  while (y < b.height) {
    int x = 0;
    while (x < b.width) {
    final Colour p = b.pixels[y]![x];
    if (p.R > maxv) {
    maxv = p.R;
  }
    if (p.G > maxv) {
    maxv = p.G;
  }
    if (p.B > maxv) {
    maxv = p.B;
  }
    x = x + 1;
  }
    y = y + 1;
  }
  String out = "P3\n# generated from Bitmap.writeppmp3\n" + (b.width).toString() + " " + (b.height).toString() + "\n" + (maxv).toString() + "\n";
  int numsize = (maxv).toString().length;
  y = b.height - 1;
  while (y >= 0) {
    String line = "";
    int x = 0;
    while (x < b.width) {
    final Colour p = b.pixels[y]![x];
    line = line + "   " + pad(p.R, numsize) + " " + pad(p.G, numsize) + " " + pad(p.B, numsize);
    x = x + 1;
  }
    out = out + line;
    if (y > 0) {
    out = out + "\n";
  } else {
    out = out + "\n";
  }
    y = y - 1;
  }
  return out;
}

void main() {
  final Colour black = Colour(R: 0, G: 0, B: 0);
  final Colour white = Colour(R: 255, G: 255, B: 255);
  Bitmap bm = newBitmap(4, 4, black);
  fillRect(bm, 1, 0, 1, 2, white);
  setPixel(bm, 3, 3, Colour(R: 127, G: 0, B: 63));
  final String ppm = writePPMP3(bm);
  print(ppm);
}

void _start() {
  main();
}
