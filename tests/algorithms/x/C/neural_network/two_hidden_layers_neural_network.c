// Generated by Mochi 0.10.32 on 2025-08-26 00:42 +0700
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <malloc.h>
#include <math.h>


size_t append_len;
static char* str_int(long long v) {
    char buf[32];
    snprintf(buf, sizeof(buf), "%lld", v);
    return strdup(buf);
}

static double* list_append_double(double *arr, size_t *len, double val) {
    arr = realloc(arr, (*len + 1) * sizeof(double));
    arr[*len] = val;
    (*len)++;
    return arr;
}

static long long** list_append_intptr(long long **arr, size_t *len, long long *val) {
    arr = realloc(arr, (*len + 1) * sizeof(long long*));
    arr[*len] = val;
    (*len)++;
    return arr;
}

static double** list_append_doubleptr(double **arr, size_t *len, double *val) {
    arr = realloc(arr, (*len + 1) * sizeof(double*));
    arr[*len] = val;
    (*len)++;
    return arr;
}

static size_t* list_append_szt(size_t *arr, size_t *len, size_t val) {
    arr = realloc(arr, (*len + 1) * sizeof(size_t));
    arr[*len] = val;
    (*len)++;
    return arr;
}

#include <time.h>
static int seeded_now = 0;
static long long now_seed = 0;
static long long _now(void) {
    if (!seeded_now) {
        const char *s = getenv("MOCHI_NOW_SEED");
        if (s && *s) {
            now_seed = atoll(s);
            seeded_now = 1;
        }
    }
    if (seeded_now) {
        now_seed = (now_seed * 1664525 + 1013904223) % 2147483647;
        return now_seed;
    }
    struct timespec ts;
    clock_gettime(CLOCK_REALTIME, &ts);
    return (long long)(ts.tv_sec * 1000000000LL + ts.tv_nsec);
}

static long long _mem(void) {
    long long size = 0, rss = 0;
    FILE *f = fopen("/proc/self/statm", "r");
    if (f) {
        if (fscanf(f, "%lld %lld", &size, &rss) != 2) rss = 0;
        fclose(f);
    }
    return rss * (long long)sysconf(_SC_PAGESIZE);
}

static void panic(const char *msg) {
    fputs(msg, stderr);
    fputc('\n', stderr);
    exit(1);
}

typedef struct Network Network;

struct Network {
    double **w1;
    size_t w1_len;
    size_t *w1_lens;
    size_t w1_lens_len;
    double **w2;
    size_t w2_len;
    size_t *w2_lens;
    size_t w2_lens_len;
    double **w3;
    size_t w3_len;
    size_t *w3_lens;
    size_t w3_lens_len;
};

double exp_approx(double x);
double sigmoid(double x);
double sigmoid_derivative(double x);
Network new_network();
double feedforward(Network net, double * input, size_t input_len);
void train(Network* net, double * * inputs, size_t inputs_len, size_t* inputs_lens, size_t inputs_lens_len, double * outputs, size_t outputs_len, long long iterations);
long long predict(Network net, double * input, size_t input_len);
long long example();
void user_main();
int main(void);

double exp_approx(double x) {
    double sum = 1.0;
    double term = 1.0;
    long long i = 1LL;
    while (i < 10LL) {
        term = (term * x) / (double)(i);
        sum = sum + term;
        i = i + 1LL;
    }
    return sum;
}

double sigmoid(double x) {
    return 1.0 / (1.0 + exp_approx(-(x)));
}

double sigmoid_derivative(double x) {
    return x * (1.0 - x);
}

Network new_network() {
    return (Network){.w1 = ({double** tmp = malloc(3 * sizeof(double*)); tmp[0] = ({double** tmp = malloc(4 * sizeof(double*)); tmp[0] = 0.1; tmp[1] = 0.2; tmp[2] = 0.3; tmp[3] = 0.4; tmp;}); tmp[1] = ({double** tmp = malloc(4 * sizeof(double*)); tmp[0] = 0.5; tmp[1] = 0.6; tmp[2] = 0.7; tmp[3] = 0.8; tmp;}); tmp[2] = ({double** tmp = malloc(4 * sizeof(double*)); tmp[0] = 0.9; tmp[1] = 1.0; tmp[2] = 1.1; tmp[3] = 1.2; tmp;}); tmp;}), .w1_len = 3, .w1_lens = ({size_t *tmp = malloc(3 * sizeof(size_t)); tmp[0] = 4; tmp[1] = 4; tmp[2] = 4; tmp;}), .w1_lens_len = 3, .w2 = ({double** tmp = malloc(4 * sizeof(double*)); tmp[0] = ({double** tmp = malloc(3 * sizeof(double*)); tmp[0] = 0.1; tmp[1] = 0.2; tmp[2] = 0.3; tmp;}); tmp[1] = ({double** tmp = malloc(3 * sizeof(double*)); tmp[0] = 0.4; tmp[1] = 0.5; tmp[2] = 0.6; tmp;}); tmp[2] = ({double** tmp = malloc(3 * sizeof(double*)); tmp[0] = 0.7; tmp[1] = 0.8; tmp[2] = 0.9; tmp;}); tmp[3] = ({double** tmp = malloc(3 * sizeof(double*)); tmp[0] = 1.0; tmp[1] = 1.1; tmp[2] = 1.2; tmp;}); tmp;}), .w2_len = 4, .w2_lens = ({size_t *tmp = malloc(4 * sizeof(size_t)); tmp[0] = 3; tmp[1] = 3; tmp[2] = 3; tmp[3] = 3; tmp;}), .w2_lens_len = 4, .w3 = ({double** tmp = malloc(3 * sizeof(double*)); tmp[0] = ({double** tmp = malloc(1 * sizeof(double*)); tmp[0] = 0.1; tmp;}); tmp[1] = ({double** tmp = malloc(1 * sizeof(double*)); tmp[0] = 0.2; tmp;}); tmp[2] = ({double** tmp = malloc(1 * sizeof(double*)); tmp[0] = 0.3; tmp;}); tmp;}), .w3_len = 3, .w3_lens = ({size_t *tmp = malloc(3 * sizeof(size_t)); tmp[0] = 1; tmp[1] = 1; tmp[2] = 1; tmp;}), .w3_lens_len = 3};
}

double feedforward(Network net, double * input, size_t input_len) {
    double *hidden1 = NULL;
    size_t hidden1_len = 0;
    long long j = 0LL;
    while (j < 4LL) {
        double sum1 = 0.0;
        long long i = 0LL;
        while (i < 3LL) {
            sum1 = sum1 + (input[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? input_len + _mochi_idx : _mochi_idx;})] * net.w1[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? net.w1_len + _mochi_idx : _mochi_idx;})][(int)({long long _mochi_idx = j; _mochi_idx < 0 ? net.w1_lens[i] + _mochi_idx : _mochi_idx;})]);
            i = i + 1LL;
        }
        hidden1 = list_append_double(hidden1, &hidden1_len, sigmoid(sum1));
        j = j + 1LL;
    }
    double *hidden2 = NULL;
    size_t hidden2_len = 0;
    long long k = 0LL;
    while (k < 3LL) {
        double sum2 = 0.0;
        long long j2 = 0LL;
        while (j2 < 4LL) {
            sum2 = sum2 + (hidden1[(int)({long long _mochi_idx = j2; _mochi_idx < 0 ? hidden1_len + _mochi_idx : _mochi_idx;})] * net.w2[(int)({long long _mochi_idx = j2; _mochi_idx < 0 ? net.w2_len + _mochi_idx : _mochi_idx;})][(int)({long long _mochi_idx = k; _mochi_idx < 0 ? net.w2_lens[j2] + _mochi_idx : _mochi_idx;})]);
            j2 = j2 + 1LL;
        }
        hidden2 = list_append_double(hidden2, &hidden2_len, sigmoid(sum2));
        k = k + 1LL;
    }
    double sum3 = 0.0;
    long long k2 = 0LL;
    while (k2 < 3LL) {
        sum3 = sum3 + (hidden2[(int)({long long _mochi_idx = k2; _mochi_idx < 0 ? hidden2_len + _mochi_idx : _mochi_idx;})] * net.w3[(int)({long long _mochi_idx = k2; _mochi_idx < 0 ? net.w3_len + _mochi_idx : _mochi_idx;})][(int)({long long _mochi_idx = 0LL; _mochi_idx < 0 ? net.w3_lens[k2] + _mochi_idx : _mochi_idx;})]);
        k2 = k2 + 1LL;
    }
    double out = sigmoid(sum3);
    return out;
}

void train(Network* net, double * * inputs, size_t inputs_len, size_t* inputs_lens, size_t inputs_lens_len, double * outputs, size_t outputs_len, long long iterations) {
    long long iter = 0LL;
    while (iter < iterations) {
        long long s = 0LL;
        while (s < inputs_len) {
            double *inp = inputs[(int)({long long _mochi_idx = s; _mochi_idx < 0 ? inputs_len + _mochi_idx : _mochi_idx;})];
            size_t inp_len = inputs_lens[(int)(s)];
            double target = outputs[(int)({long long _mochi_idx = s; _mochi_idx < 0 ? outputs_len + _mochi_idx : _mochi_idx;})];
            double *hidden1 = NULL;
            size_t hidden1_len = 0;
            long long j = 0LL;
            while (j < 4LL) {
                double sum1 = 0.0;
                long long i = 0LL;
                while (i < 3LL) {
                    sum1 = sum1 + (inp[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? inp_len + _mochi_idx : _mochi_idx;})] * net->w1[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? net->w1_len + _mochi_idx : _mochi_idx;})][(int)({long long _mochi_idx = j; _mochi_idx < 0 ? net.w1_lens[i] + _mochi_idx : _mochi_idx;})]);
                    i = i + 1LL;
                }
                hidden1 = list_append_double(hidden1, &hidden1_len, sigmoid(sum1));
                j = j + 1LL;
            }
            double *hidden2 = NULL;
            size_t hidden2_len = 0;
            long long k = 0LL;
            while (k < 3LL) {
                double sum2 = 0.0;
                long long j2 = 0LL;
                while (j2 < 4LL) {
                    sum2 = sum2 + (hidden1[(int)({long long _mochi_idx = j2; _mochi_idx < 0 ? hidden1_len + _mochi_idx : _mochi_idx;})] * net->w2[(int)({long long _mochi_idx = j2; _mochi_idx < 0 ? net->w2_len + _mochi_idx : _mochi_idx;})][(int)({long long _mochi_idx = k; _mochi_idx < 0 ? net.w2_lens[j2] + _mochi_idx : _mochi_idx;})]);
                    j2 = j2 + 1LL;
                }
                hidden2 = list_append_double(hidden2, &hidden2_len, sigmoid(sum2));
                k = k + 1LL;
            }
            double sum3 = 0.0;
            long long k3 = 0LL;
            while (k3 < 3LL) {
                sum3 = sum3 + (hidden2[(int)({long long _mochi_idx = k3; _mochi_idx < 0 ? hidden2_len + _mochi_idx : _mochi_idx;})] * net->w3[(int)({long long _mochi_idx = k3; _mochi_idx < 0 ? net->w3_len + _mochi_idx : _mochi_idx;})][(int)({long long _mochi_idx = 0LL; _mochi_idx < 0 ? net.w3_lens[k3] + _mochi_idx : _mochi_idx;})]);
                k3 = k3 + 1LL;
            }
            double output = sigmoid(sum3);
            double error = target - output;
            double delta_output = error * sigmoid_derivative(output);
            double **new_w3 = NULL;
            size_t new_w3_len = 0;
            size_t *new_w3_lens = NULL;
            size_t new_w3_lens_len = 0;
            long long k4 = 0LL;
            while (k4 < 3LL) {
                double *w3row = net->w3[(int)({long long _mochi_idx = k4; _mochi_idx < 0 ? net->w3_len + _mochi_idx : _mochi_idx;})];
                size_t w3row_len = net.w3_lens[k4];
                w3row[(int)(0LL)] = w3row[(int)({long long _mochi_idx = 0LL; _mochi_idx < 0 ? w3row_len + _mochi_idx : _mochi_idx;})] + (hidden2[(int)({long long _mochi_idx = k4; _mochi_idx < 0 ? hidden2_len + _mochi_idx : _mochi_idx;})] * delta_output);
                new_w3 = list_append_doubleptr(new_w3, &new_w3_len, w3row);
                new_w3_lens = list_append_szt(new_w3_lens, &new_w3_lens_len, w3row_len);
                k4 = k4 + 1LL;
            }
            net->w3 = new_w3;
            net->w3_len = new_w3_len;
            net->w3_lens = new_w3_lens;
            net->w3_lens_len = new_w3_lens_len;
            double *delta_hidden2 = NULL;
            size_t delta_hidden2_len = 0;
            long long k5 = 0LL;
            while (k5 < 3LL) {
                double *row = net->w3[(int)({long long _mochi_idx = k5; _mochi_idx < 0 ? net->w3_len + _mochi_idx : _mochi_idx;})];
                size_t row_len = net.w3_lens[k5];
                double dh2 = (row[(int)({long long _mochi_idx = 0LL; _mochi_idx < 0 ? row_len + _mochi_idx : _mochi_idx;})] * delta_output) * sigmoid_derivative(hidden2[(int)({long long _mochi_idx = k5; _mochi_idx < 0 ? hidden2_len + _mochi_idx : _mochi_idx;})]);
                delta_hidden2 = list_append_double(delta_hidden2, &delta_hidden2_len, dh2);
                k5 = k5 + 1LL;
            }
            double **new_w2 = NULL;
            size_t new_w2_len = 0;
            size_t *new_w2_lens = NULL;
            size_t new_w2_lens_len = 0;
            j = 0LL;
            while (j < 4LL) {
                double *w2row = net->w2[(int)({long long _mochi_idx = j; _mochi_idx < 0 ? net->w2_len + _mochi_idx : _mochi_idx;})];
                size_t w2row_len = net.w2_lens[j];
                long long k6 = 0LL;
                while (k6 < 3LL) {
                    w2row[(int)(k6)] = w2row[(int)({long long _mochi_idx = k6; _mochi_idx < 0 ? w2row_len + _mochi_idx : _mochi_idx;})] + (hidden1[(int)({long long _mochi_idx = j; _mochi_idx < 0 ? hidden1_len + _mochi_idx : _mochi_idx;})] * delta_hidden2[(int)({long long _mochi_idx = k6; _mochi_idx < 0 ? delta_hidden2_len + _mochi_idx : _mochi_idx;})]);
                    k6 = k6 + 1LL;
                }
                new_w2 = list_append_doubleptr(new_w2, &new_w2_len, w2row);
                new_w2_lens = list_append_szt(new_w2_lens, &new_w2_lens_len, w2row_len);
                j = j + 1LL;
            }
            net->w2 = new_w2;
            net->w2_len = new_w2_len;
            net->w2_lens = new_w2_lens;
            net->w2_lens_len = new_w2_lens_len;
            double *delta_hidden1 = NULL;
            size_t delta_hidden1_len = 0;
            j = 0LL;
            while (j < 4LL) {
                double sumdh = 0.0;
                long long k7 = 0LL;
                while (k7 < 3LL) {
                    double *row2 = net->w2[(int)({long long _mochi_idx = j; _mochi_idx < 0 ? net->w2_len + _mochi_idx : _mochi_idx;})];
                    size_t row2_len = net.w2_lens[j];
                    sumdh = sumdh + (row2[(int)({long long _mochi_idx = k7; _mochi_idx < 0 ? row2_len + _mochi_idx : _mochi_idx;})] * delta_hidden2[(int)({long long _mochi_idx = k7; _mochi_idx < 0 ? delta_hidden2_len + _mochi_idx : _mochi_idx;})]);
                    k7 = k7 + 1LL;
                }
                delta_hidden1 = list_append_double(delta_hidden1, &delta_hidden1_len, sumdh * sigmoid_derivative(hidden1[(int)({long long _mochi_idx = j; _mochi_idx < 0 ? hidden1_len + _mochi_idx : _mochi_idx;})]));
                j = j + 1LL;
            }
            double **new_w1 = NULL;
            size_t new_w1_len = 0;
            size_t *new_w1_lens = NULL;
            size_t new_w1_lens_len = 0;
            long long i2 = 0LL;
            while (i2 < 3LL) {
                double *w1row = net->w1[(int)({long long _mochi_idx = i2; _mochi_idx < 0 ? net->w1_len + _mochi_idx : _mochi_idx;})];
                size_t w1row_len = net.w1_lens[i2];
                j = 0LL;
                while (j < 4LL) {
                    w1row[(int)(j)] = w1row[(int)({long long _mochi_idx = j; _mochi_idx < 0 ? w1row_len + _mochi_idx : _mochi_idx;})] + (inp[(int)({long long _mochi_idx = i2; _mochi_idx < 0 ? inp_len + _mochi_idx : _mochi_idx;})] * delta_hidden1[(int)({long long _mochi_idx = j; _mochi_idx < 0 ? delta_hidden1_len + _mochi_idx : _mochi_idx;})]);
                    j = j + 1LL;
                }
                new_w1 = list_append_doubleptr(new_w1, &new_w1_len, w1row);
                new_w1_lens = list_append_szt(new_w1_lens, &new_w1_lens_len, w1row_len);
                i2 = i2 + 1LL;
            }
            net->w1 = new_w1;
            net->w1_len = new_w1_len;
            net->w1_lens = new_w1_lens;
            net->w1_lens_len = new_w1_lens_len;
            s = s + 1LL;
        }
        iter = iter + 1LL;
    }
}

long long predict(Network net, double * input, size_t input_len) {
    double out = feedforward(net, input, input_len);
    if (out > 0.6) {
        return 1LL;
    }
    return 0LL;
}

long long example() {
    static double inputs_0[3] = {0.0, 0.0, 0.0};
    static double inputs_1[3] = {0.0, 0.0, 1.0};
    static double inputs_2[3] = {0.0, 1.0, 0.0};
    static double inputs_3[3] = {0.0, 1.0, 1.0};
    static double inputs_4[3] = {1.0, 0.0, 0.0};
    static double inputs_5[3] = {1.0, 0.0, 1.0};
    static double inputs_6[3] = {1.0, 1.0, 0.0};
    static double inputs_7[3] = {1.0, 1.0, 1.0};
    static double *inputs_init[8] = {inputs_0, inputs_1, inputs_2, inputs_3, inputs_4, inputs_5, inputs_6, inputs_7};
    static double **inputs = inputs_init;
    static const size_t inputs_len = 8;
    static size_t inputs_lens_init[8] = {3, 3, 3, 3, 3, 3, 3, 3};
    static size_t *inputs_lens = inputs_lens_init;
    static size_t inputs_lens_len = 8;
    double *outputs = NULL;
    size_t outputs_len = 0;
    outputs = list_append_double(outputs, &outputs_len, 0.0);
    outputs = list_append_double(outputs, &outputs_len, 1.0);
    outputs = list_append_double(outputs, &outputs_len, 1.0);
    outputs = list_append_double(outputs, &outputs_len, 0.0);
    outputs = list_append_double(outputs, &outputs_len, 1.0);
    outputs = list_append_double(outputs, &outputs_len, 0.0);
    outputs = list_append_double(outputs, &outputs_len, 0.0);
    outputs = list_append_double(outputs, &outputs_len, 1.0);
    Network net = new_network();
    train(&net, inputs, inputs_len, inputs_lens, inputs_len, (double[])outputs, outputs_len, 10LL);
    long long result = predict(net, ({double *tmp = malloc(3 * sizeof(double)); tmp[0] = 1.0; tmp[1] = 1.0; tmp[2] = 1.0; tmp;}), 3);
    puts(str_int(result));
    return result;
}

void user_main() {
    example();
}

int main(void) {
    {
        long long __start = _now();
        user_main();
        long long __end = _now();
        long long __dur_us = (__end - __start + 999) / 1000;
        long long __mem_bytes = _mem();
        printf("{\n  \"duration_us\": %-lld,\n  \"memory_bytes\": %-lld,\n  \"name\": \"main\"\n}\n", __dur_us, __mem_bytes);
    }
    return 0;
}
