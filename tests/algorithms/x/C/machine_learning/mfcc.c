// Generated by Mochi 0.10.32 on 2025-08-11 21:16 +0700
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <malloc.h>
#include <math.h>

size_t normalize_len;
size_t dft_len;
size_t triangular_filters_len;
size_t *triangular_filters_lens;
size_t dot_len;
size_t discrete_cosine_transform_len;
size_t *discrete_cosine_transform_lens;
size_t mfcc_len;

static double* list_append_double(double *arr, size_t *len, double val) {
    arr = realloc(arr, (*len + 1) * sizeof(double));
    arr[*len] = val;
    (*len)++;
    return arr;
}

static long long** list_append_intptr(long long **arr, size_t *len, long long *val) {
    arr = realloc(arr, (*len + 1) * sizeof(long long*));
    arr[*len] = val;
    (*len)++;
    return arr;
}

static double** list_append_doubleptr(double **arr, size_t *len, double *val) {
    arr = realloc(arr, (*len + 1) * sizeof(double*));
    arr[*len] = val;
    (*len)++;
    return arr;
}

static size_t* list_append_szt(size_t *arr, size_t *len, size_t val) {
    arr = realloc(arr, (*len + 1) * sizeof(size_t));
    arr[*len] = val;
    (*len)++;
    return arr;
}

#include <time.h>
#include <stdlib.h>
static int seeded_now = 0;
static long long now_seed = 0;
static long long _now(void) {
    if (!seeded_now) {
        const char *s = getenv("MOCHI_NOW_SEED");
        if (s && *s) {
            now_seed = atoll(s);
            seeded_now = 1;
        }
    }
    if (seeded_now) {
        now_seed = (now_seed * 1664525 + 1013904223) % 2147483647;
        return now_seed;
    }
    struct timespec ts;
    clock_gettime(CLOCK_REALTIME, &ts);
    return (long long)(ts.tv_sec * 1000000000LL + ts.tv_nsec);
}

static long long _mem(void) {
    long long size = 0, rss = 0;
    FILE *f = fopen("/proc/self/statm", "r");
    if (f) {
        if (fscanf(f, "%lld %lld", &size, &rss) != 2) rss = 0;
        fclose(f);
    }
    return rss * (long long)sysconf(_SC_PAGESIZE);
}

static void panic(const char *msg) {
    fputs(msg, stderr);
    fputc('\n', stderr);
    exit(1);
}

double PI = 3.141592653589793;
long long sample_rate = 8000LL;
long long size = 16LL;
double *audio = NULL;
size_t audio_len = 0;
long long n = 0LL;
double *coeffs = NULL;
size_t coeffs_len = 0;

double sinApprox(double x);
double cosApprox(double x);
double expApprox(double x);
double ln(double x);
double log10(double x);
double sqrtApprox(double x);
double absf(double x);
double * normalize(double * audio, size_t audio_len);
double * dft(double * frame, size_t frame_len, long long bins);
double * * triangular_filters(long long bins, long long spectrum_size);
double * dot(double * * mat, size_t mat_len, size_t* mat_lens, size_t mat_lens_len, double * vec, size_t vec_len);
double * * discrete_cosine_transform(long long dct_filter_num, long long filter_num);
double * mfcc(double * audio, size_t audio_len, long long bins, long long dct_num);
int main(void);

double sinApprox(double x) {
    double term = x;
    double sum = x;
    long long n = 1LL;
    while (n <= 10LL) {
        double denom = (2LL * n) * ((2LL * n) + 1LL);
        term = ((-(term) * x) * x) / denom;
        sum = sum + term;
        n = n + 1LL;
    }
    return sum;
}

double cosApprox(double x) {
    double term = 1.0;
    double sum = 1.0;
    long long n = 1LL;
    while (n <= 10LL) {
        double denom = ((2LL * n) - 1LL) * (2LL * n);
        term = ((-(term) * x) * x) / denom;
        sum = sum + term;
        n = n + 1LL;
    }
    return sum;
}

double expApprox(double x) {
    double sum = 1.0;
    double term = 1.0;
    long long n = 1LL;
    while (n < 10LL) {
        term = (term * x) / (double)(n);
        sum = sum + term;
        n = n + 1LL;
    }
    return sum;
}

double ln(double x) {
    double t = (x - 1.0) / (x + 1.0);
    double term = t;
    double sum = 0.0;
    long long n = 1LL;
    while (n <= 19LL) {
        sum = sum + (term / (double)(n));
        term = (term * t) * t;
        n = n + 2LL;
    }
    return 2.0 * sum;
}

double log10(double x) {
    return ln(x) / ln(10.0);
}

double sqrtApprox(double x) {
    if (x <= 0.0) {
        return 0.0;
    }
    double guess = x;
    long long i = 0LL;
    while (i < 10LL) {
        guess = (guess + (x / guess)) / 2.0;
        i = i + 1LL;
    }
    return guess;
}

double absf(double x) {
    if (x < 0.0) {
        return -(x);
    }
    return x;
}

double * normalize(double * audio, size_t audio_len) {
    double max_val = 0.0;
    long long i = 0LL;
    while (i < audio_len) {
        double v = absf(audio[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? audio_len + _mochi_idx : _mochi_idx;})]);
        if (v > max_val) {
            max_val = v;
        }
        i = i + 1LL;
    }
    double *res = NULL;
    size_t res_len = 0;
    i = 0LL;
    while (i < audio_len) {
        res = list_append_double(res, &res_len, audio[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? audio_len + _mochi_idx : _mochi_idx;})] / max_val);
        i = i + 1LL;
    }
    return normalize_len = res_len, res;
}

double * dft(double * frame, size_t frame_len, long long bins) {
    long long N = frame_len;
    double *spec = NULL;
    size_t spec_len = 0;
    long long k = 0LL;
    while (k < bins) {
        double real = 0.0;
        double imag = 0.0;
        long long n = 0LL;
        while (n < N) {
            double angle = (((-(2.0) * PI) * (double)(k)) * (double)(n)) / (double)(N);
            real = real + (frame[(int)({long long _mochi_idx = n; _mochi_idx < 0 ? frame_len + _mochi_idx : _mochi_idx;})] * cosApprox(angle));
            imag = imag + (frame[(int)({long long _mochi_idx = n; _mochi_idx < 0 ? frame_len + _mochi_idx : _mochi_idx;})] * sinApprox(angle));
            n = n + 1LL;
        }
        spec = list_append_double(spec, &spec_len, (real * real) + (imag * imag));
        k = k + 1LL;
    }
    return dft_len = spec_len, spec;
}

double * * triangular_filters(long long bins, long long spectrum_size) {
    double **filters = NULL;
    size_t filters_len = 0;
    size_t *filters_lens = NULL;
    size_t filters_lens_len = 0;
    long long b = 0LL;
    while (b < bins) {
        long long center = ((b + 1LL) * spectrum_size) / (bins + 1LL);
        double *filt = NULL;
        size_t filt_len = 0;
        long long i = 0LL;
        while (i < spectrum_size) {
            double v = 0.0;
            if (i <= center) {
                v = (double)(i) / (double)(center);
            } else {
                v = (spectrum_size - i) / (spectrum_size - center);
            }
            filt = list_append_double(filt, &filt_len, v);
            i = i + 1LL;
        }
        filters = list_append_doubleptr(filters, &filters_len, filt);
        filters_lens = list_append_szt(filters_lens, &filters_lens_len, filt_len);
        b = b + 1LL;
    }
    return triangular_filters_lens = filters_lens, triangular_filters_len = filters_len, filters;
}

double * dot(double * * mat, size_t mat_len, size_t* mat_lens, size_t mat_lens_len, double * vec, size_t vec_len) {
    double *res = NULL;
    size_t res_len = 0;
    long long i = 0LL;
    while (i < mat_len) {
        double sum = 0.0;
        long long j = 0LL;
        while (j < vec_len) {
            sum = sum + (mat[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? mat_len + _mochi_idx : _mochi_idx;})][(int)({long long _mochi_idx = j; _mochi_idx < 0 ? mat_lens[i] + _mochi_idx : _mochi_idx;})] * vec[(int)({long long _mochi_idx = j; _mochi_idx < 0 ? vec_len + _mochi_idx : _mochi_idx;})]);
            j = j + 1LL;
        }
        res = list_append_double(res, &res_len, sum);
        i = i + 1LL;
    }
    return dot_len = res_len, res;
}

double * * discrete_cosine_transform(long long dct_filter_num, long long filter_num) {
    double **basis = NULL;
    size_t basis_len = 0;
    size_t *basis_lens = NULL;
    size_t basis_lens_len = 0;
    long long i = 0LL;
    while (i < dct_filter_num) {
        double *row = NULL;
        size_t row_len = 0;
        long long j = 0LL;
        while (j < filter_num) {
            if (i == 0LL) {
                row = list_append_double(row, &row_len, 1.0 / sqrtApprox((double)(filter_num)));
            } else {
                double angle = ((((2LL * j) + 1LL) * (double)(i)) * PI) / (2.0 * (double)(filter_num));
                row = list_append_double(row, &row_len, cosApprox(angle) * sqrtApprox(2.0 / (double)(filter_num)));
            }
            j = j + 1LL;
        }
        basis = list_append_doubleptr(basis, &basis_len, row);
        basis_lens = list_append_szt(basis_lens, &basis_lens_len, row_len);
        i = i + 1LL;
    }
    return discrete_cosine_transform_lens = basis_lens, discrete_cosine_transform_len = basis_len, basis;
}

double * mfcc(double * audio, size_t audio_len, long long bins, long long dct_num) {
    double *norm = normalize(audio, audio_len);
    size_t norm_len = normalize_len;
    double *spec = dft(norm, norm_len, bins + 2LL);
    size_t spec_len = dft_len;
    double **filters = triangular_filters(bins, spec_len);
    size_t filters_len = triangular_filters_len;
    size_t *filters_lens = triangular_filters_lens;
    size_t filters_lens_len = triangular_filters_len;
    double *energies = dot(filters, filters_len, filters_lens, filters_len, spec, spec_len);
    size_t energies_len = dot_len;
    double *logfb = NULL;
    size_t logfb_len = 0;
    long long i = 0LL;
    while (i < energies_len) {
        logfb = list_append_double(logfb, &logfb_len, 10.0 * log10(energies[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? energies_len + _mochi_idx : _mochi_idx;})] + 1e-10));
        i = i + 1LL;
    }
    double **dct_basis = discrete_cosine_transform(dct_num, bins);
    size_t dct_basis_len = discrete_cosine_transform_len;
    size_t *dct_basis_lens = discrete_cosine_transform_lens;
    size_t dct_basis_lens_len = discrete_cosine_transform_len;
    double *res = dot(dct_basis, dct_basis_len, dct_basis_lens, dct_basis_len, logfb, logfb_len);
    size_t res_len = dot_len;
    if (res_len == 0LL) {
        res = ({long long *tmp = malloc(3 * sizeof(long long)); tmp[0] = 0.0; tmp[1] = 0.0; tmp[2] = 0.0; tmp;});
        res_len = 3;
    }
    return mfcc_len = res_len, res;
}

int main(void) {
    {
        long long __start = _now();
        audio = NULL;
        audio_len = 0;
        while (n < size) {
            double t = (double)(n) / (double)(sample_rate);
            audio = list_append_double(audio, &audio_len, sinApprox(((2.0 * PI) * 440.0) * t));
            n = n + 1LL;
        }
        coeffs = mfcc(audio, audio_len, 5LL, 3LL);
        coeffs_len = mfcc_len;
        for (size_t __i = 0; __i < coeffs_len; __i++) {
            double c = coeffs[__i];
            printf("%g\n", c);
        }
        long long __end = _now();
        long long __dur_us = (__end - __start) / 1000;
        long long __mem_bytes = _mem();
        printf("{\n  \"duration_us\": %-lld,\n  \"memory_bytes\": %-lld,\n  \"name\": \"main\"\n}\n", __dur_us, __mem_bytes);
    }
    return 0;
}
