// Generated by Mochi 0.10.32 on 2025-08-14 09:53 +0700
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <malloc.h>
#include <math.h>

size_t iteration_step_len;
size_t iterate_len;

static char* str_concat(const char *a, const char *b) {
    size_t len1 = strlen(a);
    size_t len2 = strlen(b);
    char *res = malloc(len1 + len2 + 1);
    memcpy(res, a, len1);
    memcpy(res + len1, b, len2);
    res[len1 + len2] = 0;
    return res;
}

static char* str_float(double v) {
    char buf[64];
    snprintf(buf, sizeof(buf), "%f", v);
    char *p = buf + strlen(buf) - 1;
    while (p > buf && *p == '0') *p-- = '\0';
    if (p > buf && *p == '.') *p = '\0';
    return strdup(buf);
}

#include <time.h>
static int seeded_now = 0;
static long long now_seed = 0;
static long long _now(void) {
    if (!seeded_now) {
        const char *s = getenv("MOCHI_NOW_SEED");
        if (s && *s) {
            now_seed = atoll(s);
            seeded_now = 1;
        }
    }
    if (seeded_now) {
        now_seed = (now_seed * 1664525 + 1013904223) % 2147483647;
        return now_seed;
    }
    struct timespec ts;
    clock_gettime(CLOCK_REALTIME, &ts);
    return (long long)(ts.tv_sec * 1000000000LL + ts.tv_nsec);
}

static long long _mem(void) {
    long long size = 0, rss = 0;
    FILE *f = fopen("/proc/self/statm", "r");
    if (f) {
        if (fscanf(f, "%lld %lld", &size, &rss) != 2) rss = 0;
        fclose(f);
    }
    return rss * (long long)sysconf(_SC_PAGESIZE);
}

static void panic(const char *msg) {
    fputs(msg, stderr);
    fputc('\n', stderr);
    exit(1);
}

typedef struct Anon1 Anon1;
typedef struct Vec Vec;

struct Anon1 {
    const char* __name;
    double x;
    const char* y;
};

struct Vec {
    double x;
    double y;
};

static Vec* list_append_Vec(Vec *arr, size_t *len, Vec val) {
    arr = realloc(arr, (*len + 1) * sizeof(Vec));
    arr[*len] = val;
    (*len)++;
    return arr;
}

double PI = 3.141592653589793;
double TWO_PI = 6.283185307179586;
Vec VECTOR_1 = (Vec){.x = 0.0, .y = 0.0};
Vec VECTOR_2 = (Vec){.x = 0.5, .y = 0.8660254};
Vec VECTOR_3 = (Vec){.x = 1.0, .y = 0.0};
Vec *INITIAL_VECTORS = NULL;
size_t INITIAL_VECTORS_len = 0;
Vec *example = NULL;
size_t example_len = 0;

double _mod(double x, double m);
double sin(double x);
double cos(double x);
Vec rotate(Vec v, double angle_deg);
Vec * iteration_step(Vec * vectors, size_t vectors_len);
Vec * iterate(Vec * initial, size_t initial_len, long long steps);
const char* vec_to_string(Vec v);
const char* vec_list_to_string(Vec * lst, size_t lst_len);
int main(void);

double _mod(double x, double m) {
    return x - ((double)((int)(x / m)) * m);
}

double sin(double x) {
    double y = _mod(x + PI, TWO_PI) - PI;
    double y2 = y * y;
    double y3 = y2 * y;
    double y5 = y3 * y2;
    double y7 = y5 * y2;
    return ((y - (y3 / 6.0)) + (y5 / 120.0)) - (y7 / 5040.0);
}

double cos(double x) {
    double y = _mod(x + PI, TWO_PI) - PI;
    double y2 = y * y;
    double y4 = y2 * y2;
    double y6 = y4 * y2;
    return ((1.0 - (y2 / 2.0)) + (y4 / 24.0)) - (y6 / 720.0);
}

Vec rotate(Vec v, double angle_deg) {
    double theta = (angle_deg * PI) / 180.0;
    double c = cos(theta);
    double s = sin(theta);
    return (Vec){.x = (v.x * c) - (v.y * s), .y = (v.x * s) + (v.y * c)};
}

Vec * iteration_step(Vec * vectors, size_t vectors_len) {
    Vec *new_vectors = NULL;
    size_t new_vectors_len = 0;
    long long i = 0LL;
    while (i < (vectors_len - 1LL)) {
        Vec start = vectors[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? vectors_len + _mochi_idx : _mochi_idx;})];
        Vec end = vectors[(int)({long long _mochi_idx = i + 1LL; _mochi_idx < 0 ? vectors_len + _mochi_idx : _mochi_idx;})];
        new_vectors = list_append_Vec(new_vectors, &new_vectors_len, start);
        double dx = end.x - start.x;
        double dy = end.y - start.y;
        Vec one_third = (Vec){.x = start.x + (dx / 3.0), .y = start.y + (dy / 3.0)};
        Vec mid = rotate((Vec){.x = dx / 3.0, .y = dy / 3.0}, 60.0);
        Vec peak = (Vec){.x = one_third.x + mid.x, .y = one_third.y + mid.y};
        Vec two_third = (Vec){.x = start.x + ((dx * 2.0) / 3.0), .y = start.y + ((dy * 2.0) / 3.0)};
        new_vectors = list_append_Vec(new_vectors, &new_vectors_len, one_third);
        new_vectors = list_append_Vec(new_vectors, &new_vectors_len, peak);
        new_vectors = list_append_Vec(new_vectors, &new_vectors_len, two_third);
        i = i + 1LL;
    }
    new_vectors = list_append_Vec(new_vectors, &new_vectors_len, vectors[(int)({long long _mochi_idx = vectors_len - 1LL; _mochi_idx < 0 ? vectors_len + _mochi_idx : _mochi_idx;})]);
    return iteration_step_len = new_vectors_len, new_vectors;
}

Vec * iterate(Vec * initial, size_t initial_len, long long steps) {
    Vec *vectors = initial;
    size_t vectors_len = initial_len;
    long long i = 0LL;
    while (i < steps) {
        vectors = iteration_step(vectors, vectors_len);
        vectors_len = iteration_step_len;
        i = i + 1LL;
    }
    return iterate_len = vectors_len, vectors;
}

const char* vec_to_string(Vec v) {
    return str_concat(str_concat(str_concat(str_concat("(", str_float(v.x)), ", "), str_float(v.y)), ")");
}

const char* vec_list_to_string(Vec * lst, size_t lst_len) {
    const char* res = "[";
    long long i = 0LL;
    while (i < lst_len) {
        res = str_concat(res, vec_to_string(lst[(int)({long long _mochi_idx = i; _mochi_idx < 0 ? lst_len + _mochi_idx : _mochi_idx;})]));
        if (i < (lst_len - 1LL)) {
            res = str_concat(res, ", ");
        }
        i = i + 1LL;
    }
    res = str_concat(res, "]");
    return res;
}

int main(void) {
    {
        long long __start = _now();
        INITIAL_VECTORS = ({Vec *tmp = malloc(4 * sizeof(Vec)); tmp[0] = VECTOR_1; tmp[1] = VECTOR_2; tmp[2] = VECTOR_3; tmp[3] = VECTOR_1; tmp;});
        INITIAL_VECTORS_len = 4;
        example = iterate(({Vec *tmp = malloc(2 * sizeof(Vec)); tmp[0] = VECTOR_1; tmp[1] = VECTOR_3; tmp;}), 2, 1LL);
        example_len = iterate_len;
        puts(vec_list_to_string(example, example_len));
        long long __end = _now();
        long long __dur_us = (__end - __start) / 1000;
        long long __mem_bytes = _mem();
        printf("{\n  \"duration_us\": %-lld,\n  \"memory_bytes\": %-lld,\n  \"name\": \"main\"\n}\n", __dur_us, __mem_bytes);
    }
    return 0;
}
