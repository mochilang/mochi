// Generated by Mochi transpiler
import 'dart:convert';
import 'dart:io';

int _nowSeed = 0;
bool _nowSeeded = false;
void _initNow() {
  var s = Platform.environment['MOCHI_NOW_SEED'];
  if (s != null && s.isNotEmpty) {
    var v = int.tryParse(s);
    if (v != null) {
      _nowSeed = v;
      _nowSeeded = true;
    }
  }
}
int _now() {
  if (_nowSeeded) {
    _nowSeed = (_nowSeed * 1664525 + 1013904223) % 2147483647;
    return _nowSeed;
  }
  return DateTime.now().microsecondsSinceEpoch;
}

String _substr(String s, num start, num end) {
  var n = s.length;
  int s0 = start.toInt();
  int e0 = end.toInt();
  if (s0 < 0) s0 += n;
  if (e0 < 0) e0 += n;
  if (s0 < 0) s0 = 0;
  if (s0 > n) s0 = n;
  if (e0 < 0) e0 = 0;
  if (e0 > n) e0 = n;
  if (s0 > e0) s0 = e0;
  return s.substring(s0, e0);
}

double PI = 3.141592653589793;
double to_radians(double deg) {
  return deg * PI / 180.0;
}

double sin_taylor(double x) {
  double term = x;
  double sum = x;
  int i = 1;
  while (i < 10) {
    double k1 = 2.0 * (i as double);
    double k2 = k1 + 1.0;
    term = -term * x * x / (k1 * k2);
    sum = sum + term;
    i = i + 1;
  }
  return sum;
}

double cos_taylor(double x) {
  double term = 1.0;
  double sum = 1.0;
  int i = 1;
  while (i < 10) {
    double k1 = 2.0 * (i as double) - 1.0;
    double k2 = 2.0 * (i as double);
    term = -term * x * x / (k1 * k2);
    sum = sum + term;
    i = i + 1;
  }
  return sum;
}

double exp_taylor(double x) {
  double term = 1.0;
  double sum = 1.0;
  double i = 1.0;
  while (i < 20.0) {
    term = term * x / i;
    sum = sum + term;
    i = i + 1.0;
  }
  return sum;
}

List<List<double>> gabor_filter_kernel(int ksize, double sigma, double theta, double lambd, double gamma, double psi) {
  int size = ksize;
  if (size % 2 == 0) {
    size = size + 1;
  }
  List<List<double>> gabor = <List<double>>[];
  int y = 0;
  while (y < size) {
    List<double> row = <double>[];
    int x = 0;
    while (x < size) {
    double px = x - size ~/ 2 as double;
    double py = y - size ~/ 2 as double;
    double rad = to_radians(theta);
    double cos_theta = cos_taylor(rad);
    double sin_theta = sin_taylor(rad);
    double x_rot = cos_theta * px + sin_theta * py;
    double y_rot = -sin_theta * px + cos_theta * py;
    double exponent = -(x_rot * x_rot + gamma * gamma * y_rot * y_rot) / (2.0 * sigma * sigma);
    double value = exp_taylor(exponent) * cos_taylor(2.0 * PI * x_rot / lambd + psi);
    row = [...row, value];
    x = x + 1;
  }
    gabor = ([...gabor, row] as List).map((e) => (List<double>.from(e) as List<double>)).toList();
    y = y + 1;
  }
  return gabor;
}

List<List<double>> kernel = gabor_filter_kernel(3, 8.0, 0.0, 10.0, 0.0, 0.0);
void main() {
  var _benchMem0 = ProcessInfo.currentRss;
  var _benchSw = Stopwatch()..start();
  _initNow();
  {
  var _benchMem0 = ProcessInfo.currentRss;
  var _benchSw = Stopwatch()..start();
  print("[" + kernel.join(', ') + "]");
  _benchSw.stop();
  var _benchMem1 = ProcessInfo.currentRss;
  print(jsonEncode({"duration_us": _benchSw.elapsedMicroseconds, "memory_bytes": (_benchMem1 - _benchMem0).abs(), "name": "main"}));
}
  _benchSw.stop();
  var _benchMem1 = ProcessInfo.currentRss;
  print(jsonEncode({"duration_us": _benchSw.elapsedMicroseconds, "memory_bytes": (_benchMem1 - _benchMem0).abs(), "name": "main"}));
}
