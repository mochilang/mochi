// Generated by Mochi transpiler
String _substr(String s, num start, num end) {
  var n = s.length;
  int s0 = start.toInt();
  int e0 = end.toInt();
  if (s0 < 0) s0 += n;
  if (e0 < 0) e0 += n;
  if (s0 < 0) s0 = 0;
  if (s0 > n) s0 = n;
  if (e0 < 0) e0 = 0;
  if (e0 > n) e0 = n;
  if (s0 > e0) s0 = e0;
  return s.substring(s0, e0);
}

BigInt NIL = BigInt.from(0 - 1);
List<Map<String, int>> nodes = <Map<String, int>>[];
int new_node(int value) {
  Map<String, int> node = {"data": value, "left": NIL, "right": NIL, "height": 1};
  nodes = [...nodes, node];
  return nodes.length - 1;
}

int get_height(int i) {
  if (BigInt.from(i) == NIL) {
    return 0;
  }
  return (nodes[i]["height"])!;
}

int my_max(int a, int b) {
  if (a > b) {
    return a;
  }
  return b;
}

void update_height(int i) {
  nodes[i]!["height"] = my_max(get_height(nodes[i]["left"]!), get_height(nodes[i]["right"]!)) + 1;
}

int right_rotation(int i) {
  int left = nodes[i]["left"]!;
  nodes[i]!["left"] = nodes[left]["right"]!;
  nodes[left]!["right"] = i;
  update_height(i);
  update_height(left);
  return left;
}

int left_rotation(int i) {
  int right = nodes[i]["right"]!;
  nodes[i]!["right"] = nodes[right]["left"]!;
  nodes[right]!["left"] = i;
  update_height(i);
  update_height(right);
  return right;
}

int lr_rotation(int i) {
  nodes[i]!["left"] = left_rotation(nodes[i]["left"]!);
  return right_rotation(i);
}

int rl_rotation(int i) {
  nodes[i]!["right"] = right_rotation(nodes[i]["right"]!);
  return left_rotation(i);
}

int insert_node(int i, int value) {
  if (BigInt.from(i) == NIL) {
    return new_node(value);
  }
  if (value < nodes[i]["data"]!) {
    nodes[i]!["left"] = insert_node(nodes[i]["left"]!, value);
    if (get_height(nodes[i]["left"]!) - get_height(nodes[i]["right"]!) == 2) {
    if (value < nodes[nodes[i]["left"]]["data"]!) {
    i = right_rotation(i);
  } else {
    i = lr_rotation(i);
  };
  };
  } else {
    nodes[i]!["right"] = insert_node(nodes[i]["right"]!, value);
    if (get_height(nodes[i]["right"]!) - get_height(nodes[i]["left"]!) == 2) {
    if (value < nodes[nodes[i]["right"]]["data"]!) {
    i = rl_rotation(i);
  } else {
    i = left_rotation(i);
  };
  };
  }
  update_height(i);
  return i;
}

int get_left_most(int i) {
  int cur = i;
  while (nodes[cur]["left"]! != NIL) {
    cur = nodes[cur]["left"]!;
  }
  return (nodes[cur]["data"])!;
}

int del_node(int i, int value) {
  if (BigInt.from(i) == NIL) {
    return (NIL).toInt();
  }
  if (value < nodes[i]["data"]!) {
    nodes[i]!["left"] = del_node(nodes[i]["left"]!, value);
  } else {
    if (value > nodes[i]["data"]!) {
    nodes[i]!["right"] = del_node(nodes[i]["right"]!, value);
  } else {
    if (nodes[i]["left"]! != NIL && nodes[i]["right"]! != NIL) {
    int temp = get_left_most(nodes[i]["right"]!);
    nodes[i]!["data"] = temp;
    nodes[i]!["right"] = del_node(nodes[i]["right"]!, temp);
  } else {
    if (nodes[i]["left"]! != NIL) {
    i = nodes[i]["left"]!;
  } else {
    i = nodes[i]["right"]!;
  };
  };
  };
  }
  if (BigInt.from(i) == NIL) {
    return (NIL).toInt();
  }
  int lh = get_height(nodes[i]["left"]!);
  int rh = get_height(nodes[i]["right"]!);
  if (rh - lh == 2) {
    if (get_height(nodes[nodes[i]["right"]]["right"]!) > get_height(nodes[nodes[i]["right"]]["left"]!)) {
    i = left_rotation(i);
  } else {
    i = rl_rotation(i);
  };
  } else {
    if (lh - rh == 2) {
    if (get_height(nodes[nodes[i]["left"]]["left"]!) > get_height(nodes[nodes[i]["left"]]["right"]!)) {
    i = right_rotation(i);
  } else {
    i = lr_rotation(i);
  };
  };
  }
  update_height(i);
  return i;
}

String inorder(int i) {
  if (BigInt.from(i) == NIL) {
    return "";
  }
  String left = inorder(nodes[i]["left"]!);
  String right = inorder(nodes[i]["right"]!);
  String res = (nodes[i]["data"]).toString();
  if (left != "") {
    res = left + " " + res;
  }
  if (right != "") {
    res = res + " " + right;
  }
  return res;
}

void _main() {
  nodes = List<Map<String, int>>.from([]);
  BigInt root = NIL;
  root = BigInt.from(insert_node((root).toInt(), 4));
  root = BigInt.from(insert_node((root).toInt(), 2));
  root = BigInt.from(insert_node((root).toInt(), 3));
  print(inorder((root).toInt()));
  print((get_height((root).toInt())).toString());
  root = BigInt.from(del_node((root).toInt(), 3));
  print(inorder((root).toInt()));
}

void _start() {
  _main();
}

void main() => _start();
