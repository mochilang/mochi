// Generated by Mochi TypeScript compiler

type Msg = {
	message: string;
}

function main(): void {
	let data: Msg = _fetch("file://tests/compiler/ts/fetch_builtin.json", undefined)
	;(globalThis as any).data = data
	console.log(data.message)
}
function _fetch(url: string, opts: any): any {
  const args: string[] = ['-s'];
  const method = opts?.method ?? 'GET';
  args.push('-X', method);
  if (opts?.headers) {
    for (const [k, v] of Object.entries(_toAnyMap(opts.headers))) {
      args.push('-H', `${k}: ${String(v)}`);
    }
  }
  if (opts?.query) {
    const qs = new URLSearchParams();
    for (const [k, v] of Object.entries(_toAnyMap(opts.query))) {
      qs.set(k, String(v));
    }
    const sep = url.includes('?') ? '&' : '?';
    url = url + sep + qs.toString();
  }
  if (opts && 'body' in opts) {
    args.push('-d', JSON.stringify(opts.body));
  }
  if (opts?.timeout) {
    args.push('--max-time', String(opts.timeout));
  }
  args.push(url);
  const { stdout } = new Deno.Command('curl', { args }).outputSync();
  return JSON.parse(new TextDecoder().decode(stdout));
}

main()
