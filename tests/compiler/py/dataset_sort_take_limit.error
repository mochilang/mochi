generated code does not match expected
--- expected
+++ generated
@@ -1,26 +1,17 @@
-// dataset-sort-take-limit.mochi
-
 type Product {
   name: string
   price: int
 }
-
-let products = [
-  Product { name: "Laptop", price: 1500 },
-  Product { name: "Smartphone", price: 900 },
-  Product { name: "Tablet", price: 600 },
-  Product { name: "Monitor", price: 300 },
-  Product { name: "Keyboard", price: 100 },
-  Product { name: "Mouse", price: 50 },
-  Product { name: "Headphones", price: 200 }
-]
-
-let expensive = from p in products
-                sort by -p.price
-                skip 1
-                take 3
-                select p
-
+fun _sort_key(k: any): any {
+  if isinstance(k, (list, tuple, dict)) {
+    return str(k)
+  }
+  return k
+}
+let products = [Product { name: "Laptop", price: 1500 }, Product { name: "Smartphone", price: 900 }, Product { name: "Tablet", price: 600 }, Product { name: "Monitor", price: 300 }, Product { name: "Keyboard", price: 100 }, Product { name: "Mouse", price: 50 }, Product { name: "Headphones", price: 200 }]
+let expensive = from p in sorted(from p in products
+            select p, key: fun(p) => _sort_key(-p.price))[max(1, 0):][:max(3, 0)]
+            select p
 print("--- Top products (excluding most expensive) ---")
 for item in expensive {
   print(item.name, "costs $", item.price)
