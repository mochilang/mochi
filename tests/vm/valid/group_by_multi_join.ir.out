func main (regs=99)
  // let nations = [
  Const        r0, [{"id": 1, "name": "A"}, {"id": 2, "name": "B"}]
  // let suppliers = [
  Const        r1, [{"id": 1, "nation": 1}, {"id": 2, "nation": 2}]
  // let partsupp = [
  Const        r2, [{"cost": 10, "part": 100, "qty": 2, "supplier": 1}, {"cost": 20, "part": 100, "qty": 1, "supplier": 2}, {"cost": 5, "part": 200, "qty": 3, "supplier": 1}]
  // from ps in partsupp
  Const        r3, []
  IterPrep     r4, r2
  Len          r5, r4
  Const        r7, 0
  Move         r6, r7
L6:
  Less         r8, r6, r5
  JumpIfFalse  r8, L0
  Index        r10, r4, r6
  // join s in suppliers on s.id == ps.supplier
  IterPrep     r11, r1
  Len          r12, r11
  Const        r13, "id"
  Const        r14, "supplier"
  // where n.name == "A"
  Const        r15, "name"
  // part: ps.part,
  Const        r16, "part"
  // value: ps.cost * ps.qty
  Const        r17, "value"
  Const        r18, "cost"
  Const        r19, "qty"
  // join s in suppliers on s.id == ps.supplier
  Move         r20, r7
L5:
  LessInt      r21, r20, r12
  JumpIfFalse  r21, L1
  Index        r23, r11, r20
  Index        r24, r23, r13
  Index        r25, r10, r14
  Equal        r26, r24, r25
  JumpIfFalse  r26, L2
  // join n in nations on n.id == s.nation
  IterPrep     r27, r0
  Len          r28, r27
  Const        r29, "nation"
  Move         r30, r7
L4:
  LessInt      r31, r30, r28
  JumpIfFalse  r31, L2
  Index        r33, r27, r30
  Index        r34, r33, r13
  Index        r35, r23, r29
  Equal        r36, r34, r35
  JumpIfFalse  r36, L3
  // where n.name == "A"
  Index        r37, r33, r15
  Const        r38, "A"
  Equal        r39, r37, r38
  JumpIfFalse  r39, L3
  // select {
  MakeMap      r46, 2, r16
  // from ps in partsupp
  Append       r3, r3, r46
L3:
  // join n in nations on n.id == s.nation
  Const        r48, 1
  Add          r30, r30, r48
  Jump         L4
L2:
  // join s in suppliers on s.id == ps.supplier
  Add          r20, r20, r48
  Jump         L5
L1:
  // from ps in partsupp
  Add          r6, r6, r48
  Jump         L6
L0:
  // from x in filtered
  Const        r50, []
  IterPrep     r51, r3
  Len          r52, r51
  Const        r53, 0
  MakeMap      r54, 0, r0
  Const        r55, []
L9:
  Less         r56, r53, r52
  JumpIfFalse  r56, L7
  Index        r57, r51, r53
  // group by x.part into g
  Index        r59, r57, r16
  Str          r60, r59
  In           r61, r60, r54
  JumpIfTrue   r61, L8
  // from x in filtered
  Const        r62, []
  Const        r63, "__group__"
  Const        r64, true
  Const        r65, "key"
  // group by x.part into g
  Move         r66, r59
  // from x in filtered
  Const        r67, "items"
  Move         r68, r62
  MakeMap      r69, 3, r63
  SetIndex     r54, r60, r69
  Append       r55, r55, r69
L8:
  Index        r71, r54, r60
  Index        r72, r71, r67
  Append       r73, r72, r57
  SetIndex     r71, r67, r73
  Add          r53, r53, r48
  Jump         L9
L7:
  Move         r75, r7
  Len          r76, r55
L13:
  Less         r77, r75, r76
  JumpIfFalse  r77, L10
  Index        r79, r55, r75
  // total: sum(from r in g select r.value)
  Const        r82, []
  IterPrep     r83, r79
  Len          r84, r83
  Const        r85, 0
L12:
  Less         r86, r85, r84
  JumpIfFalse  r86, L11
  Index        r88, r83, r85
  Index        r89, r88, r17
  Append       r82, r82, r89
  Const        r91, 1
  Add          r85, r85, r91
  Jump         L12
L11:
  // select {
  MakeMap      r96, 2, r16
  // from x in filtered
  Append       r50, r50, r96
  Add          r75, r75, r48
  Jump         L13
L10:
  // print(grouped)
  Print        r50
  Return       r0
