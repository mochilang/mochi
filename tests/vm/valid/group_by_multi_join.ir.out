func main (regs=116)
  // let nations = [
  Const        r0, [{"id": 1, "name": "A"}, {"id": 2, "name": "B"}]
  // let suppliers = [
  Const        r1, [{"id": 1, "nation": 1}, {"id": 2, "nation": 2}]
  // let partsupp = [
  Const        r2, [{"cost": 10, "part": 100, "qty": 2, "supplier": 1}, {"cost": 20, "part": 100, "qty": 1, "supplier": 2}, {"cost": 5, "part": 200, "qty": 3, "supplier": 1}]
  // from ps in partsupp
  Const        r3, []
  // where n.name == "A"
  Const        r4, "name"
  // part: ps.part,
  Const        r5, "part"
  // value: ps.cost * ps.qty
  Const        r6, "value"
  Const        r7, "cost"
  Const        r8, "qty"
  // from ps in partsupp
  IterPrep     r9, r2
  Len          r10, r9
  Const        r12, 0
  Move         r11, r12
L6:
  LessInt      r13, r11, r10
  JumpIfFalse  r13, L0
  Index        r15, r9, r11
  // join s in suppliers on s.id == ps.supplier
  IterPrep     r16, r1
  Len          r17, r16
  Const        r18, "id"
  Const        r19, "supplier"
  Move         r20, r12
L5:
  LessInt      r21, r20, r17
  JumpIfFalse  r21, L1
  Index        r23, r16, r20
  Index        r24, r23, r18
  Index        r25, r15, r19
  Equal        r26, r24, r25
  JumpIfFalse  r26, L2
  // join n in nations on n.id == s.nation
  IterPrep     r27, r0
  Len          r28, r27
  Const        r29, "nation"
  Move         r30, r12
L4:
  LessInt      r31, r30, r28
  JumpIfFalse  r31, L2
  Index        r33, r27, r30
  Index        r34, r33, r18
  Index        r35, r23, r29
  Equal        r36, r34, r35
  JumpIfFalse  r36, L3
  // where n.name == "A"
  Index        r37, r33, r4
  Const        r38, "A"
  Equal        r39, r37, r38
  JumpIfFalse  r39, L3
  // part: ps.part,
  Move         r40, r5
  Index        r41, r15, r5
  // value: ps.cost * ps.qty
  Move         r42, r6
  Index        r43, r15, r7
  Index        r44, r15, r8
  Mul          r45, r43, r44
  // part: ps.part,
  Move         r46, r40
  Move         r47, r41
  // value: ps.cost * ps.qty
  Move         r48, r42
  Move         r49, r45
  // select {
  MakeMap      r50, 2, r46
  // from ps in partsupp
  Append       r3, r3, r50
L3:
  // join n in nations on n.id == s.nation
  Const        r52, 1
  Add          r30, r30, r52
  Jump         L4
L2:
  // join s in suppliers on s.id == ps.supplier
  Add          r20, r20, r52
  Jump         L5
L1:
  // from ps in partsupp
  AddInt       r11, r11, r52
  Jump         L6
L0:
  // from x in filtered
  Const        r53, []
  // part: g.key,
  Const        r54, "key"
  // total: sum(from r in g select r.value)
  Const        r55, "total"
  // from x in filtered
  IterPrep     r56, r3
  Len          r57, r56
  Move         r58, r12
  MakeMap      r59, 0, r0
L9:
  LessInt      r60, r58, r57
  JumpIfFalse  r60, L7
  Index        r61, r56, r58
  // group by x.part into g
  Index        r63, r61, r5
  Str          r64, r63
  In           r65, r64, r59
  JumpIfTrue   r65, L8
  // from x in filtered
  Move         r66, r53
  Const        r67, "__group__"
  Const        r68, true
  Move         r69, r54
  // group by x.part into g
  Move         r70, r63
  // from x in filtered
  Const        r71, "items"
  Move         r72, r66
  Const        r73, "count"
  Move         r74, r12
  Move         r75, r67
  Move         r76, r68
  Move         r77, r69
  Move         r78, r70
  Move         r79, r71
  Move         r80, r72
  Move         r81, r73
  Move         r82, r74
  MakeMap      r83, 4, r75
  SetIndex     r59, r64, r83
L8:
  Move         r84, r71
  Index        r85, r59, r64
  Index        r86, r85, r84
  Append       r87, r86, r61
  SetIndex     r85, r84, r87
  Move         r88, r73
  Index        r89, r85, r88
  AddInt       r90, r89, r52
  SetIndex     r85, r88, r90
  AddInt       r58, r58, r52
  Jump         L9
L7:
  Values       91,59,0,0
  Move         r92, r12
  Len          r93, r91
L13:
  LessInt      r94, r92, r93
  JumpIfFalse  r94, L10
  Index        r96, r91, r92
  // part: g.key,
  Move         r97, r5
  Index        r98, r96, r54
  // total: sum(from r in g select r.value)
  Move         r99, r55
  Move         r100, r53
  IterPrep     r101, r96
  Len          r102, r101
  Move         r103, r12
L12:
  LessInt      r104, r103, r102
  JumpIfFalse  r104, L11
  Index        r106, r101, r103
  Index        r107, r106, r6
  Append       r100, r100, r107
  AddInt       r103, r103, r52
  Jump         L12
L11:
  Sum          r109, r100
  // part: g.key,
  Move         r110, r97
  Move         r111, r98
  // total: sum(from r in g select r.value)
  Move         r112, r99
  Move         r113, r109
  // select {
  MakeMap      r114, 2, r110
  // from x in filtered
  Append       r53, r53, r114
  AddInt       r92, r92, r52
  Jump         L13
L10:
  // print(grouped)
  Print        r53
  Return       r0
