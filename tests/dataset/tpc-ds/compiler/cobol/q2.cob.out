>>SOURCE FORMAT FREE
IDENTIFICATION DIVISION.
PROGRAM-ID. MAIN.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WEB_SALES OCCURS 0 TIMES PIC 9.
01 CATALOG_SALES OCCURS 0 TIMES PIC 9.
01 DATE_DIM OCCURS 0 TIMES PIC 9.
01 WSCS PIC 9.
01 WS PIC 9.
01 TMP0 OCCURS 0 TIMES PIC 9.
01 TMP1 PIC 9.
01 TMP2 PIC 9.
01 IDX PIC 9.
01 CS PIC 9.
01 TMP3 OCCURS 0 TIMES PIC 9.
01 TMP4 PIC 9.
01 TMP5 PIC 9.
01 W PIC 9.
01 D PIC 9.
01 WSWSCS OCCURS 0 TIMES PIC 9.
01 TMP6 PIC 9.
01 TMP7 PIC 9.
01 IDX2 PIC 9.
01 RESULT OCCURS 0 TIMES PIC 9.
01 TMP8 PIC 9.

PROCEDURE DIVISION.
    MOVE 0 TO TMP1
    MOVE 0 TO TMP2
    MOVE 0 TO IDX
    PERFORM VARYING IDX FROM 0 BY 1 UNTIL IDX >= 0
    MOVE WEB_SALES(IDX + 1) TO WS
    ADD 1 TO TMP2
    IF TMP2 > 0
        IF 0 = 0 OR TMP1 < 0
            ADD 1 TO TMP1
            COMPUTE TMP0(TMP1) = 0
        END-IF
    END-IF
    END-PERFORM
    MOVE 0 TO TMP4
    MOVE 0 TO TMP5
    MOVE 0 TO IDX
    PERFORM VARYING IDX FROM 0 BY 1 UNTIL IDX >= 0
    MOVE CATALOG_SALES(IDX + 1) TO CS
    ADD 1 TO TMP5
    IF TMP5 > 0
        IF 0 = 0 OR TMP4 < 0
            ADD 1 TO TMP4
            COMPUTE TMP3(TMP4) = 0
        END-IF
    END-IF
    END-PERFORM
    COMPUTE WSCS = (TMP0) union_all (TMP3)
    MOVE 0 TO TMP6
    MOVE 0 TO TMP7
    MOVE 0 TO IDX
    PERFORM VARYING IDX FROM 0 BY 1 UNTIL IDX >= 0
    MOVE WSCS(IDX + 1) TO W
        MOVE 0 TO IDX2
        PERFORM VARYING IDX2 FROM 0 BY 1 UNTIL IDX2 >= 0
        MOVE DATE_DIM(IDX2 + 1) TO D
        IF W_SOLD_DATE_SK = D_D_DATE_SK
            ADD 1 TO TMP7
            IF TMP7 > 0
                IF 0 = 0 OR TMP6 < 0
                    ADD 1 TO TMP6
                    COMPUTE WSWSCS(TMP6) = 0
                END-IF
            END-IF
        END-IF
        END-PERFORM
    END-PERFORM
DISPLAY "-- TEST TPCDS Q2 empty --"
    COMPUTE TMP8 = 0
IF NOT (TMP8 = 0)
    DISPLAY "expect failed"
    STOP RUN
END-IF
DISPLAY "-- END TPCDS Q2 empty --"
    STOP RUN.
