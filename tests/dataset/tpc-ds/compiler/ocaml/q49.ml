(* Generated by Mochi compiler v0.10.25 on 2025-07-15T04:50:17Z *)
type record1 = { mutable item : string; mutable return_ratio : float; mutable currency_ratio : float; mutable return_rank : int; mutable currency_rank : int }
type record2 = { mutable channel : string; mutable item : string; mutable return_ratio : float; mutable return_rank : int; mutable currency_rank : int }

let web : record1 list = [{ item = "A"; return_ratio = 0.2; currency_ratio = 0.3; return_rank = 1; currency_rank = 1 };{ item = "B"; return_ratio = 0.5; currency_ratio = 0.6; return_rank = 2; currency_rank = 2 }]
let catalog : record1 list = [{ item = "A"; return_ratio = 0.3; currency_ratio = 0.4; return_rank = 1; currency_rank = 1 }]
let store : record1 list = [{ item = "A"; return_ratio = 0.25; currency_ratio = 0.35; return_rank = 1; currency_rank = 1 }]
let tmp : Obj.t list = (concat (let __res0 = ref [] in
  List.iter (fun (w : record1) ->
      if ((w.return_rank <= 10) || (w.currency_rank <= 10)) then
    __res0 := { channel = "web"; item = w.item; return_ratio = w.return_ratio; return_rank = w.return_rank; currency_rank = w.currency_rank } :: !__res0;
  ) web;
List.rev !__res0)
 (let __res1 = ref [] in
  List.iter (fun (c : record1) ->
      if ((c.return_rank <= 10) || (c.currency_rank <= 10)) then
    __res1 := { channel = "catalog"; item = c.item; return_ratio = c.return_ratio; return_rank = c.return_rank; currency_rank = c.currency_rank } :: !__res1;
  ) catalog;
List.rev !__res1)
 (let __res2 = ref [] in
  List.iter (fun (s : record1) ->
      if ((s.return_rank <= 10) || (s.currency_rank <= 10)) then
    __res2 := { channel = "store"; item = s.item; return_ratio = s.return_ratio; return_rank = s.return_rank; currency_rank = s.currency_rank } :: !__res2;
  ) store;
List.rev !__res2)
)
let result : Obj.t list = (let __res3 = ref [] in
  List.iter (fun r ->
      __res3 := r :: !__res3;
  ) tmp;
List.rev !__res3)


let () =
  json result;
  assert ((result = [{ channel = "catalog"; item = "A"; return_ratio = 0.3; return_rank = 1; currency_rank = 1 };{ channel = "store"; item = "A"; return_ratio = 0.25; return_rank = 1; currency_rank = 1 };{ channel = "web"; item = "A"; return_ratio = 0.2; return_rank = 1; currency_rank = 1 };{ channel = "web"; item = "B"; return_ratio = 0.5; return_rank = 2; currency_rank = 2 }]))
