require "ostruct"

def _json(v)
  require "json"
  obj = v
  if v.is_a?(Array)
    obj = v.map { |it| it.respond_to?(:to_h) ? it.to_h : it }
  elsif v.respond_to?(:to_h)
    obj = v.to_h
  end
  puts(JSON.generate(obj))
end

item = [OpenStruct.new(product_name: "Blue Shirt", manufact_id: 100, manufact: 1, category: "Women", color: "blue", units: "pack", size: "M"), OpenStruct.new(product_name: "Red Dress", manufact_id: 120, manufact: 1, category: "Women", color: "red", units: "pack", size: "M"), OpenStruct.new(product_name: "Pants", manufact_id: 200, manufact: 2, category: "Men", color: "black", units: "pair", size: "L")]
lower = 100
result = ((item.select { |i1| (i1.manufact_id >= lower) && (i1.manufact_id <= (lower + 40)) && (((item.select { |i2| (i2.manufact == i1.manufact) && (i2.category == i1.category) }).map { |i2| i2 }).length > 1) }).sort_by { |i1| i1.product_name }).map { |i1| i1.product_name }
_json(result)
raise "expect failed" unless result == ["Blue Shirt", "Red Dress"]
