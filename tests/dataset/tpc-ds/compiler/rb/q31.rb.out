# Generated by Mochi compiler v0.10.25 on 2025-07-15T04:48:29Z
require 'ostruct'

def _json(v)
  require 'json'
  obj = v
  if v.is_a?(Array)
    obj = v.map { |it| it.respond_to?(:to_h) ? it.to_h : it }
  elsif v.respond_to?(:to_h)
    obj = v.to_h
  end
  puts(JSON.generate(obj))
end
def _sum(v)
  list = nil
  if defined?(MGroup) && v.is_a?(MGroup)
    list = v.Items
  elsif v.is_a?(Array)
    list = v
  elsif v.respond_to?(:to_a)
    list = v.to_a
  end
  return 0 if !list || list.empty?
  s = 0.0
  list.each { |n| s += n.to_f }
  s
end

$store_sales = [OpenStruct.new(ca_county: "A", d_qoy: 1, d_year: 2000, ss_ext_sales_price: 100.0), OpenStruct.new(ca_county: "A", d_qoy: 2, d_year: 2000, ss_ext_sales_price: 120.0), OpenStruct.new(ca_county: "A", d_qoy: 3, d_year: 2000, ss_ext_sales_price: 160.0), OpenStruct.new(ca_county: "B", d_qoy: 1, d_year: 2000, ss_ext_sales_price: 80.0), OpenStruct.new(ca_county: "B", d_qoy: 2, d_year: 2000, ss_ext_sales_price: 90.0), OpenStruct.new(ca_county: "B", d_qoy: 3, d_year: 2000, ss_ext_sales_price: 100.0)]
$web_sales = [OpenStruct.new(ca_county: "A", d_qoy: 1, d_year: 2000, ws_ext_sales_price: 100.0), OpenStruct.new(ca_county: "A", d_qoy: 2, d_year: 2000, ws_ext_sales_price: 150.0), OpenStruct.new(ca_county: "A", d_qoy: 3, d_year: 2000, ws_ext_sales_price: 250.0), OpenStruct.new(ca_county: "B", d_qoy: 1, d_year: 2000, ws_ext_sales_price: 80.0), OpenStruct.new(ca_county: "B", d_qoy: 2, d_year: 2000, ws_ext_sales_price: 90.0), OpenStruct.new(ca_county: "B", d_qoy: 3, d_year: 2000, ws_ext_sales_price: 95.0)]
$counties = ["A", "B"]
$result = []
$counties.each do |county|
	ss1 = _sum(((($store_sales)).select { |s| ((s.ca_county == county) && (s.d_qoy == 1)) }).map { |s| s.ss_ext_sales_price })
	ss2 = _sum(((($store_sales)).select { |s| ((s.ca_county == county) && (s.d_qoy == 2)) }).map { |s| s.ss_ext_sales_price })
	ss3 = _sum(((($store_sales)).select { |s| ((s.ca_county == county) && (s.d_qoy == 3)) }).map { |s| s.ss_ext_sales_price })
	ws1 = _sum(((($web_sales)).select { |w| ((w.ca_county == county) && (w.d_qoy == 1)) }).map { |w| w.ws_ext_sales_price })
	ws2 = _sum(((($web_sales)).select { |w| ((w.ca_county == county) && (w.d_qoy == 2)) }).map { |w| w.ws_ext_sales_price })
	ws3 = _sum(((($web_sales)).select { |w| ((w.ca_county == county) && (w.d_qoy == 3)) }).map { |w| w.ws_ext_sales_price })
	web_g1 = (ws2 / ws1)
	store_g1 = (ss2 / ss1)
	web_g2 = (ws3 / ws2)
	store_g2 = (ss3 / ss2)
	if ((web_g1 > store_g1) && (web_g2 > store_g2))
		$result = ($result + [OpenStruct.new(ca_county: county, d_year: 2000, web_q1_q2_increase: web_g1, store_q1_q2_increase: store_g1, web_q2_q3_increase: web_g2, store_q2_q3_increase: store_g2)])
	end
end
_json($result)
raise "expect failed" unless ($result == [OpenStruct.new(ca_county: "A", d_year: 2000, web_q1_q2_increase: 1.5, store_q1_q2_increase: 1.2, web_q2_q3_increase: 1.6666666666666667, store_q2_q3_increase: 1.3333333333333333)])
