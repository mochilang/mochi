# Generated by Mochi compiler v0.10.27 on 2025-07-17T06:41:32Z
require 'ostruct'

def _json(v)
  require 'json'
  obj = v
  if v.is_a?(Array)
    obj = v.map { |it| it.respond_to?(:to_h) ? it.to_h : it }
  elsif v.respond_to?(:to_h)
    obj = v.to_h
  end
  puts(JSON.generate(obj))
end

$sales_year1 = [OpenStruct.new(week: 1, store: 1, amount: 100.0)]
$sales_year2 = [OpenStruct.new(week: 53, store: 1, amount: 150.0)]
$join = (begin
	_res = []
	for y1 in $sales_year1
		for y2 in $sales_year2
			if ((y1.store == y2.store) && (y1.week == (y2.week - 52)))
				_res << OpenStruct.new(s_store_id1: y1.store, ratio: (y2.amount / y1.amount))
			end
		end
	end
	_res
end)
$result = $join
_json($result)
raise "expect failed" unless ($result == [OpenStruct.new(s_store_id1: 1, ratio: 1.5)])
