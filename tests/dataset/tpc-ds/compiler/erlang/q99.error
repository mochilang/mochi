run: exit status 127
/tmp/q99.erl:10:1975: function substr/3 undefined
%   10|     Grouped = [#{warehouse => maps:get(warehouse, Key0), sm_type => maps:get(sm_type, Key0), cc_name => maps:get(cc_name, Key0), d30 => (case [X || X <- Val0, ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) =< 30)] of #{items := It} -> length(It); _ -> length([X || X <- Val0, ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) =< 30)]) end), d60 => (case [X || X <- Val0, (((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) > 30) andalso ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) =< 60))] of #{items := It} -> length(It); _ -> length([X || X <- Val0, (((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) > 30) andalso ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) =< 60))]) end), d90 => (case [X || X <- Val0, (((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) > 60) andalso ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) =< 90))] of #{items := It} -> length(It); _ -> length([X || X <- Val0, (((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) > 60) andalso ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) =< 90))]) end), d120 => (case [X || X <- Val0, (((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) > 90) andalso ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) =< 120))] of #{items := It} -> length(It); _ -> length([X || X <- Val0, (((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) > 90) andalso ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) =< 120))]) end), dmore => (case [X || X <- Val0, ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) > 120)] of #{items := It} -> length(It); _ -> length([X || X <- Val0, ((maps:get(cs_ship_date_sk, X) - maps:get(cs_sold_date_sk, X)) > 120)]) end)} || {Key0, Val0} <- maps:to_list(lists:foldl(fun({Key0, Val0}, Acc0) -> L = maps:get(Key0, Acc0, []), maps:put(Key0, [Val0 | L], Acc0) end, #{}, [{#{warehouse => substr(maps:get(w_warehouse_name, W), 0, 20), sm_type => maps:get(sm_type, Sm), cc_name => maps:get(cc_name, Cc)}, #{cs => Cs, w => W, sm => Sm, cc => Cc}} || Cs <- Catalog_sales, W <- Warehouse, Sm <- Ship_mode, Cc <- Call_center, (maps:get(cs_warehouse_sk, Cs) == maps:get(w_warehouse_sk, W)), (maps:get(cs_ship_mode_sk, Cs) == maps:get(sm_ship_mode_sk, Sm)), (maps:get(cs_call_center_sk, Cs) == maps:get(cc_call_center_sk, Cc))]))],
%     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ^

escript: There were compilation errors.
