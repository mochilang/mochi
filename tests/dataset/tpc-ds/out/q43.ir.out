func main (regs=252)
  // let date_dim = [
  Const        r0, [{"d_day_name": "Sunday", "d_year": 2020, "date_sk": 1}, {"d_day_name": "Monday", "d_year": 2020, "date_sk": 2}, {"d_day_name": "Tuesday", "d_year": 2020, "date_sk": 3}, {"d_day_name": "Wednesday", "d_year": 2020, "date_sk": 4}, {"d_day_name": "Thursday", "d_year": 2020, "date_sk": 5}, {"d_day_name": "Friday", "d_year": 2020, "date_sk": 6}, {"d_day_name": "Saturday", "d_year": 2020, "date_sk": 7}]
  // let store = [ { store_sk: 1, store_id: "S1", store_name: "Main", gmt_offset: 0 } ]
  Const        r1, [{"gmt_offset": 0, "store_id": "S1", "store_name": "Main", "store_sk": 1}]
  // let store_sales = [
  Const        r2, [{"sales_price": 10, "sold_date_sk": 1, "store_sk": 1}, {"sales_price": 20, "sold_date_sk": 2, "store_sk": 1}, {"sales_price": 30, "sold_date_sk": 3, "store_sk": 1}, {"sales_price": 40, "sold_date_sk": 4, "store_sk": 1}, {"sales_price": 50, "sold_date_sk": 5, "store_sk": 1}, {"sales_price": 60, "sold_date_sk": 6, "store_sk": 1}, {"sales_price": 70, "sold_date_sk": 7, "store_sk": 1}]
  // let year = 2020
  Const        r3, 2020
  // let gmt = 0
  Const        r4, 0
  // from d in date_dim
  Const        r5, []
  // where s.gmt_offset == gmt && d.d_year == year
  Const        r6, "gmt_offset"
  Const        r7, "d_year"
  // select { d_day_name: d.d_day_name, s_store_name: s.store_name, s_store_id: s.store_id, price: ss.sales_price }
  Const        r8, "d_day_name"
  Const        r9, "s_store_name"
  Const        r10, "store_name"
  Const        r11, "s_store_id"
  Const        r12, "store_id"
  Const        r13, "price"
  Const        r14, "sales_price"
  // from d in date_dim
  IterPrep     r15, r0
  Len          r16, r15
  Move         r17, r4
L7:
  LessInt      r18, r17, r16
  JumpIfFalse  r18, L0
  Index        r19, r15, r17
  Move         r20, r19
  // join ss in store_sales on ss.sold_date_sk == d.date_sk
  IterPrep     r21, r2
  Len          r22, r21
  Const        r23, "sold_date_sk"
  Const        r24, "date_sk"
  Move         r25, r4
L6:
  LessInt      r26, r25, r22
  JumpIfFalse  r26, L1
  Index        r27, r21, r25
  Move         r28, r27
  Index        r29, r28, r23
  Index        r30, r20, r24
  Equal        r31, r29, r30
  JumpIfFalse  r31, L2
  // join s in store on ss.store_sk == s.store_sk
  IterPrep     r32, r1
  Len          r33, r32
  Const        r34, "store_sk"
  Move         r35, r4
L5:
  LessInt      r36, r35, r33
  JumpIfFalse  r36, L2
  Index        r37, r32, r35
  Move         r38, r37
  Index        r39, r28, r34
  Index        r40, r38, r34
  Equal        r41, r39, r40
  JumpIfFalse  r41, L3
  // where s.gmt_offset == gmt && d.d_year == year
  Index        r42, r38, r6
  Equal        r43, r42, r4
  Index        r44, r20, r7
  Equal        r45, r44, r3
  Move         r46, r43
  JumpIfFalse  r46, L4
  Move         r46, r45
L4:
  JumpIfFalse  r46, L3
  // select { d_day_name: d.d_day_name, s_store_name: s.store_name, s_store_id: s.store_id, price: ss.sales_price }
  Const        r47, "d_day_name"
  Index        r48, r20, r8
  Const        r49, "s_store_name"
  Index        r50, r38, r10
  Const        r51, "s_store_id"
  Index        r52, r38, r12
  Const        r53, "price"
  Index        r54, r28, r14
  Move         r55, r47
  Move         r56, r48
  Move         r57, r49
  Move         r58, r50
  Move         r59, r51
  Move         r60, r52
  Move         r61, r53
  Move         r62, r54
  MakeMap      r63, 4, r55
  // from d in date_dim
  Append       r64, r5, r63
  Move         r5, r64
L3:
  // join s in store on ss.store_sk == s.store_sk
  Const        r65, 1
  Add          r35, r35, r65
  Jump         L5
L2:
  // join ss in store_sales on ss.sold_date_sk == d.date_sk
  Add          r25, r25, r65
  Jump         L6
L1:
  // from d in date_dim
  AddInt       r17, r17, r65
  Jump         L7
L0:
  // from r in records
  Const        r66, []
  // group by { name: r.s_store_name, id: r.s_store_id } into g
  Const        r67, "name"
  Const        r68, "id"
  // s_store_name: g.key.name,
  Const        r69, "key"
  // sun_sales: sum(from x in g select if x.d_day_name == "Sunday" { x.price } else { 0.0 }),
  Const        r70, "sun_sales"
  // mon_sales: sum(from x in g select if x.d_day_name == "Monday" { x.price } else { 0.0 }),
  Const        r71, "mon_sales"
  // tue_sales: sum(from x in g select if x.d_day_name == "Tuesday" { x.price } else { 0.0 }),
  Const        r72, "tue_sales"
  // wed_sales: sum(from x in g select if x.d_day_name == "Wednesday" { x.price } else { 0.0 }),
  Const        r73, "wed_sales"
  // thu_sales: sum(from x in g select if x.d_day_name == "Thursday" { x.price } else { 0.0 }),
  Const        r74, "thu_sales"
  // fri_sales: sum(from x in g select if x.d_day_name == "Friday" { x.price } else { 0.0 }),
  Const        r75, "fri_sales"
  // sat_sales: sum(from x in g select if x.d_day_name == "Saturday" { x.price } else { 0.0 })
  Const        r76, "sat_sales"
  // from r in records
  IterPrep     r77, r5
  Len          r78, r77
  Const        r79, 0
  MakeMap      r80, 0, r0
  Const        r82, []
  Move         r81, r82
L10:
  LessInt      r83, r79, r78
  JumpIfFalse  r83, L8
  Index        r84, r77, r79
  Move         r85, r84
  // group by { name: r.s_store_name, id: r.s_store_id } into g
  Const        r86, "name"
  Index        r87, r85, r9
  Const        r88, "id"
  Index        r89, r85, r11
  Move         r90, r86
  Move         r91, r87
  Move         r92, r88
  Move         r93, r89
  MakeMap      r94, 2, r90
  Str          r95, r94
  In           r96, r95, r80
  JumpIfTrue   r96, L9
  // from r in records
  Const        r97, []
  Const        r98, "__group__"
  Const        r99, true
  // group by { name: r.s_store_name, id: r.s_store_id } into g
  Move         r100, r94
  // from r in records
  Const        r101, "items"
  Move         r102, r97
  Const        r103, "count"
  Move         r104, r98
  Move         r105, r99
  Move         r106, r69
  Move         r107, r100
  Move         r108, r101
  Move         r109, r102
  Move         r110, r103
  Move         r111, r4
  MakeMap      r112, 4, r104
  SetIndex     r80, r95, r112
  Append       r113, r81, r112
  Move         r81, r113
L9:
  Index        r114, r80, r95
  Index        r115, r114, r101
  Append       r116, r115, r84
  SetIndex     r114, r101, r116
  Index        r117, r114, r103
  AddInt       r118, r117, r65
  SetIndex     r114, r103, r118
  AddInt       r79, r79, r65
  Jump         L10
L8:
  Move         r119, r4
  Len          r120, r81
L26:
  LessInt      r121, r119, r120
  JumpIfFalse  r121, L11
  Index        r122, r81, r119
  Move         r123, r122
  // s_store_name: g.key.name,
  Const        r124, "s_store_name"
  Index        r125, r123, r69
  Index        r126, r125, r67
  // s_store_id: g.key.id,
  Const        r127, "s_store_id"
  Index        r128, r123, r69
  Index        r129, r128, r68
  // sun_sales: sum(from x in g select if x.d_day_name == "Sunday" { x.price } else { 0.0 }),
  Const        r130, "sun_sales"
  Const        r131, []
  IterPrep     r132, r123
  Len          r133, r132
  Move         r134, r4
L13:
  LessInt      r135, r134, r133
  JumpIfFalse  r135, L12
  Index        r136, r132, r134
  Move         r137, r136
  Index        r138, r137, r8
  Const        r139, "Sunday"
  Equal        r140, r138, r139
  Index        r141, r137, r13
  Const        r142, 0
  Select       143,140,141,142
  Append       r144, r131, r143
  Move         r131, r144
  AddInt       r134, r134, r65
  Jump         L13
L12:
  Sum          r145, r131
  // mon_sales: sum(from x in g select if x.d_day_name == "Monday" { x.price } else { 0.0 }),
  Const        r146, "mon_sales"
  Const        r147, []
  IterPrep     r148, r123
  Len          r149, r148
  Move         r150, r4
L15:
  LessInt      r151, r150, r149
  JumpIfFalse  r151, L14
  Index        r152, r148, r150
  Move         r137, r152
  Index        r153, r137, r8
  Const        r154, "Monday"
  Equal        r155, r153, r154
  Index        r156, r137, r13
  Select       157,155,156,142
  Append       r158, r147, r157
  Move         r147, r158
  AddInt       r150, r150, r65
  Jump         L15
L14:
  Sum          r159, r147
  // tue_sales: sum(from x in g select if x.d_day_name == "Tuesday" { x.price } else { 0.0 }),
  Const        r160, "tue_sales"
  Const        r161, []
  IterPrep     r162, r123
  Len          r163, r162
  Move         r164, r4
L17:
  LessInt      r165, r164, r163
  JumpIfFalse  r165, L16
  Index        r166, r162, r164
  Move         r137, r166
  Index        r167, r137, r8
  Const        r168, "Tuesday"
  Equal        r169, r167, r168
  Index        r170, r137, r13
  Select       171,169,170,142
  Append       r172, r161, r171
  Move         r161, r172
  AddInt       r164, r164, r65
  Jump         L17
L16:
  Sum          r173, r161
  // wed_sales: sum(from x in g select if x.d_day_name == "Wednesday" { x.price } else { 0.0 }),
  Const        r174, "wed_sales"
  Const        r175, []
  IterPrep     r176, r123
  Len          r177, r176
  Move         r178, r4
L19:
  LessInt      r179, r178, r177
  JumpIfFalse  r179, L18
  Index        r180, r176, r178
  Move         r137, r180
  Index        r181, r137, r8
  Const        r182, "Wednesday"
  Equal        r183, r181, r182
  Index        r184, r137, r13
  Select       185,183,184,142
  Append       r186, r175, r185
  Move         r175, r186
  AddInt       r178, r178, r65
  Jump         L19
L18:
  Sum          r187, r175
  // thu_sales: sum(from x in g select if x.d_day_name == "Thursday" { x.price } else { 0.0 }),
  Const        r188, "thu_sales"
  Const        r189, []
  IterPrep     r190, r123
  Len          r191, r190
  Move         r192, r4
L21:
  LessInt      r193, r192, r191
  JumpIfFalse  r193, L20
  Index        r194, r190, r192
  Move         r137, r194
  Index        r195, r137, r8
  Const        r196, "Thursday"
  Equal        r197, r195, r196
  Index        r198, r137, r13
  Select       199,197,198,142
  Append       r200, r189, r199
  Move         r189, r200
  AddInt       r192, r192, r65
  Jump         L21
L20:
  Sum          r201, r189
  // fri_sales: sum(from x in g select if x.d_day_name == "Friday" { x.price } else { 0.0 }),
  Const        r202, "fri_sales"
  Const        r203, []
  IterPrep     r204, r123
  Len          r205, r204
  Move         r206, r4
L23:
  LessInt      r207, r206, r205
  JumpIfFalse  r207, L22
  Index        r208, r204, r206
  Move         r137, r208
  Index        r209, r137, r8
  Const        r210, "Friday"
  Equal        r211, r209, r210
  Index        r212, r137, r13
  Select       213,211,212,142
  Append       r214, r203, r213
  Move         r203, r214
  AddInt       r206, r206, r65
  Jump         L23
L22:
  Sum          r215, r203
  // sat_sales: sum(from x in g select if x.d_day_name == "Saturday" { x.price } else { 0.0 })
  Const        r216, "sat_sales"
  Const        r217, []
  IterPrep     r218, r123
  Len          r219, r218
  Move         r220, r4
L25:
  LessInt      r221, r220, r219
  JumpIfFalse  r221, L24
  Index        r222, r218, r220
  Move         r137, r222
  Index        r223, r137, r8
  Const        r224, "Saturday"
  Equal        r225, r223, r224
  Index        r226, r137, r13
  Select       227,225,226,142
  Append       r228, r217, r227
  Move         r217, r228
  AddInt       r220, r220, r65
  Jump         L25
L24:
  Sum          r229, r217
  // s_store_name: g.key.name,
  Move         r230, r124
  Move         r231, r126
  // s_store_id: g.key.id,
  Move         r232, r127
  Move         r233, r129
  // sun_sales: sum(from x in g select if x.d_day_name == "Sunday" { x.price } else { 0.0 }),
  Move         r234, r130
  Move         r235, r145
  // mon_sales: sum(from x in g select if x.d_day_name == "Monday" { x.price } else { 0.0 }),
  Move         r236, r146
  Move         r237, r159
  // tue_sales: sum(from x in g select if x.d_day_name == "Tuesday" { x.price } else { 0.0 }),
  Move         r238, r160
  Move         r239, r173
  // wed_sales: sum(from x in g select if x.d_day_name == "Wednesday" { x.price } else { 0.0 }),
  Move         r240, r174
  Move         r241, r187
  // thu_sales: sum(from x in g select if x.d_day_name == "Thursday" { x.price } else { 0.0 }),
  Move         r242, r188
  Move         r243, r201
  // fri_sales: sum(from x in g select if x.d_day_name == "Friday" { x.price } else { 0.0 }),
  Move         r244, r202
  Move         r245, r215
  // sat_sales: sum(from x in g select if x.d_day_name == "Saturday" { x.price } else { 0.0 })
  Move         r246, r216
  Move         r247, r229
  // select {
  MakeMap      r248, 9, r230
  // from r in records
  Append       r249, r66, r248
  Move         r66, r249
  AddInt       r119, r119, r65
  Jump         L26
L11:
  // json(result)
  JSON         r66
  // expect result == [
  Const        r250, [{"fri_sales": 60, "mon_sales": 20, "s_store_id": "S1", "s_store_name": "Main", "sat_sales": 70, "sun_sales": 10, "thu_sales": 50, "tue_sales": 30, "wed_sales": 40}]
  Equal        r251, r66, r250
  Expect       r251
  Return       r0
