func main (regs=220)
  // let web_sales = [
  Const        r0, [{"ws_ext_ship_cost": 2, "ws_net_profit": 5, "ws_order_number": 1, "ws_ship_addr_sk": 1, "ws_ship_date_sk": 1, "ws_warehouse_sk": 1, "ws_web_site_sk": 1}, {"ws_ext_ship_cost": 0, "ws_net_profit": 0, "ws_order_number": 1, "ws_ship_addr_sk": 1, "ws_ship_date_sk": 1, "ws_warehouse_sk": 2, "ws_web_site_sk": 1}]
  // let web_returns = [{wr_order_number: 1}]
  Const        r1, [{"wr_order_number": 1}]
  // let date_dim = [{d_date_sk: 1, d_date: "2001-02-01"}]
  Const        r2, [{"d_date": "2001-02-01", "d_date_sk": 1}]
  // let customer_address = [{ca_address_sk: 1, ca_state: "CA"}]
  Const        r3, [{"ca_address_sk": 1, "ca_state": "CA"}]
  // let web_site = [{web_site_sk: 1, web_company_name: "pri"}]
  Const        r4, [{"web_company_name": "pri", "web_site_sk": 1}]
  // from ws1 in web_sales
  Const        r5, []
  // where ws1.ws_order_number == ws2.ws_order_number && ws1.ws_warehouse_sk != ws2.ws_warehouse_sk
  Const        r6, "ws_order_number"
  Const        r7, "ws_order_number"
  Const        r8, "ws_warehouse_sk"
  Const        r9, "ws_warehouse_sk"
  // select {ws_order_number: ws1.ws_order_number}
  Const        r10, "ws_order_number"
  Const        r11, "ws_order_number"
  // from ws1 in web_sales
  IterPrep     r12, r0
  Len          r13, r12
  Const        r14, 0
L5:
  LessInt      r16, r14, r13
  JumpIfFalse  r16, L0
  Index        r18, r12, r14
  // from ws2 in web_sales
  IterPrep     r19, r0
  Len          r20, r19
  Const        r21, 0
L4:
  LessInt      r23, r21, r20
  JumpIfFalse  r23, L1
  Index        r25, r19, r21
  // where ws1.ws_order_number == ws2.ws_order_number && ws1.ws_warehouse_sk != ws2.ws_warehouse_sk
  Const        r26, "ws_order_number"
  Index        r27, r18, r26
  Const        r28, "ws_order_number"
  Index        r29, r25, r28
  Equal        r30, r27, r29
  Const        r31, "ws_warehouse_sk"
  Index        r32, r18, r31
  Const        r33, "ws_warehouse_sk"
  Index        r34, r25, r33
  NotEqual     r35, r32, r34
  Move         r36, r30
  JumpIfFalse  r36, L2
  Move         r36, r35
L2:
  JumpIfFalse  r36, L3
  // select {ws_order_number: ws1.ws_order_number}
  Const        r37, "ws_order_number"
  Const        r38, "ws_order_number"
  Index        r39, r18, r38
  Move         r40, r37
  Move         r41, r39
  MakeMap      r42, 1, r40
  // from ws1 in web_sales
  Append       r5, r5, r42
L3:
  // from ws2 in web_sales
  Const        r44, 1
  AddInt       r21, r21, r44
  Jump         L4
L1:
  // from ws1 in web_sales
  Const        r45, 1
  AddInt       r14, r14, r45
  Jump         L5
L0:
  // from ws in web_sales
  Const        r46, []
  // where ca.ca_state == "CA" && w.web_company_name == "pri" &&
  Const        r47, "ca_state"
  Const        r48, "web_company_name"
  // ws.ws_order_number in (from x in ws_wh select x.ws_order_number) &&
  Const        r49, "ws_order_number"
  Const        r50, "ws_order_number"
  // ws.ws_order_number in (from wr in web_returns select wr.wr_order_number)
  Const        r51, "ws_order_number"
  Const        r52, "wr_order_number"
  // from ws in web_sales
  IterPrep     r53, r0
  Len          r54, r53
  Const        r55, 0
L21:
  LessInt      r57, r55, r54
  JumpIfFalse  r57, L6
  Index        r59, r53, r55
  // join d in date_dim on ws.ws_ship_date_sk == d.d_date_sk
  IterPrep     r60, r2
  Len          r61, r60
  Const        r62, "ws_ship_date_sk"
  Const        r63, "d_date_sk"
  // where ca.ca_state == "CA" && w.web_company_name == "pri" &&
  Const        r64, "ca_state"
  Const        r65, "web_company_name"
  // ws.ws_order_number in (from x in ws_wh select x.ws_order_number) &&
  Const        r66, "ws_order_number"
  Const        r67, "ws_order_number"
  // ws.ws_order_number in (from wr in web_returns select wr.wr_order_number)
  Const        r68, "ws_order_number"
  Const        r69, "wr_order_number"
  // join d in date_dim on ws.ws_ship_date_sk == d.d_date_sk
  Const        r70, 0
L20:
  LessInt      r72, r70, r61
  JumpIfFalse  r72, L7
  Index        r74, r60, r70
  Const        r75, "ws_ship_date_sk"
  Index        r76, r59, r75
  Const        r77, "d_date_sk"
  Index        r78, r74, r77
  Equal        r79, r76, r78
  JumpIfFalse  r79, L8
  // join ca in customer_address on ws.ws_ship_addr_sk == ca.ca_address_sk
  IterPrep     r80, r3
  Len          r81, r80
  Const        r82, "ws_ship_addr_sk"
  Const        r83, "ca_address_sk"
  // where ca.ca_state == "CA" && w.web_company_name == "pri" &&
  Const        r84, "ca_state"
  Const        r85, "web_company_name"
  // ws.ws_order_number in (from x in ws_wh select x.ws_order_number) &&
  Const        r86, "ws_order_number"
  Const        r87, "ws_order_number"
  // ws.ws_order_number in (from wr in web_returns select wr.wr_order_number)
  Const        r88, "ws_order_number"
  Const        r89, "wr_order_number"
  // join ca in customer_address on ws.ws_ship_addr_sk == ca.ca_address_sk
  Const        r90, 0
L19:
  LessInt      r92, r90, r81
  JumpIfFalse  r92, L8
  Index        r94, r80, r90
  Const        r95, "ws_ship_addr_sk"
  Index        r96, r59, r95
  Const        r97, "ca_address_sk"
  Index        r98, r94, r97
  Equal        r99, r96, r98
  JumpIfFalse  r99, L9
  // join w in web_site on ws.ws_web_site_sk == w.web_site_sk
  IterPrep     r100, r4
  Len          r101, r100
  Const        r102, "ws_web_site_sk"
  Const        r103, "web_site_sk"
  // where ca.ca_state == "CA" && w.web_company_name == "pri" &&
  Const        r104, "ca_state"
  Const        r105, "web_company_name"
  // ws.ws_order_number in (from x in ws_wh select x.ws_order_number) &&
  Const        r106, "ws_order_number"
  Const        r107, "ws_order_number"
  // ws.ws_order_number in (from wr in web_returns select wr.wr_order_number)
  Const        r108, "ws_order_number"
  Const        r109, "wr_order_number"
  // join w in web_site on ws.ws_web_site_sk == w.web_site_sk
  Const        r110, 0
L18:
  LessInt      r112, r110, r101
  JumpIfFalse  r112, L9
  Index        r114, r100, r110
  Const        r115, "ws_web_site_sk"
  Index        r116, r59, r115
  Const        r117, "web_site_sk"
  Index        r118, r114, r117
  Equal        r119, r116, r118
  JumpIfFalse  r119, L10
  // where ca.ca_state == "CA" && w.web_company_name == "pri" &&
  Const        r120, "ca_state"
  Index        r121, r94, r120
  Const        r122, "CA"
  Equal        r123, r121, r122
  Const        r124, "web_company_name"
  Index        r125, r114, r124
  Const        r126, "pri"
  Equal        r127, r125, r126
  // ws.ws_order_number in (from x in ws_wh select x.ws_order_number) &&
  Const        r128, "ws_order_number"
  Index        r129, r59, r128
  Const        r130, []
  Const        r131, "ws_order_number"
  IterPrep     r132, r5
  Len          r133, r132
  Const        r134, 0
L12:
  LessInt      r136, r134, r133
  JumpIfFalse  r136, L11
  Index        r138, r132, r134
  Const        r139, "ws_order_number"
  Index        r140, r138, r139
  Append       r130, r130, r140
  Const        r142, 1
  AddInt       r134, r134, r142
  Jump         L12
L11:
  In           r143, r129, r130
  // ws.ws_order_number in (from wr in web_returns select wr.wr_order_number)
  Const        r144, "ws_order_number"
  Index        r145, r59, r144
  Const        r146, []
  Const        r147, "wr_order_number"
  IterPrep     r148, r1
  Len          r149, r148
  Const        r150, 0
L14:
  LessInt      r152, r150, r149
  JumpIfFalse  r152, L13
  Index        r154, r148, r150
  Const        r155, "wr_order_number"
  Index        r156, r154, r155
  Append       r146, r146, r156
  Const        r158, 1
  AddInt       r150, r150, r158
  Jump         L14
L13:
  In           r159, r145, r146
  // where ca.ca_state == "CA" && w.web_company_name == "pri" &&
  Move         r160, r123
  JumpIfFalse  r160, L15
L15:
  Move         r161, r127
  JumpIfFalse  r161, L16
L16:
  // ws.ws_order_number in (from x in ws_wh select x.ws_order_number) &&
  Move         r162, r143
  JumpIfFalse  r162, L17
  Move         r162, r159
L17:
  // where ca.ca_state == "CA" && w.web_company_name == "pri" &&
  JumpIfFalse  r162, L10
  // from ws in web_sales
  Append       r46, r46, r59
L10:
  // join w in web_site on ws.ws_web_site_sk == w.web_site_sk
  Const        r164, 1
  Add          r110, r110, r164
  Jump         L18
L9:
  // join ca in customer_address on ws.ws_ship_addr_sk == ca.ca_address_sk
  Const        r165, 1
  Add          r90, r90, r165
  Jump         L19
L8:
  // join d in date_dim on ws.ws_ship_date_sk == d.d_date_sk
  Const        r166, 1
  Add          r70, r70, r166
  Jump         L20
L7:
  // from ws in web_sales
  Const        r167, 1
  AddInt       r55, r55, r167
  Jump         L21
L6:
  // order_count: len(distinct(from x in filtered select x.ws_order_number)),
  Const        r168, "order_count"
  Const        r169, []
  Const        r170, "ws_order_number"
  IterPrep     r171, r46
  Len          r172, r171
  Const        r173, 0
L23:
  LessInt      r175, r173, r172
  JumpIfFalse  r175, L22
  Index        r138, r171, r173
  Const        r177, "ws_order_number"
  Index        r178, r138, r177
  Append       r169, r169, r178
  Const        r180, 1
  AddInt       r173, r173, r180
  Jump         L23
L22:
  Distinct     181,169,0,0
  Len          r182, r181
  // total_shipping_cost: sum(from x in filtered select x.ws_ext_ship_cost),
  Const        r183, "total_shipping_cost"
  Const        r184, []
  Const        r185, "ws_ext_ship_cost"
  IterPrep     r186, r46
  Len          r187, r186
  Const        r188, 0
L25:
  LessInt      r190, r188, r187
  JumpIfFalse  r190, L24
  Index        r138, r186, r188
  Const        r192, "ws_ext_ship_cost"
  Index        r193, r138, r192
  Append       r184, r184, r193
  Const        r195, 1
  AddInt       r188, r188, r195
  Jump         L25
L24:
  Sum          r196, r184
  // total_net_profit: sum(from x in filtered select x.ws_net_profit)
  Const        r197, "total_net_profit"
  Const        r198, []
  Const        r199, "ws_net_profit"
  IterPrep     r200, r46
  Len          r201, r200
  Const        r202, 0
L27:
  LessInt      r204, r202, r201
  JumpIfFalse  r204, L26
  Index        r138, r200, r202
  Const        r206, "ws_net_profit"
  Index        r207, r138, r206
  Append       r198, r198, r207
  Const        r209, 1
  AddInt       r202, r202, r209
  Jump         L27
L26:
  Sum          r210, r198
  // order_count: len(distinct(from x in filtered select x.ws_order_number)),
  Move         r211, r168
  Move         r212, r182
  // total_shipping_cost: sum(from x in filtered select x.ws_ext_ship_cost),
  Move         r213, r183
  Move         r214, r196
  // total_net_profit: sum(from x in filtered select x.ws_net_profit)
  Move         r215, r197
  Move         r216, r210
  // let result = {
  MakeMap      r217, 3, r211
  // json(result)
  JSON         r217
  // expect result == {order_count: 1, total_shipping_cost: 2.0, total_net_profit: 5.0}
  Const        r218, {"order_count": 1, "total_net_profit": 5, "total_shipping_cost": 2}
  Equal        r219, r217, r218
  Expect       r219
  Return       r0

  // fun distinct(xs: list<any>): list<any> {
func distinct (regs=14)
  // var out = []
  Const        r2, []
  // for x in xs {
  IterPrep     r3, r0
  Len          r4, r3
  Const        r5, 0
L2:
  Less         r6, r5, r4
  JumpIfFalse  r6, L0
  Index        r8, r3, r5
  // if !contains(out, x) {
  Not          r10, r9
  JumpIfFalse  r10, L1
  // out = append(out, x)
  Append       r2, r2, r8
L1:
  // for x in xs {
  Const        r12, 1
  Add          r5, r5, r12
  Jump         L2
L0:
  // return out
  Return       r2
