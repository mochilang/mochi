let v2 = [
  { d_year: 2020, item: "A", avg_monthly_sales: 100.0, sum_sales: 120.0 },
  { d_year: 2020, item: "B", avg_monthly_sales: 80.0, sum_sales: 70.0 },
  { d_year: 2019, item: "C", avg_monthly_sales: 50.0, sum_sales: 60.0 }
]

import python "math" as math

let year = 2020
let orderby = "item"

let result =
  from v in v2
  where v.avg_monthly_sales > 0 && v.sum_sales > v.avg_monthly_sales && math.abs(v.sum_sales - v.avg_monthly_sales) / v.avg_monthly_sales > 0.1
  sort by [v.sum_sales - v.avg_monthly_sales, v.item]
  select v

json(result)

test "TPCDS Q47 simplified" {
  expect result == [
    { d_year: 2019, item: "C", avg_monthly_sales: 50.0, sum_sales: 60.0 },
    { d_year: 2020, item: "A", avg_monthly_sales: 100.0, sum_sales: 120.0 }
  ]
}
