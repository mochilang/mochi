# Generated by Mochi compiler v0.10.25 on 2025-07-13T10:53:37Z
require 'ostruct'

def _json(v)
  require 'json'
  obj = v
  if v.is_a?(Array)
    obj = v.map { |it| it.respond_to?(:to_h) ? it.to_h : it }
  elsif v.respond_to?(:to_h)
    obj = v.to_h
  end
  puts(JSON.generate(obj))
end
def _min(v)
  list = nil
  if v.respond_to?(:Items)
    list = v.Items
  elsif v.is_a?(Array)
    list = v
  elsif v.respond_to?(:to_a)
    list = v.to_a
  end
  return 0 if !list || list.empty?
  list.min
end

$info_type = [OpenStruct.new(id: 1, info: "rating"), OpenStruct.new(id: 2, info: "other")]
$keyword = [OpenStruct.new(id: 1, keyword: "great sequel"), OpenStruct.new(id: 2, keyword: "prequel")]
$title = [OpenStruct.new(id: 10, title: "Alpha Movie", production_year: 2006), OpenStruct.new(id: 20, title: "Beta Film", production_year: 2007), OpenStruct.new(id: 30, title: "Old Film", production_year: 2004)]
$movie_keyword = [OpenStruct.new(movie_id: 10, keyword_id: 1), OpenStruct.new(movie_id: 20, keyword_id: 1), OpenStruct.new(movie_id: 30, keyword_id: 1)]
$movie_info_idx = [OpenStruct.new(movie_id: 10, info_type_id: 1, info: "6.2"), OpenStruct.new(movie_id: 20, info_type_id: 1, info: "7.8"), OpenStruct.new(movie_id: 30, info_type_id: 1, info: "4.5")]
$rows = (begin
	_res = []
	for it in $info_type
		for mi in $movie_info_idx
			if (it.id == mi.info_type_id)
				for t in $title
					if (t.id == mi.movie_id)
						for mk in $movie_keyword
							if (mk.movie_id == t.id)
								for k in $keyword
									if (k.id == mk.keyword_id)
										if (((((it.info == "rating") && (k.keyword.include?("sequel"))) && (mi.info > "5.0")) && (t.production_year > 2005)) && (mk.movie_id == mi.movie_id))
											_res << OpenStruct.new(rating: mi.info, title: t.title)
										end
									end
								end
							end
						end
					end
				end
			end
		end
	end
	_res
end)
$result = [OpenStruct.new(rating: _min((($rows)).map { |r| r.rating }), movie_title: _min((($rows)).map { |r| r.title }))]
_json($result)
raise "expect failed" unless ($result == [OpenStruct.new(rating: "6.2", movie_title: "Alpha Movie")])
