# Generated by Mochi compiler v0.10.25 on 2025-07-13T12:52:39Z
require 'ostruct'

def _json(v)
  require 'json'
  obj = v
  if v.is_a?(Array)
    obj = v.map { |it| it.respond_to?(:to_h) ? it.to_h : it }
  elsif v.respond_to?(:to_h)
    obj = v.to_h
  end
  puts(JSON.generate(obj))
end
def _min(v)
  list = nil
  if v.respond_to?(:Items)
    list = v.Items
  elsif v.is_a?(Array)
    list = v
  elsif v.respond_to?(:to_a)
    list = v.to_a
  end
  return 0 if !list || list.empty?
  list.min
end

$comp_cast_type = [OpenStruct.new(id: 1, kind: "cast"), OpenStruct.new(id: 2, kind: "complete cast")]
$char_name = [OpenStruct.new(id: 1, name: "Tony Stark"), OpenStruct.new(id: 2, name: "Sherlock Holmes")]
$complete_cast = [OpenStruct.new(movie_id: 1, subject_id: 1, status_id: 2), OpenStruct.new(movie_id: 2, subject_id: 1, status_id: 2)]
$name = [OpenStruct.new(id: 1, name: "Robert Downey Jr."), OpenStruct.new(id: 2, name: "Another Actor")]
$cast_info = [OpenStruct.new(movie_id: 1, person_role_id: 1, person_id: 1), OpenStruct.new(movie_id: 2, person_role_id: 2, person_id: 2)]
$keyword = [OpenStruct.new(id: 10, keyword: "superhero"), OpenStruct.new(id: 20, keyword: "romance")]
$movie_keyword = [OpenStruct.new(movie_id: 1, keyword_id: 10), OpenStruct.new(movie_id: 2, keyword_id: 20)]
$kind_type = [OpenStruct.new(id: 1, kind: "movie")]
$title = [OpenStruct.new(id: 1, kind_id: 1, production_year: 2008, title: "Iron Man"), OpenStruct.new(id: 2, kind_id: 1, production_year: 1940, title: "Old Hero")]
$matches = (begin
	_res = []
	for cc in $complete_cast
		for cct1 in $comp_cast_type
			if (cct1.id == cc.subject_id)
				for cct2 in $comp_cast_type
					if (cct2.id == cc.status_id)
						for ci in $cast_info
							if (ci.movie_id == cc.movie_id)
								for chn in $char_name
									if (chn.id == ci.person_role_id)
										for n in $name
											if (n.id == ci.person_id)
												for mk in $movie_keyword
													if (mk.movie_id == cc.movie_id)
														for k in $keyword
															if (k.id == mk.keyword_id)
																for t in $title
																	if (t.id == cc.movie_id)
																		for kt in $kind_type
																			if (kt.id == t.kind_id)
																				if (((((((cct1.kind == "cast") && (cct2.kind.include?("complete"))) && ((!(chn.name.include?("Sherlock"))))) && (((chn.name.include?("Tony Stark")) || (chn.name.include?("Iron Man"))))) && (["superhero", "sequel", "second-part", "marvel-comics", "based-on-comic", "tv-special", "fight", "violence"].include?(k.keyword))) && (kt.kind == "movie")) && (t.production_year > 1950))
																					_res << t.title
																				end
																			end
																		end
																	end
																end
															end
														end
													end
												end
											end
										end
									end
								end
							end
						end
					end
				end
			end
		end
	end
	_res
end)
$result = [OpenStruct.new(complete_downey_ironman_movie: _min($matches))]
_json($result)
raise "expect failed" unless ($result == [OpenStruct.new(complete_downey_ironman_movie: "Iron Man")])
