# Generated by Mochi compiler v0.10.25 on 2025-07-13T12:52:36Z
require 'ostruct'

def _json(v)
  require 'json'
  obj = v
  if v.is_a?(Array)
    obj = v.map { |it| it.respond_to?(:to_h) ? it.to_h : it }
  elsif v.respond_to?(:to_h)
    obj = v.to_h
  end
  puts(JSON.generate(obj))
end
def _min(v)
  list = nil
  if v.respond_to?(:Items)
    list = v.Items
  elsif v.is_a?(Array)
    list = v
  elsif v.respond_to?(:to_a)
    list = v.to_a
  end
  return 0 if !list || list.empty?
  list.min
end

$aka_title = [OpenStruct.new(movie_id: 1), OpenStruct.new(movie_id: 2)]
$company_name = [OpenStruct.new(id: 1, country_code: "[us]"), OpenStruct.new(id: 2, country_code: "[gb]")]
$company_type = [OpenStruct.new(id: 10), OpenStruct.new(id: 20)]
$info_type = [OpenStruct.new(id: 5, info: "release dates"), OpenStruct.new(id: 6, info: "other")]
$keyword = [OpenStruct.new(id: 100), OpenStruct.new(id: 200)]
$movie_companies = [OpenStruct.new(movie_id: 1, company_id: 1, company_type_id: 10, note: "release (2005) (worldwide)"), OpenStruct.new(movie_id: 2, company_id: 2, company_type_id: 20, note: "release (1999) (worldwide)")]
$movie_info = [OpenStruct.new(movie_id: 1, info_type_id: 5, note: "internet", info: "USA: March 2005"), OpenStruct.new(movie_id: 2, info_type_id: 5, note: "theater", info: "USA: May 1999")]
$movie_keyword = [OpenStruct.new(movie_id: 1, keyword_id: 100), OpenStruct.new(movie_id: 2, keyword_id: 200)]
$title = [OpenStruct.new(id: 1, title: "Example Movie", production_year: 2005), OpenStruct.new(id: 2, title: "Old Movie", production_year: 1999)]
$rows = (begin
	_res = []
	for t in $title
		for at in $aka_title
			if (at.movie_id == t.id)
				for mi in $movie_info
					if (mi.movie_id == t.id)
						for mk in $movie_keyword
							if (mk.movie_id == t.id)
								for mc in $movie_companies
									if (mc.movie_id == t.id)
										for k in $keyword
											if (k.id == mk.keyword_id)
												for it1 in $info_type
													if (it1.id == mi.info_type_id)
														for cn in $company_name
															if (cn.id == mc.company_id)
																for ct in $company_type
																	if (ct.id == mc.company_type_id)
																		if ((((((((cn.country_code == "[us]") && (it1.info == "release dates")) && (mc.note.include?("200"))) && (mc.note.include?("worldwide"))) && (mi.note.include?("internet"))) && (mi.info.include?("USA:"))) && (mi.info.include?("200"))) && (t.production_year > 2000))
																			_res << OpenStruct.new(release_date: mi.info, internet_movie: t.title)
																		end
																	end
																end
															end
														end
													end
												end
											end
										end
									end
								end
							end
						end
					end
				end
			end
		end
	end
	_res
end)
$result = [OpenStruct.new(release_date: _min((($rows)).map { |r| r.release_date }), internet_movie: _min((($rows)).map { |r| r.internet_movie }))]
_json($result)
raise "expect failed" unless ($result == [OpenStruct.new(release_date: "USA: March 2005", internet_movie: "Example Movie")])
