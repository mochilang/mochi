" Generated by Mochi compiler v0.10.25 on 2025-07-13T14:24:44Z
"
| info_type keyword title movie_keyword movie_info_idx rows result |
info_type := {Dictionary from:{'id'->1. 'info'->'rating'}. Dictionary from:{'id'->2. 'info'->'other'}}.
keyword := {Dictionary from:{'id'->1. keyword->'great sequel'}. Dictionary from:{'id'->2. keyword->'prequel'}}.
title := {Dictionary from:{'id'->10. title->'Alpha Movie'. 'production_year'->2006}. Dictionary from:{'id'->20. title->'Beta Film'. 'production_year'->2007}. Dictionary from:{'id'->30. title->'Old Film'. 'production_year'->2004}}.
movie_keyword := {Dictionary from:{'movie_id'->10. 'keyword_id'->1}. Dictionary from:{'movie_id'->20. 'keyword_id'->1}. Dictionary from:{'movie_id'->30. 'keyword_id'->1}}.
movie_info_idx := {Dictionary from:{'movie_id'->10. 'info_type_id'->1. 'info'->'6.2'}. Dictionary from:{'movie_id'->20. 'info_type_id'->1. 'info'->'7.8'}. Dictionary from:{'movie_id'->30. 'info_type_id'->1. 'info'->'4.5'}}.
rows := [ | tmp |
  tmp := OrderedCollection new.
  info_type do: [:it |
    movie_info_idx do: [:mi |
      title do: [:t |
        movie_keyword do: [:mk |
          keyword do: [:k |
            (((((((((((((((it at: 'info') = 'rating')) and: [((k at: 'keyword' at: 'contains') value: 'sequel')])) and: [(((mi at: 'info') > '5.0'))])) and: [(((t at: 'production_year') > 2005))])) and: [(((mk at: 'movie_id') = (mi at: 'movie_id')))]) and: [(it.id = mi.info_type_id)]) and: [(t.id = mi.movie_id)]) and: [(mk.movie_id = t.id)]) and: [(k.id = mk.keyword_id)])) ifTrue: [
              tmp add: Dictionary from:{'rating'->mi at: 'info'. title->t at: 'title'}.
            ].
          ].
        ].
      ].
    ].
  ].
  tmp
] value.
result := {Dictionary from:{'rating'->([ | tmp |
  tmp := OrderedCollection new.
  rows do: [:r |
    tmp add: r at: 'rating'.
  ].
  tmp
] value min). 'movie_title'->([ | tmp |
  tmp := OrderedCollection new.
  rows do: [:r |
    tmp add: r at: 'title'.
  ].
  tmp
] value min)}}.
json value: result.
((result = ({Dictionary from:{'rating'->'6.2'. 'movie_title'->'Alpha Movie'}}))) ifTrue: [Transcript show:'ok'; cr] ifFalse: [Transcript show:'fail'; cr].
