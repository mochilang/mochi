#lang racket
(require racket/list)
(require json)
(define company_name (list (hash 'id 1 'country_code "[de]") (hash 'id 2 'country_code "[us]")))
(define company_type (list (hash 'id 1 'kind "production companies") (hash 'id 2 'kind "distributors")))
(define info_type (list (hash 'id 1 'info "rating") (hash 'id 2 'info "release dates")))
(define kind_type (list (hash 'id 1 'kind "movie") (hash 'id 2 'kind "video")))
(define title (list (hash 'id 10 'kind_id 1 'title "Alpha") (hash 'id 20 'kind_id 1 'title "Beta") (hash 'id 30 'kind_id 2 'title "Gamma")))
(define movie_companies (list (hash 'movie_id 10 'company_id 1 'company_type_id 1) (hash 'movie_id 20 'company_id 1 'company_type_id 1) (hash 'movie_id 30 'company_id 2 'company_type_id 1)))
(define movie_info (list (hash 'movie_id 10 'info_type_id 2 'info "1997-05-10") (hash 'movie_id 20 'info_type_id 2 'info "1998-03-20") (hash 'movie_id 30 'info_type_id 2 'info "1999-07-30")))
(define movie_info_idx (list (hash 'movie_id 10 'info_type_id 1 'info "6.0") (hash 'movie_id 20 'info_type_id 1 'info "7.5") (hash 'movie_id 30 'info_type_id 1 'info "5.5")))
(define candidates (for*/list ([cn company_name] [mc movie_companies] [ct company_type] [t title] [kt kind_type] [mi movie_info] [it2 info_type] [miidx movie_info_idx] [it info_type] #:when (and (equal? (hash-ref mc 'company_id) (hash-ref cn 'id)) (equal? (hash-ref ct 'id) (hash-ref mc 'company_type_id)) (equal? (hash-ref t 'id) (hash-ref mc 'movie_id)) (equal? (hash-ref kt 'id) (hash-ref t 'kind_id)) (equal? (hash-ref mi 'movie_id) (hash-ref t 'id)) (equal? (hash-ref it2 'id) (hash-ref mi 'info_type_id)) (equal? (hash-ref miidx 'movie_id) (hash-ref t 'id)) (equal? (hash-ref it 'id) (hash-ref miidx 'info_type_id)) (and (and (and (and (string=? (hash-ref cn 'country_code) "[de]") (string=? (hash-ref ct 'kind) "production companies")) (string=? (hash-ref it 'info) "rating")) (string=? (hash-ref it2 'info) "release dates")) (string=? (hash-ref kt 'kind) "movie")))) (hash 'release_date (hash-ref mi 'info) 'rating (hash-ref miidx 'info) 'german_movie (hash-ref t 'title))))
(define result (hash 'release_date (cond [(string? (let ([_items0 (for*/list ([x candidates]) x)])
  (set! _items0 (sort _items0 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [(string? (let ([x b]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [else (< (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))]))))
  (for/list ([x _items0]) (hash-ref x 'release_date)))) (string-ref (let ([_items0 (for*/list ([x candidates]) x)])
  (set! _items0 (sort _items0 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [(string? (let ([x b]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [else (< (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))]))))
  (for/list ([x _items0]) (hash-ref x 'release_date))) 0)] [(hash? (let ([_items0 (for*/list ([x candidates]) x)])
  (set! _items0 (sort _items0 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [(string? (let ([x b]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [else (< (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))]))))
  (for/list ([x _items0]) (hash-ref x 'release_date)))) (hash-ref (let ([_items0 (for*/list ([x candidates]) x)])
  (set! _items0 (sort _items0 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [(string? (let ([x b]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [else (< (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))]))))
  (for/list ([x _items0]) (hash-ref x 'release_date))) 0)] [else (list-ref (let ([_items0 (for*/list ([x candidates]) x)])
  (set! _items0 (sort _items0 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [(string? (let ([x b]) (hash-ref x 'release_date))) (string<? (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))] [else (< (let ([x a]) (hash-ref x 'release_date)) (let ([x b]) (hash-ref x 'release_date)))]))))
  (for/list ([x _items0]) (hash-ref x 'release_date))) 0)]) 'rating (cond [(string? (let ([_items1 (for*/list ([x candidates]) x)])
  (set! _items1 (sort _items1 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [(string? (let ([x b]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [else (< (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))]))))
  (for/list ([x _items1]) (hash-ref x 'rating)))) (string-ref (let ([_items1 (for*/list ([x candidates]) x)])
  (set! _items1 (sort _items1 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [(string? (let ([x b]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [else (< (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))]))))
  (for/list ([x _items1]) (hash-ref x 'rating))) 0)] [(hash? (let ([_items1 (for*/list ([x candidates]) x)])
  (set! _items1 (sort _items1 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [(string? (let ([x b]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [else (< (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))]))))
  (for/list ([x _items1]) (hash-ref x 'rating)))) (hash-ref (let ([_items1 (for*/list ([x candidates]) x)])
  (set! _items1 (sort _items1 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [(string? (let ([x b]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [else (< (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))]))))
  (for/list ([x _items1]) (hash-ref x 'rating))) 0)] [else (list-ref (let ([_items1 (for*/list ([x candidates]) x)])
  (set! _items1 (sort _items1 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [(string? (let ([x b]) (hash-ref x 'rating))) (string<? (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))] [else (< (let ([x a]) (hash-ref x 'rating)) (let ([x b]) (hash-ref x 'rating)))]))))
  (for/list ([x _items1]) (hash-ref x 'rating))) 0)]) 'german_movie (cond [(string? (let ([_items2 (for*/list ([x candidates]) x)])
  (set! _items2 (sort _items2 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [(string? (let ([x b]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [else (< (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))]))))
  (for/list ([x _items2]) (hash-ref x 'german_movie)))) (string-ref (let ([_items2 (for*/list ([x candidates]) x)])
  (set! _items2 (sort _items2 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [(string? (let ([x b]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [else (< (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))]))))
  (for/list ([x _items2]) (hash-ref x 'german_movie))) 0)] [(hash? (let ([_items2 (for*/list ([x candidates]) x)])
  (set! _items2 (sort _items2 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [(string? (let ([x b]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [else (< (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))]))))
  (for/list ([x _items2]) (hash-ref x 'german_movie)))) (hash-ref (let ([_items2 (for*/list ([x candidates]) x)])
  (set! _items2 (sort _items2 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [(string? (let ([x b]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [else (< (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))]))))
  (for/list ([x _items2]) (hash-ref x 'german_movie))) 0)] [else (list-ref (let ([_items2 (for*/list ([x candidates]) x)])
  (set! _items2 (sort _items2 (lambda (a b) (cond [(string? (let ([x a]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [(string? (let ([x b]) (hash-ref x 'german_movie))) (string<? (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))] [else (< (let ([x a]) (hash-ref x 'german_movie)) (let ([x b]) (hash-ref x 'german_movie)))]))))
  (for/list ([x _items2]) (hash-ref x 'german_movie))) 0)])))
(displayln (jsexpr->string result))
(when (equal? result (hash 'release_date "1997-05-10" 'rating "6.0" 'german_movie "Alpha")) (displayln "ok"))
