func main (regs=178)
  // let company_name = [
  Const        r0, [{"country_code": "[us]", "id": 1, "name": "Best Pictures"}, {"country_code": "[uk]", "id": 2, "name": "Foreign Films"}]
  Move         r1, r0
  // let company_type = [
  Const        r2, [{"id": 10, "kind": "production companies"}, {"id": 20, "kind": "distributors"}]
  Move         r3, r2
  // let info_type = [
  Const        r4, [{"id": 100, "info": "genres"}, {"id": 200, "info": "rating"}]
  Move         r5, r4
  // let movie_companies = [
  Const        r6, [{"company_id": 1, "company_type_id": 10, "movie_id": 1000}, {"company_id": 2, "company_type_id": 10, "movie_id": 2000}]
  Move         r7, r6
  // let movie_info = [
  Const        r8, [{"info": "Drama", "info_type_id": 100, "movie_id": 1000}, {"info": "Horror", "info_type_id": 100, "movie_id": 2000}]
  Move         r9, r8
  // let movie_info_idx = [
  Const        r10, [{"info": 8.3, "info_type_id": 200, "movie_id": 1000}, {"info": 7.5, "info_type_id": 200, "movie_id": 2000}]
  Move         r11, r10
  // let title = [
  Const        r12, [{"id": 1000, "production_year": 2006, "title": "Great Drama"}, {"id": 2000, "production_year": 2007, "title": "Low Rated"}]
  Move         r13, r12
  // from cn in company_name
  Const        r14, []
  IterPrep     r15, r1
  Len          r16, r15
  Const        r17, 0
L24:
  Less         r18, r17, r16
  JumpIfFalse  r18, L0
  Index        r19, r15, r17
  Move         r20, r19
  // join mc in movie_companies on mc.company_id == cn.id
  IterPrep     r21, r7
  Len          r22, r21
  Const        r23, 0
L23:
  Less         r24, r23, r22
  JumpIfFalse  r24, L1
  Index        r25, r21, r23
  Move         r26, r25
  Const        r27, "company_id"
  Index        r28, r26, r27
  Const        r29, "id"
  Index        r30, r20, r29
  Equal        r31, r28, r30
  JumpIfFalse  r31, L2
  // join ct in company_type on ct.id == mc.company_type_id
  IterPrep     r32, r3
  Len          r33, r32
  Const        r34, 0
L22:
  Less         r35, r34, r33
  JumpIfFalse  r35, L2
  Index        r36, r32, r34
  Move         r37, r36
  Const        r38, "id"
  Index        r39, r37, r38
  Const        r40, "company_type_id"
  Index        r41, r26, r40
  Equal        r42, r39, r41
  JumpIfFalse  r42, L3
  // join t in title on t.id == mc.movie_id
  IterPrep     r43, r13
  Len          r44, r43
  Const        r45, 0
L21:
  Less         r46, r45, r44
  JumpIfFalse  r46, L3
  Index        r47, r43, r45
  Move         r48, r47
  Const        r49, "id"
  Index        r50, r48, r49
  Const        r51, "movie_id"
  Index        r52, r26, r51
  Equal        r53, r50, r52
  JumpIfFalse  r53, L4
  // join mi in movie_info on mi.movie_id == t.id
  IterPrep     r54, r9
  Len          r55, r54
  Const        r56, 0
L20:
  Less         r57, r56, r55
  JumpIfFalse  r57, L4
  Index        r58, r54, r56
  Move         r59, r58
  Const        r60, "movie_id"
  Index        r61, r59, r60
  Const        r62, "id"
  Index        r63, r48, r62
  Equal        r64, r61, r63
  JumpIfFalse  r64, L5
  // join it1 in info_type on it1.id == mi.info_type_id
  IterPrep     r65, r5
  Len          r66, r65
  Const        r67, 0
L19:
  Less         r68, r67, r66
  JumpIfFalse  r68, L5
  Index        r69, r65, r67
  Move         r70, r69
  Const        r71, "id"
  Index        r72, r70, r71
  Const        r73, "info_type_id"
  Index        r74, r59, r73
  Equal        r75, r72, r74
  JumpIfFalse  r75, L6
  // join mi_idx in movie_info_idx on mi_idx.movie_id == t.id
  IterPrep     r76, r11
  Len          r77, r76
  Const        r78, 0
L18:
  Less         r79, r78, r77
  JumpIfFalse  r79, L6
  Index        r80, r76, r78
  Move         r81, r80
  Const        r82, "movie_id"
  Index        r83, r81, r82
  Const        r84, "id"
  Index        r85, r48, r84
  Equal        r86, r83, r85
  JumpIfFalse  r86, L7
  // join it2 in info_type on it2.id == mi_idx.info_type_id
  IterPrep     r87, r5
  Len          r88, r87
  Const        r89, 0
L17:
  Less         r90, r89, r88
  JumpIfFalse  r90, L7
  Index        r91, r87, r89
  Move         r92, r91
  Const        r93, "id"
  Index        r94, r92, r93
  Const        r95, "info_type_id"
  Index        r96, r81, r95
  Equal        r97, r94, r96
  JumpIfFalse  r97, L8
  // cn.country_code == "[us]" &&
  Const        r98, "country_code"
  Index        r99, r20, r98
  // mi_idx.info > 8.0 &&
  Const        r100, "info"
  Index        r101, r81, r100
  Const        r102, 8
  LessFloat    r103, r102, r101
  // t.production_year >= 2005 &&
  Const        r104, "production_year"
  Index        r105, r48, r104
  Const        r106, 2005
  LessEq       r107, r106, r105
  // t.production_year <= 2008
  Const        r108, "production_year"
  Index        r109, r48, r108
  Const        r110, 2008
  LessEq       r111, r109, r110
  // cn.country_code == "[us]" &&
  Const        r112, "[us]"
  Equal        r113, r99, r112
  // ct.kind == "production companies" &&
  Const        r114, "kind"
  Index        r115, r37, r114
  Const        r116, "production companies"
  Equal        r117, r115, r116
  // it1.info == "genres" &&
  Const        r118, "info"
  Index        r119, r70, r118
  Const        r120, "genres"
  Equal        r121, r119, r120
  // it2.info == "rating" &&
  Const        r122, "info"
  Index        r123, r92, r122
  Const        r124, "rating"
  Equal        r125, r123, r124
  // cn.country_code == "[us]" &&
  Move         r126, r113
  JumpIfFalse  r126, L9
  Move         r126, r117
L9:
  // ct.kind == "production companies" &&
  Move         r127, r126
  JumpIfFalse  r127, L10
  Move         r127, r121
L10:
  // it1.info == "genres" &&
  Move         r128, r127
  JumpIfFalse  r128, L11
  Move         r128, r125
L11:
  // it2.info == "rating" &&
  Move         r129, r128
  JumpIfFalse  r129, L12
  // (mi.info == "Drama" || mi.info == "Horror") &&
  Const        r130, "info"
  Index        r131, r59, r130
  Const        r132, "Drama"
  Equal        r133, r131, r132
  Const        r134, "info"
  Index        r135, r59, r134
  Const        r136, "Horror"
  Equal        r137, r135, r136
  Move         r138, r133
  JumpIfTrue   r138, L13
  Move         r138, r137
L13:
  // it2.info == "rating" &&
  Move         r129, r138
L12:
  // (mi.info == "Drama" || mi.info == "Horror") &&
  Move         r139, r129
  JumpIfFalse  r139, L14
  Move         r139, r103
L14:
  // mi_idx.info > 8.0 &&
  Move         r140, r139
  JumpIfFalse  r140, L15
  Move         r140, r107
L15:
  // t.production_year >= 2005 &&
  Move         r141, r140
  JumpIfFalse  r141, L16
  Move         r141, r111
L16:
  // cn.country_code == "[us]" &&
  JumpIfFalse  r141, L8
  // movie_company: cn.name,
  Const        r142, "movie_company"
  Const        r143, "name"
  Index        r144, r20, r143
  // rating: mi_idx.info,
  Const        r145, "rating"
  Const        r146, "info"
  Index        r147, r81, r146
  // drama_horror_movie: t.title
  Const        r148, "drama_horror_movie"
  Const        r149, "title"
  Index        r150, r48, r149
  // movie_company: cn.name,
  Move         r151, r142
  Move         r152, r144
  // rating: mi_idx.info,
  Move         r153, r145
  Move         r154, r147
  // drama_horror_movie: t.title
  Move         r155, r148
  Move         r156, r150
  // select {
  MakeMap      r157, 3, r151
  // from cn in company_name
  Append       r158, r14, r157
  Move         r14, r158
L8:
  // join it2 in info_type on it2.id == mi_idx.info_type_id
  Const        r159, 1
  Add          r160, r89, r159
  Move         r89, r160
  Jump         L17
L7:
  // join mi_idx in movie_info_idx on mi_idx.movie_id == t.id
  Const        r161, 1
  Add          r162, r78, r161
  Move         r78, r162
  Jump         L18
L6:
  // join it1 in info_type on it1.id == mi.info_type_id
  Const        r163, 1
  Add          r164, r67, r163
  Move         r67, r164
  Jump         L19
L5:
  // join mi in movie_info on mi.movie_id == t.id
  Const        r165, 1
  Add          r166, r56, r165
  Move         r56, r166
  Jump         L20
L4:
  // join t in title on t.id == mc.movie_id
  Const        r167, 1
  Add          r168, r45, r167
  Move         r45, r168
  Jump         L21
L3:
  // join ct in company_type on ct.id == mc.company_type_id
  Const        r169, 1
  Add          r170, r34, r169
  Move         r34, r170
  Jump         L22
L2:
  // join mc in movie_companies on mc.company_id == cn.id
  Const        r171, 1
  Add          r172, r23, r171
  Move         r23, r172
  Jump         L23
L1:
  // from cn in company_name
  Const        r173, 1
  Add          r174, r17, r173
  Move         r17, r174
  Jump         L24
L0:
  // let result =
  Move         r175, r14
  // json(result)
  JSON         r175
  // expect result == [
  Const        r176, [{"drama_horror_movie": "Great Drama", "movie_company": "Best Pictures", "rating": 8.3}]
  Equal        r177, r175, r176
  Expect       r177
  Return       r0
