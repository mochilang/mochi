func main (regs=131)
  // let company_type = [
  Const        r0, [{"id": 1, "kind": "production companies"}, {"id": 2, "kind": "distributors"}]
  // let info_type = [
  Const        r1, [{"id": 10, "info": "top 250 rank"}, {"id": 20, "info": "bottom 10 rank"}]
  // let title = [
  Const        r2, [{"id": 100, "production_year": 1995, "title": "Good Movie"}, {"id": 200, "production_year": 2000, "title": "Bad Movie"}]
  // let movie_companies = [
  Const        r3, [{"company_type_id": 1, "movie_id": 100, "note": "ACME (co-production)"}, {"company_type_id": 1, "movie_id": 200, "note": "MGM (as Metro-Goldwyn-Mayer Pictures)"}]
  // let movie_info_idx = [
  Const        r4, [{"info_type_id": 10, "movie_id": 100}, {"info_type_id": 20, "movie_id": 200}]
  // from ct in company_type
  Const        r5, []
  // where ct.kind == "production companies" &&
  Const        r6, "kind"
  // it.info == "top 250 rank" &&
  Const        r7, "info"
  // (!mc.note.contains("(as Metro-Goldwyn-Mayer Pictures)")) &&
  Const        r8, "note"
  // select { note: mc.note, title: t.title, year: t.production_year }
  Const        r10, "title"
  Const        r11, "year"
  Const        r12, "production_year"
  // from ct in company_type
  IterPrep     r13, r0
  Len          r14, r13
  Const        r16, 0
  Move         r15, r16
L13:
  LessInt      r17, r15, r14
  JumpIfFalse  r17, L0
  Index        r19, r13, r15
  // join mc in movie_companies on ct.id == mc.company_type_id
  IterPrep     r20, r3
  Len          r21, r20
  Const        r22, "id"
  Const        r23, "company_type_id"
  Move         r24, r16
L12:
  LessInt      r25, r24, r21
  JumpIfFalse  r25, L1
  Index        r27, r20, r24
  Index        r28, r19, r22
  Index        r29, r27, r23
  Equal        r30, r28, r29
  JumpIfFalse  r30, L2
  // join t in title on t.id == mc.movie_id
  IterPrep     r31, r2
  Len          r32, r31
  Const        r33, "movie_id"
  Move         r34, r16
L11:
  LessInt      r35, r34, r32
  JumpIfFalse  r35, L2
  Index        r37, r31, r34
  Index        r38, r37, r22
  Index        r39, r27, r33
  Equal        r40, r38, r39
  JumpIfFalse  r40, L3
  // join mi in movie_info_idx on mi.movie_id == t.id
  IterPrep     r41, r4
  Len          r42, r41
  Move         r43, r16
L10:
  LessInt      r44, r43, r42
  JumpIfFalse  r44, L3
  Index        r46, r41, r43
  Index        r47, r46, r33
  Index        r48, r37, r22
  Equal        r49, r47, r48
  JumpIfFalse  r49, L4
  // join it in info_type on it.id == mi.info_type_id
  IterPrep     r50, r1
  Len          r51, r50
  Const        r52, "info_type_id"
  Move         r53, r16
L9:
  LessInt      r54, r53, r51
  JumpIfFalse  r54, L4
  Index        r56, r50, r53
  Index        r57, r56, r22
  Index        r58, r46, r52
  Equal        r59, r57, r58
  JumpIfFalse  r59, L5
  // where ct.kind == "production companies" &&
  Index        r60, r19, r6
  Const        r61, "production companies"
  Equal        r62, r60, r61
  // it.info == "top 250 rank" &&
  Index        r63, r56, r7
  Const        r64, "top 250 rank"
  Equal        r65, r63, r64
  // where ct.kind == "production companies" &&
  Move         r66, r62
  JumpIfFalse  r66, L6
L6:
  // it.info == "top 250 rank" &&
  Move         r67, r65
  JumpIfFalse  r67, L7
  Index        r68, r27, r8
  // (!mc.note.contains("(as Metro-Goldwyn-Mayer Pictures)")) &&
  Const        r69, "(as Metro-Goldwyn-Mayer Pictures)"
  In           r70, r69, r68
  Not          r72, r70
L7:
  JumpIfFalse  r72, L8
  Index        r73, r27, r8
  // (mc.note.contains("(co-production)") || mc.note.contains("(presents)"))
  Const        r74, "(co-production)"
  In           r76, r74, r73
  JumpIfTrue   r76, L8
  Index        r77, r27, r8
  Const        r78, "(presents)"
  In           r72, r78, r77
L8:
  // where ct.kind == "production companies" &&
  JumpIfFalse  r72, L5
  // select { note: mc.note, title: t.title, year: t.production_year }
  Const        r80, "note"
  Index        r81, r27, r8
  Const        r82, "title"
  Index        r83, r37, r10
  Const        r84, "year"
  Index        r85, r37, r12
  MakeMap      r89, 3, r80
  // from ct in company_type
  Append       r5, r5, r89
L5:
  // join it in info_type on it.id == mi.info_type_id
  Const        r91, 1
  Add          r53, r53, r91
  Jump         L9
L4:
  // join mi in movie_info_idx on mi.movie_id == t.id
  Add          r43, r43, r91
  Jump         L10
L3:
  // join t in title on t.id == mc.movie_id
  Add          r34, r34, r91
  Jump         L11
L2:
  // join mc in movie_companies on ct.id == mc.company_type_id
  Jump         L12
L1:
  // from ct in company_type
  AddInt       r15, r15, r91
  Jump         L13
L0:
  // production_note: min(from r in filtered select r.note),
  Const        r92, "production_note"
  Const        r93, []
  IterPrep     r94, r5
  Len          r95, r94
  Move         r96, r16
L15:
  LessInt      r97, r96, r95
  JumpIfFalse  r97, L14
  Index        r99, r94, r96
  Index        r100, r99, r8
  Append       r93, r93, r100
  AddInt       r96, r96, r91
  Jump         L15
L14:
  // movie_title: min(from r in filtered select r.title),
  Const        r104, []
  IterPrep     r105, r5
  Len          r106, r105
  Move         r107, r16
L17:
  LessInt      r108, r107, r106
  JumpIfFalse  r108, L16
  Index        r99, r105, r107
  Index        r110, r99, r10
  Append       r104, r104, r110
  AddInt       r107, r107, r91
  Jump         L17
L16:
  // movie_year: min(from r in filtered select r.year)
  Const        r114, []
  IterPrep     r115, r5
  Len          r116, r115
  Move         r117, r16
L19:
  LessInt      r118, r117, r116
  JumpIfFalse  r118, L18
  Index        r99, r115, r117
  Index        r120, r99, r11
  Append       r114, r114, r120
  AddInt       r117, r117, r91
  Jump         L19
L18:
  // let result = {
  MakeMap      r126, 3, r92
  // json([result])
  Move         r127, r126
  MakeList     r128, 1, r127
  JSON         r128
  // expect result == {
  Const        r129, {"movie_title": "Good Movie", "movie_year": 1995, "production_note": "ACME (co-production)"}
  Equal        r130, r126, r129
  Expect       r130
  Return       r0
