/*
# line: 94
CREATE TABLE t1(a INTEGER, b INTEGER, c INTEGER, d INTEGER, e INTEGER)
INSERT INTO t1(e,c,b,d,a) VALUES(103,102,100,101,104)
INSERT INTO t1(a,c,d,e,b) VALUES(107,106,108,109,105)
INSERT INTO t1(e,d,b,a,c) VALUES(110,114,112,111,113)
INSERT INTO t1(d,c,e,a,b) VALUES(116,119,117,115,118)
INSERT INTO t1(c,d,b,e,a) VALUES(123,122,124,120,121)
INSERT INTO t1(a,d,b,e,c) VALUES(127,128,129,126,125)
INSERT INTO t1(e,c,a,d,b) VALUES(132,134,131,133,130)
INSERT INTO t1(a,d,b,e,c) VALUES(138,136,139,135,137)
INSERT INTO t1(e,c,d,a,b) VALUES(144,141,140,142,143)
INSERT INTO t1(b,a,e,d,c) VALUES(145,149,146,148,147)
INSERT INTO t1(b,c,a,d,e) VALUES(151,150,153,154,152)
INSERT INTO t1(c,e,a,d,b) VALUES(155,157,159,156,158)
INSERT INTO t1(c,b,a,d,e) VALUES(161,160,163,164,162)
INSERT INTO t1(b,d,a,e,c) VALUES(167,169,168,165,166)
INSERT INTO t1(d,b,c,e,a) VALUES(171,170,172,173,174)
INSERT INTO t1(e,c,a,d,b) VALUES(177,176,179,178,175)
INSERT INTO t1(b,e,a,d,c) VALUES(181,180,182,183,184)
INSERT INTO t1(c,a,b,e,d) VALUES(187,188,186,189,185)
INSERT INTO t1(d,b,c,e,a) VALUES(190,194,193,192,191)
INSERT INTO t1(a,e,b,d,c) VALUES(199,197,198,196,195)
INSERT INTO t1(b,c,d,a,e) VALUES(200,202,203,201,204)
INSERT INTO t1(c,e,a,b,d) VALUES(208,209,205,206,207)
INSERT INTO t1(c,e,a,d,b) VALUES(214,210,213,212,211)
INSERT INTO t1(b,c,a,d,e) VALUES(218,215,216,217,219)
INSERT INTO t1(b,e,d,a,c) VALUES(223,221,222,220,224)
INSERT INTO t1(d,e,b,a,c) VALUES(226,227,228,229,225)
INSERT INTO t1(a,c,b,e,d) VALUES(234,231,232,230,233)
INSERT INTO t1(e,b,a,c,d) VALUES(237,236,239,235,238)
INSERT INTO t1(e,c,b,a,d) VALUES(242,244,240,243,241)
INSERT INTO t1(e,d,c,b,a) VALUES(246,248,247,249,245)
*/

let t1 = [
  {
    a: 103,
    b: 102,
    c: 100,
    d: 101,
    e: 104,
  },
  {
    a: 107,
    b: 106,
    c: 108,
    d: 109,
    e: 105,
  },
  {
    a: 110,
    b: 114,
    c: 112,
    d: 111,
    e: 113,
  },
  {
    a: 116,
    b: 119,
    c: 117,
    d: 115,
    e: 118,
  },
  {
    a: 123,
    b: 122,
    c: 124,
    d: 120,
    e: 121,
  },
  {
    a: 127,
    b: 128,
    c: 129,
    d: 126,
    e: 125,
  },
  {
    a: 132,
    b: 134,
    c: 131,
    d: 133,
    e: 130,
  },
  {
    a: 138,
    b: 136,
    c: 139,
    d: 135,
    e: 137,
  },
  {
    a: 144,
    b: 141,
    c: 140,
    d: 142,
    e: 143,
  },
  {
    a: 145,
    b: 149,
    c: 146,
    d: 148,
    e: 147,
  },
  {
    a: 151,
    b: 150,
    c: 153,
    d: 154,
    e: 152,
  },
  {
    a: 155,
    b: 157,
    c: 159,
    d: 156,
    e: 158,
  },
  {
    a: 161,
    b: 160,
    c: 163,
    d: 164,
    e: 162,
  },
  {
    a: 167,
    b: 169,
    c: 168,
    d: 165,
    e: 166,
  },
  {
    a: 171,
    b: 170,
    c: 172,
    d: 173,
    e: 174,
  },
  {
    a: 177,
    b: 176,
    c: 179,
    d: 178,
    e: 175,
  },
  {
    a: 181,
    b: 180,
    c: 182,
    d: 183,
    e: 184,
  },
  {
    a: 187,
    b: 188,
    c: 186,
    d: 189,
    e: 185,
  },
  {
    a: 190,
    b: 194,
    c: 193,
    d: 192,
    e: 191,
  },
  {
    a: 199,
    b: 197,
    c: 198,
    d: 196,
    e: 195,
  },
  {
    a: 200,
    b: 202,
    c: 203,
    d: 201,
    e: 204,
  },
  {
    a: 208,
    b: 209,
    c: 205,
    d: 206,
    e: 207,
  },
  {
    a: 214,
    b: 210,
    c: 213,
    d: 212,
    e: 211,
  },
  {
    a: 218,
    b: 215,
    c: 216,
    d: 217,
    e: 219,
  },
  {
    a: 223,
    b: 221,
    c: 222,
    d: 220,
    e: 224,
  },
  {
    a: 226,
    b: 227,
    c: 228,
    d: 229,
    e: 225,
  },
  {
    a: 234,
    b: 231,
    c: 232,
    d: 230,
    e: 233,
  },
  {
    a: 237,
    b: 236,
    c: 239,
    d: 235,
    e: 238,
  },
  {
    a: 242,
    b: 244,
    c: 240,
    d: 243,
    e: 241,
  },
  {
    a: 246,
    b: 248,
    c: 247,
    d: 249,
    e: 245,
  },
]

/* SELECT CASE WHEN c>(SELECT avg(c) FROM t1) THEN a*2 ELSE b*10 END FROM t1 ORDER BY 1 */
let result = from row in t1
  order by 1
  select (row["c"] > avg(from x in t1
  select x["c"]) ? row["a"] * 2 : row["b"] * 10)
for x in result {
  print(x)
}

test "case1" {
  expect result == [354, 362, 374, 380, 398, 400, 416, 428, 436, 446, 452, 468, 474, 484, 492, 1020, 1060, 1140, 1190, 1220, 1280, 1340, 1360, 1410, 1490, 1500, 1570, 1600, 1690, 1700]
}
