/*
# line: 94
CREATE TABLE t1(a INTEGER, b INTEGER, c INTEGER, d INTEGER, e INTEGER)
INSERT INTO t1(e,c,b,d,a) VALUES(103,102,100,101,104)
INSERT INTO t1(a,c,d,e,b) VALUES(107,106,108,109,105)
INSERT INTO t1(e,d,b,a,c) VALUES(110,114,112,111,113)
INSERT INTO t1(d,c,e,a,b) VALUES(116,119,117,115,118)
INSERT INTO t1(c,d,b,e,a) VALUES(123,122,124,120,121)
INSERT INTO t1(a,d,b,e,c) VALUES(127,128,129,126,125)
INSERT INTO t1(e,c,a,d,b) VALUES(132,134,131,133,130)
INSERT INTO t1(a,d,b,e,c) VALUES(138,136,139,135,137)
INSERT INTO t1(e,c,d,a,b) VALUES(144,141,140,142,143)
INSERT INTO t1(b,a,e,d,c) VALUES(145,149,146,148,147)
INSERT INTO t1(b,c,a,d,e) VALUES(151,150,153,154,152)
INSERT INTO t1(c,e,a,d,b) VALUES(155,157,159,156,158)
INSERT INTO t1(c,b,a,d,e) VALUES(161,160,163,164,162)
INSERT INTO t1(b,d,a,e,c) VALUES(167,169,168,165,166)
INSERT INTO t1(d,b,c,e,a) VALUES(171,170,172,173,174)
INSERT INTO t1(e,c,a,d,b) VALUES(177,176,179,178,175)
INSERT INTO t1(b,e,a,d,c) VALUES(181,180,182,183,184)
INSERT INTO t1(c,a,b,e,d) VALUES(187,188,186,189,185)
INSERT INTO t1(d,b,c,e,a) VALUES(190,194,193,192,191)
INSERT INTO t1(a,e,b,d,c) VALUES(199,197,198,196,195)
INSERT INTO t1(b,c,d,a,e) VALUES(200,202,203,201,204)
INSERT INTO t1(c,e,a,b,d) VALUES(208,209,205,206,207)
INSERT INTO t1(c,e,a,d,b) VALUES(214,210,213,212,211)
INSERT INTO t1(b,c,a,d,e) VALUES(218,215,216,217,219)
INSERT INTO t1(b,e,d,a,c) VALUES(223,221,222,220,224)
INSERT INTO t1(d,e,b,a,c) VALUES(226,227,228,229,225)
INSERT INTO t1(a,c,b,e,d) VALUES(234,231,232,230,233)
INSERT INTO t1(e,b,a,c,d) VALUES(237,236,239,235,238)
INSERT INTO t1(e,c,b,a,d) VALUES(242,244,240,243,241)
INSERT INTO t1(e,d,c,b,a) VALUES(246,248,247,249,245)
*/

type t1Row {
  a: int
  b: int
  c: int
  d: int
  e: int
}

let t1 = [
  t1Row {
    a: 104,
    b: 100,
    c: 102,
    d: 101,
    e: 103,
  },
  t1Row {
    a: 107,
    b: 105,
    c: 106,
    d: 108,
    e: 109,
  },
  t1Row {
    a: 111,
    b: 112,
    c: 113,
    d: 114,
    e: 110,
  },
  t1Row {
    a: 115,
    b: 118,
    c: 119,
    d: 116,
    e: 117,
  },
  t1Row {
    a: 121,
    b: 124,
    c: 123,
    d: 122,
    e: 120,
  },
  t1Row {
    a: 127,
    b: 129,
    c: 125,
    d: 128,
    e: 126,
  },
  t1Row {
    a: 131,
    b: 130,
    c: 134,
    d: 133,
    e: 132,
  },
  t1Row {
    a: 138,
    b: 139,
    c: 137,
    d: 136,
    e: 135,
  },
  t1Row {
    a: 142,
    b: 143,
    c: 141,
    d: 140,
    e: 144,
  },
  t1Row {
    a: 149,
    b: 145,
    c: 147,
    d: 148,
    e: 146,
  },
  t1Row {
    a: 153,
    b: 151,
    c: 150,
    d: 154,
    e: 152,
  },
  t1Row {
    a: 159,
    b: 158,
    c: 155,
    d: 156,
    e: 157,
  },
  t1Row {
    a: 163,
    b: 160,
    c: 161,
    d: 164,
    e: 162,
  },
  t1Row {
    a: 168,
    b: 167,
    c: 166,
    d: 169,
    e: 165,
  },
  t1Row {
    a: 174,
    b: 170,
    c: 172,
    d: 171,
    e: 173,
  },
  t1Row {
    a: 179,
    b: 175,
    c: 176,
    d: 178,
    e: 177,
  },
  t1Row {
    a: 182,
    b: 181,
    c: 184,
    d: 183,
    e: 180,
  },
  t1Row {
    a: 188,
    b: 186,
    c: 187,
    d: 185,
    e: 189,
  },
  t1Row {
    a: 191,
    b: 194,
    c: 193,
    d: 190,
    e: 192,
  },
  t1Row {
    a: 199,
    b: 198,
    c: 195,
    d: 196,
    e: 197,
  },
  t1Row {
    a: 201,
    b: 200,
    c: 202,
    d: 203,
    e: 204,
  },
  t1Row {
    a: 205,
    b: 206,
    c: 208,
    d: 207,
    e: 209,
  },
  t1Row {
    a: 213,
    b: 211,
    c: 214,
    d: 212,
    e: 210,
  },
  t1Row {
    a: 216,
    b: 218,
    c: 215,
    d: 217,
    e: 219,
  },
  t1Row {
    a: 220,
    b: 223,
    c: 224,
    d: 222,
    e: 221,
  },
  t1Row {
    a: 229,
    b: 228,
    c: 225,
    d: 226,
    e: 227,
  },
  t1Row {
    a: 234,
    b: 232,
    c: 231,
    d: 233,
    e: 230,
  },
  t1Row {
    a: 239,
    b: 236,
    c: 235,
    d: 238,
    e: 237,
  },
  t1Row {
    a: 243,
    b: 240,
    c: 244,
    d: 241,
    e: 242,
  },
  t1Row {
    a: 245,
    b: 249,
    c: 247,
    d: 248,
    e: 246,
  },
]

/* SELECT CASE WHEN c>(SELECT avg(c) FROM t1) THEN a*2 ELSE b*10 END FROM t1 ORDER BY 1 */
let sub0 = avg(from x in t1
  select x.c)

var result = from row in t1
  order by (if row.c > sub0 { (row.a * 2) } else { (row.b * 10) })
  select (if row.c > sub0 { (row.a * 2) } else { (row.b * 10) })
for x in result {
  print(x)
}

test "case1" {
  expect result == [358, 364, 376, 382, 398, 402, 410, 426, 432, 440, 458, 468, 478, 486, 490, 1000, 1050, 1120, 1180, 1240, 1290, 1300, 1390, 1430, 1450, 1510, 1580, 1600, 1670, 1700]
}
