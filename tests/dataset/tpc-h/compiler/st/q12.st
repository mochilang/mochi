" Generated by Mochi compiler v0.10.25 on 2025-07-13T17:00:45Z
"
| orders lineitem result |
orders := {Dictionary from:{'o_orderkey'->1. 'o_orderpriority'->'1-URGENT'}. Dictionary from:{'o_orderkey'->2. 'o_orderpriority'->'3-MEDIUM'}}.
lineitem := {Dictionary from:{'l_orderkey'->1. 'l_shipmode'->'MAIL'. 'l_commitdate'->'1994-02-10'. 'l_receiptdate'->'1994-02-15'. 'l_shipdate'->'1994-02-05'}. Dictionary from:{'l_orderkey'->2. 'l_shipmode'->'SHIP'. 'l_commitdate'->'1994-03-01'. 'l_receiptdate'->'1994-02-28'. 'l_shipdate'->'1994-02-27'}}.
result := [ | groups tmp |
  groups := Dictionary new.
  tmp := OrderedCollection new.
  lineitem do: [:l |
    orders do: [:o |
      ((((((((((((l at: 'l_shipmode') in ({'MAIL'. 'SHIP'}))) and: [(((l at: 'l_commitdate') < (l at: 'l_receiptdate')))])) and: [(((l at: 'l_shipdate') < (l at: 'l_commitdate')))])) and: [(((l at: 'l_receiptdate') >= '1994-01-01'))])) and: [(((l at: 'l_receiptdate') < '1995-01-01'))]) and: [(o.o_orderkey = l.l_orderkey)])) ifTrue: [
        | g |
        g := groups at: (l at: 'l_shipmode') ifAbsentPut:[OrderedCollection new].
        g add: Dictionary from:{#l->l. #o->o}.
      ].
    ].
  ].
  groups keysAndValuesDo: [:k :grp |
    | g |
    g := Dictionary from:{'key'->k. 'items'->grp}.
    tmp add: Dictionary from:{'l_shipmode'->g.key. 'high_line_count'->(([ | tmp |
  tmp := OrderedCollection new.
  g do: [:x |
    tmp add: (((x at: 'o' at: 'o_orderpriority') in ({'1-URGENT'. '2-HIGH'}))) ifTrue: [1] ifFalse: [0].
  ].
  tmp
] value inject: 0 into: [:s :x | s + x])). 'low_line_count'->(([ | tmp |
  tmp := OrderedCollection new.
  g do: [:x |
    tmp add: (((x at: 'o' at: 'o_orderpriority') in ({'1-URGENT'. '2-HIGH'})) not) ifTrue: [1] ifFalse: [0].
  ].
  tmp
] value inject: 0 into: [:s :x | s + x]))}.
  ].
  tmp := tmp asSortedCollection: [:a :b | g.key < g.key].
  tmp
] value.
json value: result.
((result = ({Dictionary from:{'l_shipmode'->'MAIL'. 'high_line_count'->1. 'low_line_count'->0}}))) ifTrue: [Transcript show:'ok'; cr] ifFalse: [Transcript show:'fail'; cr].
