Let’s move on to **TPC-H Query 16**, which identifies **suppliers who do not supply parts** of a given brand and type, and who also meet other exclusion criteria.

---

## 🧾 TPC-H Query 16 — Parts/Supplier Exclusion

### ✅ **SQL Overview**

```sql
SELECT
  s_name,
  s_address
FROM
  supplier
WHERE
  s_suppkey NOT IN (
    SELECT
      ps_suppkey
    FROM
      partsupp,
      part
    WHERE
      ps_partkey = p_partkey
      AND p_brand = ':brand'
      AND p_type LIKE ':type%'
      AND p_size = :size
  )
  AND s_comment NOT LIKE '%Customer%Complaints%'
ORDER BY
  s_name;
```

### 🧠 Purpose

> Lists suppliers **not linked** to parts of a certain **brand, type prefix, and size**, and whose comments **don’t mention customer complaints**.

---

## 🦊 Mochi Version — Inline + Test

We simulate:

* 2 suppliers (1 with bad comment)
* 2 parts (1 matching the exclusion)
* 2 partsupps (linking supplier to part)

---

### 🧾 **Mochi Code**

```mochi
let supplier = [
  {
    s_suppkey: 100,
    s_name: "AlphaSupply",
    s_address: "123 Hilltop",
    s_comment: "Reliable and efficient"
  },
  {
    s_suppkey: 200,
    s_name: "BetaSupply",
    s_address: "456 Riverside",
    s_comment: "Known for Customer Complaints"
  }
]

let part = [
  { p_partkey: 1, p_brand: "Brand#12", p_type: "SMALL ANODIZED", p_size: 5 },
  { p_partkey: 2, p_brand: "Brand#23", p_type: "MEDIUM POLISHED", p_size: 10 }
]

let partsupp = [
  { ps_partkey: 1, ps_suppkey: 100 }, // matches exclusion filter
  { ps_partkey: 2, ps_suppkey: 200 }
]

let excluded_suppliers =
  from ps in partsupp
  join p in part on p.p_partkey == ps.ps_partkey
  where
    p.p_brand == "Brand#12" and
    p.p_type has "SMALL" and
    p.p_size == 5
  select ps.ps_suppkey

let result =
  from s in supplier
  where
    s.s_suppkey not in (x for x in excluded_suppliers) and
    s.s_comment not has "Customer" and s.s_comment not has "Complaints"
  order by s.s_name
  select {
    s_name: s.s_name,
    s_address: s.s_address
  }

print result

test "Q16 returns suppliers not linked to certain parts or complaints" {
  expect result == []
}
```

---

### ✅ Explanation

| Supplier    | Linked to Brand#12 Small part? | Has bad comment? | Included? |
| ----------- | ------------------------------ | ---------------- | --------- |
| AlphaSupply | ✅ via part 1                   | ❌                | ❌         |
| BetaSupply  | ❌                              | ✅                | ❌         |

→ ❌ Both excluded → result is empty list `[]`.

---

Want to proceed to **Query 17**, which involves **expensive parts with small-quantity orders**, using a subquery with **average price comparison**?
