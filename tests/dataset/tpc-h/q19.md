Let‚Äôs continue with **TPC-H Query 19**, which computes revenue from **discounted branded parts** ‚Äî applying a complex set of filters on brand, container, quantity, and size.

---

## üßæ TPC-H Query 19 ‚Äî Discounted Revenue

### ‚úÖ **SQL Overview**

```sql
SELECT
  SUM(l_extendedprice * (1 - l_discount)) AS revenue
FROM
  lineitem,
  part
WHERE
  (
    p_partkey = l_partkey AND
    p_brand = 'Brand#12' AND
    p_container IN ('SM CASE', 'SM BOX', 'SM PACK', 'SM PKG') AND
    l_quantity >= 1 AND l_quantity <= 11 AND
    p_size BETWEEN 1 AND 5 AND
    l_shipmode IN ('AIR', 'AIR REG') AND
    l_shipinstruct = 'DELIVER IN PERSON'
  )
  OR
  (
    p_partkey = l_partkey AND
    p_brand = 'Brand#23' AND
    p_container IN ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK') AND
    l_quantity >= 10 AND l_quantity <= 20 AND
    p_size BETWEEN 1 AND 10 AND
    l_shipmode IN ('AIR', 'AIR REG') AND
    l_shipinstruct = 'DELIVER IN PERSON'
  )
  OR
  (
    p_partkey = l_partkey AND
    p_brand = 'Brand#34' AND
    p_container IN ('LG CASE', 'LG BOX', 'LG PACK', 'LG PKG') AND
    l_quantity >= 20 AND l_quantity <= 30 AND
    p_size BETWEEN 1 AND 15 AND
    l_shipmode IN ('AIR', 'AIR REG') AND
    l_shipinstruct = 'DELIVER IN PERSON'
  );
```

### üß† Purpose

> Filters **three brand/container/quantity profiles** with shared constraints on **shipping mode and instruction**, and sums revenue.

---

## ü¶ä Mochi Version ‚Äî Inline + Test

We simulate:

* 3 parts (1 from each brand)
* 3 lineitems ‚Äî only 2 match the complex filters

---

### üßæ **Mochi Code**

```mochi
let part = [
  { p_partkey: 1, p_brand: "Brand#12", p_container: "SM BOX", p_size: 3 },
  { p_partkey: 2, p_brand: "Brand#23", p_container: "MED BOX", p_size: 5 },
  { p_partkey: 3, p_brand: "Brand#34", p_container: "LG BOX", p_size: 15 }
]

let lineitem = [
  {
    l_partkey: 1, l_quantity: 5, l_extendedprice: 1000.0, l_discount: 0.1,
    l_shipmode: "AIR", l_shipinstruct: "DELIVER IN PERSON"
  },
  {
    l_partkey: 2, l_quantity: 15, l_extendedprice: 2000.0, l_discount: 0.05,
    l_shipmode: "AIR REG", l_shipinstruct: "DELIVER IN PERSON"
  },
  {
    l_partkey: 3, l_quantity: 35, l_extendedprice: 1500.0, l_discount: 0.0,
    l_shipmode: "AIR", l_shipinstruct: "DELIVER IN PERSON"
  }
]

let result =
  from l in lineitem
  join p in part on p.p_partkey == l.l_partkey
  where (
    (
      p.p_brand == "Brand#12" and
      p.p_container in ["SM CASE", "SM BOX", "SM PACK", "SM PKG"] and
      l.l_quantity >= 1 and l.l_quantity <= 11 and
      p.p_size >= 1 and p.p_size <= 5
    ) or (
      p.p_brand == "Brand#23" and
      p.p_container in ["MED BAG", "MED BOX", "MED PKG", "MED PACK"] and
      l.l_quantity >= 10 and l.l_quantity <= 20 and
      p.p_size >= 1 and p.p_size <= 10
    ) or (
      p.p_brand == "Brand#34" and
      p.p_container in ["LG CASE", "LG BOX", "LG PACK", "LG PKG"] and
      l.l_quantity >= 20 and l.l_quantity <= 30 and
      p.p_size >= 1 and p.p_size <= 15
    )
  )
  and l.l_shipmode in ["AIR", "AIR REG"]
  and l.l_shipinstruct == "DELIVER IN PERSON"
  select sum(l.l_extendedprice * (1 - l.l_discount))

print result

test "Q19 returns total revenue from qualifying branded parts" {
  // Matches:
  // Line 1: Brand#12 ‚Äî 1000 * 0.9 = 900
  // Line 2: Brand#23 ‚Äî 2000 * 0.95 = 1900
  // Line 3: Brand#34 ‚Äî disqualified due to quantity (35 > 30)
  expect result == 2800.0
}
```

---

### ‚úÖ Summary

| Partkey | Brand    | Container | Qty | Size | Mode    | Match? | Revenue |
| ------- | -------- | --------- | --- | ---- | ------- | ------ | ------- |
| 1       | Brand#12 | SM BOX    | 5   | 3    | AIR     | ‚úÖ      | 900.0   |
| 2       | Brand#23 | MED BOX   | 15  | 5    | AIR REG | ‚úÖ      | 1900.0  |
| 3       | Brand#34 | LG BOX    | 35  | 15   | AIR     | ‚ùå      | ‚Äî       |

---

Ready to continue to **Query 20**, which identifies **suppliers with late delivery of critical parts**, using a subquery with NOT EXISTS?
