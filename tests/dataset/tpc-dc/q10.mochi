type Item { id: int }
type Sale { item_id: int, price: int }

let items = [
  {id: 10}, {id: 11}, {id: 12}, {id: 13}, {id: 14},
  {id: 15}, {id: 16}, {id: 17}, {id: 18}, {id: 19}
]

let sales = [
  {item_id: 10, price: 6}, {item_id: 10, price: 4},
  {item_id: 11, price: 5}, {item_id: 11, price: 6},
  {item_id: 12, price: 6}, {item_id: 12, price: 6},
  {item_id: 13, price: 6}, {item_id: 13, price: 7},
  {item_id: 14, price: 7}, {item_id: 14, price: 7},
  {item_id: 15, price: 7}, {item_id: 15, price: 8},
  {item_id: 16, price: 8}, {item_id: 16, price: 8},
  {item_id: 17, price: 8}, {item_id: 17, price: 9},
  {item_id: 18, price: 9}, {item_id: 18, price: 9},
  {item_id: 19, price: 9}, {item_id: 19, price: 10}
]

let result =
  from s in sales
  join i in items on s.item_id == i.id
  where i.id == 10
  group by i.id into g
  select sum(from x in g select x.price)
  |> first

json(result)

test "TPCDC Q10 simplified" {
  expect result == 10
}
