let v2 = [
  { d_year: 2020, item: "A", avg_monthly_sales: 100.0, sum_sales: 120.0 },
  { d_year: 2020, item: "B", avg_monthly_sales: 80.0, sum_sales: 70.0 },
  { d_year: 2019, item: "C", avg_monthly_sales: 50.0, sum_sales: 60.0 },
  { d_year: 2020, item: "D", avg_monthly_sales: 50.0, sum_sales: 45.0 },
  { d_year: 2020, item: "E", avg_monthly_sales: 75.0, sum_sales: 70.0 }
]

let year = 2020
let orderby = "item"

let result =
  from v in v2
  where v.d_year == year && v.avg_monthly_sales > 0 && abs(v.sum_sales - v.avg_monthly_sales) / v.avg_monthly_sales > 0.1
  order by v.sum_sales - v.avg_monthly_sales, v.item
  select v

json(result)

test "TPCDS Q47 simplified" {
  expect result == [
    { d_year: 2020, item: "B", avg_monthly_sales: 80.0, sum_sales: 70.0 },
    { d_year: 2020, item: "A", avg_monthly_sales: 100.0, sum_sales: 120.0 }
  ]
}
