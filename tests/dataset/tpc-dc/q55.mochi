let date_dim = [{d_date_sk:1, d_year:2000, d_moy:1}]
let item = [
  {i_item_sk:1, i_brand_id:1, i_brand:"BrandA", i_manager_id:1},
  {i_item_sk:2, i_brand_id:2, i_brand:"BrandB", i_manager_id:1}
]
let store_sales = [
  {ss_item_sk:1, ss_sold_date_sk:1, ss_ext_sales_price:100},
  {ss_item_sk:2, ss_sold_date_sk:1, ss_ext_sales_price:50}
]

let result =
  from ss in store_sales
  join d in date_dim on ss.ss_sold_date_sk == d.d_date_sk
  join i in item on ss.ss_item_sk == i.i_item_sk
  where i.i_manager_id == 1 && d.d_year == 2000 && d.d_moy == 1
  group by {brand_id:i.i_brand_id, brand:i.i_brand} into g
  select {brand_id: g.key.brand_id, brand: g.key.brand, ext_price: sum(from x in g select x.ss.ss_ext_sales_price)}

json(result)

test "TPCDC Q55 brand manager" {
  expect result == [
    {brand_id:1, brand:"BrandA", ext_price:100},
    {brand_id:2, brand:"BrandB", ext_price:50}
  ]
}
