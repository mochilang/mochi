# TPC-DC Query 59

Query extracted from the official TPC-DS specification.

## SQL
```sql
[LIMITA] select [LIMITB] s_store_name1,s_store_id1,d_week_seq1
      ,sun_sales1/sun_sales2,mon_sales1/mon_sales2
      ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2
      ,fri_sales1/fri_sales2,sat_sales1/sat_sales2
from
(select s_store_name s_store_name1,wss.d_week_seq d_week_seq1
       ,s_store_id s_store_id1,sun_sales sun_sales1
       ,mon_sales mon_sales1,tue_sales tue_sales1
       ,wed_sales wed_sales1,thu_sales thu_sales1
       ,fri_sales fri_sales1,sat_sales sat_sales1
 from wss,store,date_dim d
 where d.d_week_seq = wss.d_week_seq and
       ss_store_sk = s_store_sk and
       d_month_seq between [DMS] and [DMS] + 11) y,
(select s_store_name s_store_name2,wss.d_week_seq d_week_seq2
       ,s_store_id s_store_id2,sun_sales sun_sales2
       ,mon_sales mon_sales2,tue_sales tue_sales2
       ,wed_sales wed_sales2,thu_sales thu_sales2
       ,fri_sales fri_sales2,sat_sales sat_sales2
 from wss,store,date_dim d
 where d.d_week_seq = wss.d_week_seq and
       ss_store_sk = s_store_sk and
       d_month_seq between [DMS]+ 12 and [DMS] + 23) x
where s_store_id1=s_store_id2
  and d_week_seq1=d_week_seq2-52
order by s_store_name1,s_store_id1,d_week_seq1
[LIMITC];
```

## Expected Output
Example ratios comparing matching weeks:
```json
[
  {"s_store_name1":"Store", "d_week_seq1":1,
   "sun_ratio":2, "mon_ratio":2, "tue_ratio":2, "wed_ratio":2,
   "thu_ratio":2, "fri_ratio":2, "sat_ratio":2},
  {"s_store_name1":"Store", "d_week_seq1":2,
   "sun_ratio":0.6666666666666666, "mon_ratio":0.6666666666666666,
   "tue_ratio":0.6666666666666666, "wed_ratio":0.6666666666666666,
   "thu_ratio":0.6666666666666666, "fri_ratio":0.6666666666666666,
   "sat_ratio":0.6666666666666666}
]
```
