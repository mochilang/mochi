# [Let us count 1 2 3](https://www.spoj.com/problems/PT07D/)

## Problem Summary
For each line with `k n p`, compute the number of trees:
1. labeled unrooted trees,
2. labeled rooted trees,
3. unlabeled rooted trees,
4. unlabeled unrooted trees.
Return each result modulo the prime `p`.

## Algorithm
- **Labeled trees** use Cayley's formulas.
  - Unrooted: `n^(n-2) mod p`.
  - Rooted: `n^(n-1) mod p`.
  Exponentiation is done with binary power.
- **Unlabeled rooted trees** `R[n]` are computed by dynamic programming:
  - `R[1] = 1` and for `n ≥ 2`
    `R[n] = (1/(n-1)) * Σ_{k=1}^{n-1} ( Σ_{d|k} d·R[d] ) · R[n-k]`.
  - Maintain `F[k] = Σ_{d|k} d·R[d]` and update it for multiples of each `n` to avoid recomputing divisors.
- **Unlabeled unrooted trees** `T[n]` derive from `R[n]`:
  `T[n] = R[n] - ½·Σ_{i=1}^{n-1} R[i]·R[n-i] + (n even ? R[n/2]/2 : 0)`.
- All divisions are done with modular inverses since `p` is prime and `n ≤ p` for queries 3–4.

## Complexity
- Cayley computations: `O(log n)`.
- Unlabeled tree DP: `O(n^2)` time and `O(n)` memory.
