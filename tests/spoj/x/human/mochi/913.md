# SPOJ QTREE2 - Query on a tree II

[Problem link](https://www.spoj.com/problems/QTREE2/)

## Algorithm

We preprocess each test case for Lowest Common Ancestor using binary lifting.

1. Build adjacency lists for the tree.
2. Root the tree at node 1 and perform a DFS using a stack to compute for each node:
   - `parent[v]` – immediate parent
   - `depth[v]`
   - `dist[v]` – distance from root
3. Build a `up[i][v]` table where `up[i][v]` is the 2^i-th ancestor of `v`.
4. For a query `DIST a b`:
   - `l = LCA(a,b)` via binary lifting.
   - Answer `dist[a] + dist[b] - 2 * dist[l]`.
5. For a query `KTH a b k`:
   - Compute `l = LCA(a,b)` and `da = depth[a] - depth[l]`.
   - If `k <= da + 1` jump `k-1` ancestors from `a`.
   - Otherwise move from `b` upwards `depth[b] - depth[l] - (k - da - 1)` steps.

Each query runs in `O(log N)` time after an `O(N log N)` preprocessing.
