# [Royal Treasury](https://www.spoj.com/problems/TREASURY)

## Problem Summary
Given a company hierarchy of up to 1000 clerks as a rooted tree (root is 1), pair clerks with their direct subordinates such that the number of disjoint pairs is maximized. Also count how many distinct matchings achieve that maximum.

## Algorithm
Perform a depth-first dynamic programming on the tree. For each node `u` maintain:

- `dp0[u]`: maximum pairs in `u`'s subtree when `u` is free to match with a child.
- `cnt0[u]`: number of ways to achieve `dp0[u]`.
- `dp1[u]`: maximum pairs in `u`'s subtree when `u` is already matched with its parent.
- `cnt1[u]`: ways to achieve `dp1[u]`.

For each node, first compute values of all children. Let `sum` be the total of `dp0` over children and `prod` the product of their `cnt0`.

- `dp1[u] = sum`, `cnt1[u] = prod` (since `u` cannot pair with its children).
- For `dp0[u]`, consider two cases:
  1. `u` unmatched: value `sum` with `prod` ways.
  2. `u` matched with child `v`: value `1 + sum - dp0[v] + dp1[v]` with `cnt1[v] * product_{wâ‰ v} cnt0[w]` ways.

Take the maximum value over all cases and sum the counts for ties. Use arbitrary-precision integers for counting.

The answer for the root (state `dp0[1]`, `cnt0[1]`) is printed.
