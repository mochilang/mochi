# BPRED - Branch Prediction

[Problem statement](https://www.spoj.com/problems/BPRED/)

## Algorithm

For each test case we receive a list of labelled instructions.  Starting at
`start`, each instruction either transfers control to its next instruction
with probability `1 - P` or jumps to a given label with probability `P`.
`start` always proceeds to the next instruction with probability `1` and
`end` terminates the program.  We must compute the expected number of times
that a particular label executes.

1. Map every label to an index `0..N-1` in the order the instructions are given.
2. Build a transition matrix `M` where `M[i][j]` is the probability of
   jumping from instruction `i` to instruction `j`.
   - For a regular instruction `i`, `M[i][i+1] = 1-P` and
     `M[i][branch[i]] = P`.
   - For `start`, `M[start][start+1] = 1`.
   - `end` has no outgoing transitions.
3. The expected visit counts `x` satisfy `x = s + M^T x` where `s` has a 1 at
   the `start` index and zeros elsewhere.  This yields the linear system
   `(I - M^T) x = s`.
4. Solve the system with Gaussian elimination to obtain all expected visit
   counts.  Output the value corresponding to the queried label, formatted to
   five decimal places.

## Correctness

Let `x[i]` be the expected number of times instruction `i` executes.  Each
execution of instruction `j` contributes `M[j][i]` expected executions of `i`.
Since we start with one execution of `start`, the total expectation satisfies

```
x[i] = s[i] + \sum_j M[j][i] * x[j]
```

which is exactly the linear system solved in the algorithm.  The solution of
this system gives the expected number of times each label is executed.

## Complexity Analysis

Building `M` and the matrix `I - M^T` takes `O(N^2)` time and space.  Gaussian
elimination on an `N \times N` system runs in `O(N^3)` time.  With
`N \le 120`, the procedure is easily within the constraints.
