# [Transposing is Even More Fun](https://www.spoj.com/problems/TRANSP2)

Given integers `a` and `b`, let `R = 2^a` and `C = 2^b`.  We must transpose a
`R × C` matrix stored in row-major order using only swaps.  The minimal number of
swaps equals the number of moved elements minus the number of cycles in the
permutation induced by the transposition.

Linearizing positions gives `N = 2^{a+b}` elements.  For `i < N-1`, the
transposition sends `i` to `(i * R) mod (N-1)` while `N-1` stays fixed.  Since
`N-1 = 2^{a+b}-1`, multiplication by `R = 2^a` modulo `N-1` is equivalent to a
rotation of `k = a+b` bits by `a` positions.  Writing `g = gcd(a,b)` and
`L = k / g`, Burnside's lemma yields the number of cycles:

```
cycles = (1/L) * Σ_{d|L} φ(d) · 2^{g·(L/d)}
```

where `φ` is Euler's totient.  The answer is then `2^{k} - cycles` (mod
`1,000,003`).

For each test case we factor `L` (≤ 10^6), generate all its divisors, and compute
the above sum using fast modular exponentiation with precomputed totients.
This leads to `O(divisors(L))` time per case.
