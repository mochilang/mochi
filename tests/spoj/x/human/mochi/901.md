# Index Generation

Parse each document character by character while tracking the current page
(starting at 1). The character `&` outside markers advances the page.
Markers are enclosed in `{}` and may span lines. Newlines inside a marker
are converted to spaces. Spaces directly after `{`, before `}`, or adjacent
to `%`/`$` are ignored.

A marker has the form `{text%primary$secondary}` where `%primary` and
`$secondary` are optional. If `%` is present the primary entry becomes the
name after `%`; otherwise it is `text`. When `$secondary` is present the
page is recorded for that secondary entry under the primary; otherwise the
page is recorded for the primary itself. Duplicate page numbers are ignored.

After scanning a document, primary entries are sorted case-insensitively
along with their secondary entries. Each primary is printed followed by its
sorted list of pages (if any), and its secondary entries prefixed with `+`.
