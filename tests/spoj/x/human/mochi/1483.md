# [PT07G - Colorful Lights Party](https://www.spoj.com/problems/PT07G/)

We are asked to assign each light (vertex) in a tree a unique color from `0` to `n-1` so that each wire
(edge) receives a unique color equal to the absolute difference of its endpoint colors. Such a labeling
is known as a *graceful labeling*.

The problem consists of two types of halls:

- **Small hall** – an arbitrary tree with up to `27` vertices.
- **Large hall** – a "spider" tree made of `k` chains each of length `t`, all attached to a central vertex.
  The total number of vertices is `n = 1 + k*(t+1)`.

## Small hall

Because `n ≤ 27`, we can search for a graceful labeling by backtracking.  We root the tree at
vertex `1` and order its edges via a DFS.  For the `i`-th edge in that order we try to assign the
required difference `d = n-1-i`.  If exactly one endpoint has already been labeled, the other endpoint
is forced to be either `label[parent] ± d`.  We keep track of used labels and used differences to avoid
conflicts.  When all edges have been processed we have a valid labeling.

## Large hall

For the structured "spider" tree we can construct a labeling directly.  Number the vertices so that
for chain `i (1 ≤ i ≤ k)` and position `j (1 ≤ j ≤ t+1)` the vertex index is `1 + i + (j-1)*k`.
Let `n = 1 + k*(t+1)`.  Assign colors as:

```
color(1) = 0
if j is odd:  color(i,j) = n - (i-1)*(t+1) - (j+1)/2
else:         color(i,j) = (i-1)*(t+1) + j/2
```

This interleaves large and small numbers, ensuring that all vertex colors are distinct and the
edge differences cover exactly `1..n-1`.

## Complexity

- Small hall: worst case `O(n!)` backtracking, but `n ≤ 27` keeps it manageable.
- Large hall: `O(k*t)` direct computation.
