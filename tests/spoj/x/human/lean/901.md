# Index Generation

We scan each document character by character while tracking the current page.
A marker is introduced by `{` and closed by `}`; markers may span multiple lines so
newlines inside markers are converted to spaces.  Spaces immediately after `{`,
before `}`, or adjacent to `%` or `$` are ignored.

From the cleaned marker we extract optional primary (`%`) and secondary (`$`)
entries.  If only `$` appears the text before `$` becomes the primary entry.  A
marker contributes the current page to either the primary or secondary entry
depending on whether `$` is present.

All page numbers for an entry are stored in sets to remove duplicates.  For each
primary we also store a map of its secondary entries.  After processing a
document we output primary entries sorted case-insensitively; each secondary
entry under a primary is also sorted.  Page lists are printed in ascending order
after the entry name, separated by commas.
