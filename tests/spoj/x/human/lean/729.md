# Move your armies

[Problem link](https://www.spoj.com/problems/MAXIMUS/)

We have \(N\) armies \(A_1 \ldots A_N\). Only the largest army present in any
country may move and an army can enter a country only if it becomes the
largest there.  Army \(m\) moves clockwise if \(m=1\) or \(m\) is prime and
counter-clockwise otherwise.  Initially all armies stand in country \(C_0\) and
must reach \(C_2\).

Observing that only largest armies move suggests reversing the numbering of
the armies.  After renumbering, the smallest disk moves first and the usual
stacking rule of the Tower of Hanoi applies, but each disk retains the movement
direction of its original number.  Let disk `i` (counting from the top) move
clockwise if the original army `N+1âˆ’i` is `1` or prime and counter-clockwise
otherwise.

For a stack of `i` disks let:
- `R[i]` be the minimal moves to transfer the stack to the next peg clockwise;
- `L[i]` the minimal moves to transfer it to the next peg counter-clockwise.

We process disks from top to bottom.  If disk `i` moves clockwise:
```
R[i] = 2 * L[i-1] + 1
L[i] = 2 * L[i-1] + R[i-1] + 2
```
Otherwise:
```
L[i] = 2 * R[i-1] + 1
R[i] = 2 * R[i-1] + L[i-1] + 2
```
The answer for `N` is `L[N]`, computed iteratively using big integers.
The algorithm runs in \(O(N)\) per test case with \(N \le 5000\).
