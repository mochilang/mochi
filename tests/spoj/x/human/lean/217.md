# [Soldiers on Parade](https://www.spoj.com/problems/SOPARADE)

## Problem Summary
Given a line of `n` soldiers, each must receive a rank from 1 to 4. Adjacent soldiers must differ in rank by at least two. Additionally, every rule specifies a set of positions whose soldiers all must have different ranks. For each test case we must determine whether such an assignment of ranks exists.

## Algorithm
1. The adjacency condition forces soldiers to alternate between two groups of ranks: `{1,2}` and `{3,4}`, and the only forbidden adjacent pair is `2` next to `3`.
2. Try both possible group assignments for the first position (starting with `{1,2}` or `{3,4}`). For a fixed pattern each position has only two possible ranks, which we treat as a boolean variable.
3. For every adjacent pair of positions add the clause `¬xi ∨ ¬xj` to forbid the combination `(2,3)` or `(3,2)`.
4. Each rule can contain at most four positions and at most two from the same group. If a rule contains two positions from the same group, enforce that their variables differ (XOR constraint).
5. The resulting formula is a 2-SAT instance. Construct the implication graph and run Kosaraju's algorithm to check if it is satisfiable.
6. If either group assignment yields a satisfiable formula, output `approved`; otherwise output `rejected`.

This runs in `O(n + p + \sum b_i)` time.
