# BLOCKS - Arranging the Blocks

[https://www.spoj.com/problems/BLOCKS/](https://www.spoj.com/problems/BLOCKS/)

## Solution Explanation

We are given two \(n \times n\) grids filled with coloured blocks.  Each minute every child may
choose one complete row *or* one complete column and arbitrarily permute the
blocks inside it.  Two chosen lines in the same minute must be disjoint, hence
in one minute we can either permute any number of rows or any number of
columns, but not both.  For every test case we must decide whether the initial
configuration can be transformed into the final one and, if possible, find the
minimum number of minutes.

### Observations

* Row/column permutations never change the multiset of all block colours, so a
  necessary condition is that both matrices contain each colour equally often.
  (Each colour appears at most twice.)
* If the matrices are already identical the answer is 0.
* If every row of the first matrix contains exactly the same multiset of colours
  as the corresponding row of the second matrix, then one round of row
  permutations is enough.  The same holds for columns.
* Otherwise we need both row and column permutations.  Because every colour
  appears at most twice we can analyse each colour separately:
    - Performing rows first then columns fails only if some colour occurs twice
      in the **same row** in the initial matrix and both target positions of that
      colour lie in the **same column**.  In such a situation we cannot place the
      two blocks into that column using a single row permutation.
    - Symmetrically, doing columns first fails only if some colour occurs twice
      in the same column initially and its target positions lie in the same row.
* If either of the above strategies is possible we can finish in 2 minutes.  If
  both fail but the global multiset check succeeds, a three step sequence (row →
  column → row or column → row → column) always works.

Therefore the answer is:

* `no` if global colour counts differ,
* `0` if the matrices are equal,
* `1` if every row or every column already matches as a multiset,
* `2` if one of the two-step strategies described above works,
* `3` otherwise.

### Algorithm

For each test case:

1. Read matrices \(P\) and \(Q\).
2. Build frequency arrays and remember up to two positions of each colour in
   both matrices.  If some count differs output `no`.
3. Check for equality, row-multiset equality and column-multiset equality
   (after sorting every row/column).
4. For each colour appearing twice verify the two-step conditions mentioned
   above to decide whether a row-first or column-first transformation is
   possible.
5. Output `0`, `1`, `2`, or `3` accordingly.

The constraints are \(n \le 500\) so the \(O(n^2 \log n)\) sorting of all rows
and columns is easily fast enough.

