# [Family](https://www.spoj.com/problems/FAMILY)

Given a genealogy where each child inherits each gene from either parent with equal probability, we model the distribution of genes of every monster as a probability vector over the unrelated ancestors (roots).  For a root monster `r` the vector has value `1` at index `r` and `0` elsewhere.  For a child `c` with parents `p` and `q` we set

```
vector[c] = (vector[p] + vector[q]) / 2
```

The relatedness of two monsters `x` and `y` equals the expected percentage of common genes, which is the dot product of their vectors:

```
relation(x, y) = Î£_i vector[x][i] * vector[y][i]
```

The graph is acyclic, so we process monsters in topological order.  Probabilities are rational numbers with powers of two denominators; after computing the dot product we convert the result to a decimal percentage without trailing zeros.
