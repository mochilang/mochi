# [The SetStack Computer](https://www.spoj.com/problems/SETSTACK/)

## Problem Summary
Simulate a stack-based machine that operates on sets.  The machine starts with an empty
stack and supports the operations `PUSH`, `DUP`, `UNION`, `INTERSECT`, and `ADD`.  Sets
may contain other sets. After every operation output the cardinality of the set on top of
the stack.  After each test case print `***`.

## Algorithm
1. Maintain a global mapping from a canonical string representation of a set to a unique
   integer identifier.  A parallel list maps identifiers back to their element lists.  The
   empty set has ID 0.
2. Store on the stack only identifiers.  For each command:
   - `PUSH`: push the ID of the empty set.
   - `DUP`: push a copy of the top identifier.
   - `UNION` / `INTERSECT`: pop two identifiers, retrieve the corresponding sets,
     compute the union or intersection of their element IDs and obtain the ID of the
     resulting set through the mapping.
   - `ADD`: pop two identifiers `a` and `b`, insert `a` into set `b`, and push the ID of
     the canonicalized result.
   After every operation, output the size of the set represented by the new top ID.
3. For canonicalization, sort the list of element IDs and remove duplicates before
   forming the key string.  If the key exists in the mapping reuse its ID; otherwise create
   a new one.

This approach ensures that equal sets share the same ID, making operations efficient.  Each
operation runs in time proportional to the size of the sets involved.
