# Barbarians

[SPOJ problem BARB](https://www.spoj.com/problems/BARB/)

## Algorithm

Each barbarian starts at cave `Ci` and moves `Pi` caves forward every year.
During year `t` (0-indexed) the position of barbarian `i` is

```
(Ci + Pi * t) mod M
```

For a fixed number of caves `M`, a collision occurs when two barbarians `i`
and `j` occupy the same cave while both alive:

```
(Ci + Pi * t) ≡ (Cj + Pj * t) (mod M)
```

Rearranging gives a linear congruence:

```
(Pi - Pj) * t ≡ (Cj - Ci) (mod M)
```

Let `limit = min(Li, Lj)` be the number of years both are alive.
For every pair we check the above congruence:

* If `Pi = Pj`, a collision occurs only when `M` divides `Ci - Cj`.
* Otherwise let `g = gcd(|Pi - Pj|, M)`.  A solution exists if
  `g` divides `Cj - Ci`.  The earliest meeting year is
  `t0 = ((Cj - Ci)/g) * inverse((Pi - Pj)/g mod M/g) mod (M/g)`.
  If `t0 < limit` the pair collides for this `M`.

Starting from `M = max(Ci)` we increment `M` until no pair collides.
The first such `M` is the answer.

## Complexity

For `N ≤ 15` barbarians we examine all pairs for each candidate `M`.
The check uses gcd and modular inverse and runs in `O(N^2)` per `M`.
We try values of `M` up to `1e6`, giving worst-case `O(M * N^2)`.
