# [Transposing is Fun](https://www.spoj.com/problems/TRANSP/)

## Problem Summary
Given a $2^a \times 2^b$ array stored row-major, transpose it using only swaps of two positions. For each test case output the minimal number of swaps modulo $1000003$.

## Algorithm
1. An element at $(i,j)$ has index $x = i\cdot 2^b + j$. After transposition the index becomes $x' = j\cdot 2^a + i$. This is equivalent to rotating the $(a+b)$-bit representation of $x$ to the left by $a$ bits.
2. Let $n = a + b$, $g = \gcd(a,b)$ and $m = n/g$. Using Burnside's lemma the number of cycles of this permutation is
   $$\text{cycles} = \frac{1}{m} \sum_{d\mid m} \varphi(d)\, 2^{g\cdot(m/d)}$$
   where $\varphi$ is Euler's totient function.
3. Each cycle of length $L$ needs $L-1$ swaps, so the minimal number of swaps equals $2^n - \text{cycles}$.
4. Factor $m$ (at most $5\cdot 10^5$) to enumerate all divisors and their totients, accumulate the above sum, divide by $m$ via modular inverse, and subtract from $2^n$.

This runs in $O(\tau(m))$ per test, where $\tau(m)$ is the number of divisors of $m$.
