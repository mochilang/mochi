# [New bricks disorder](https://www.spoj.com/problems/BRICKS/)

You are given two strings describing the initial and desired order of bricks.  
Adjacent bricks may only be swapped if their letters belong to one of the given allowed pairs.  
Determine whether the target string can be obtained and, if so, the minimal number of swaps (modulo $2^{32}$).

### Algorithm

1. **Frequency check** – the two strings must contain the same multiset of letters; otherwise the answer is `-1`.
2. **Allowed swaps** – build a $26\times26$ boolean table that marks which letter pairs may be swapped.
3. **Target positions** – for every letter, store the list of positions where it appears in the target string.  
   Scanning the source string from left to right, map each occurrence to its destined index in the target string, forming a permutation.
4. **Inversion counting with validation** –
   - Maintain a Fenwick tree over all positions to count how many processed letters lie after the current position; this yields the number of swaps contributed by the current letter.
   - For correctness, also keep a Fenwick tree per letter type.  
     When a letter is processed, for every previously seen letter type we check how many of its occurrences lie to the right of the current position.  
     If such crossings exist and the pair is not allowed, the transformation is impossible.
5. Sum all counted crossings to obtain the minimal number of swaps and print it modulo $2^{32}$.

The complexity is $O(26 \cdot n \log n)$ per test case with linear memory.
