# Soldiers on Parade

[Problem statement](https://www.spoj.com/problems/SOPARADE/)

## Algorithm

1. Adjacent soldiers must differ in rank by at least two. With ranks 1–4 this forces the row to alternate between the sets `{1,2}` and `{3,4}`. Two parity patterns are possible.
2. Fix a parity pattern. Each position now has only two possible ranks: positions in the first set choose between 1 and 2, and positions in the second set between 3 and 4.
3. For adjacent positions we forbid the combination `(2,3)`, which is encoded as the clause `¬(i=2 ∧ j=3)`.
4. Each additional rule requires a group of positions to have pairwise different ranks. More than two positions from the same set make a rule impossible. If exactly two positions fall in one set, add a constraint that their chosen ranks differ.
5. Translate all constraints into a 2‑SAT instance with one boolean variable per position. Kosaraju's algorithm finds strongly connected components of the implication graph. If a variable and its negation are in the same component, the pattern is impossible.
6. Check both parity patterns; if either is satisfiable, the rules are approved.

## Correctness

- The adjacency rule implies that positions alternate between `{1,2}` and `{3,4}`; trying both starting sets covers all valid arrangements.
- Encoding the forbidden pair `(2,3)` as a 2‑SAT clause ensures that every adjacent pair obeys the difference requirement.
- For each rule, enforcing inequalities within the same set guarantees that all ranks in the group are distinct. Rejecting rules with more than two positions in one set is correct because only two ranks are available there.
- A satisfying assignment of the 2‑SAT instance corresponds to a valid assignment of ranks. If the instance is unsatisfiable, no such assignment exists.

## Complexity Analysis

Let `n` be the number of soldiers and `p` the number of rules. The implication graph has `O(n + p)` edges. Kosaraju's algorithm runs in `O(n + p)` time and the memory usage is also `O(n + p)`.
