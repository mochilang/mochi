# [Zig-Zag Permutation](https://www.spoj.com/problems/ZZPERM/)

## Problem Summary
Given a multiset word `W` over letters `a`–`j` (letters provided in sorted order) and a number `D`, list the zig-zag permutations of `W` whose 1‑based lexicographic rank is divisible by `D`. A word is zig-zag if adjacent letters alternate between `>` and `<` comparisons. After the listed permutations, output the total count of zig-zag permutations of `W` and a blank line.

## Algorithm
1. Use a memoized recursion to count zig-zag permutations for any multiset prefix. The state is `(last letter, direction, counts)` where direction is:
   - `-1` – no comparison yet,
   - `0` – next letter must be smaller,
   - `1` – next letter must be larger.
2. For enumeration, perform lexicographic backtracking.
   - At each node, iterate candidate letters respecting the required inequality.
   - For each candidate, obtain the number of completions from the DP. If the interval of ranks covered by the branch contains no multiple of `D`, skip it by advancing the global rank by that count. Otherwise recurse into it.
3. When all letters are used, output the word if the global rank is divisible by `D`, then increment the rank.
4. The overall total is obtained by calling the counting DP on the initial state.

## Complexity
Let `n` be the length of `W` (≤ 64). The DP explores at most `O(10 · C(n+9,9))` states and each transition considers up to 10 letters. Only branches containing requested ranks are explored, keeping enumeration feasible.
