# [Tom and Jerry](https://www.spoj.com/problems/TOMJERRY/)

## Problem Summary
Given an undirected graph with N rooms and E corridors. Jerry starts at room P, Tom at Q. Each time unit, Jerry moves first to an adjacent room closest to Tom's current position (tie by smallest room number). If he reaches Tom's room he stops. Otherwise Tom moves to one of his adjacent rooms or stays put with equal probability. Find the expected time until they occupy the same room.

## Algorithm
1. For every pair of rooms (u,v) precompute `next[u][v]` – the neighbor of u to which Jerry moves when Tom is in v. To find it, run BFS from v to get distances and choose among u's neighbors the one with minimal distance to v (ties broken by room index).
2. Let `E[u][v]` be the expected time to meet when Jerry is in u and Tom is in v.
   - If `u == v` the expectation is 0.
   - If `next[u][v] == v`, Jerry moves directly to Tom so `E[u][v] = 1`.
   - Otherwise Jerry moves to `j = next[u][v]`. Tom then chooses uniformly among his neighbors and staying. Thus  
     `E[u][v] = 1 + (E[j][v] + Σ_{w∈Adj(v)} E[j][w]) / (deg(v)+1)`.
3. Initialize all expectations to 0 and repeatedly apply the above update (value iteration) until the maximum change over all states is below `1e-9`.
4. Output `E[P][Q]` rounded to three decimals.

## Complexity
- Precomputing all BFS trees: `O(N * (N + E))`.
- Value iteration: `O(N^2 * deg * I)` where `I` is the number of iterations until convergence.
