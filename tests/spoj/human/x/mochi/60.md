# SPOJ DANCE - The Gordian Dance

Link: https://www.spoj.com/problems/DANCE/

## Algorithm

We model the configuration of the two ropes as a *rational tangle* described
by a fraction `p/q`:

- `S` (swapping the middle dancers) corresponds to `x -> x + 1`.
- `R` (rotating the square) corresponds to `x -> -1/x`.

Starting from `0` (two parallel horizontal ropes), we process the given moves to
obtain a fraction `p/q`.  The minimal number of additional moves required to
return to the untangled horizontal configuration is computed using an
Euclidean-like reduction on `p/q`:

1. Reduce `p/q` to lowest terms and ensure `q > 0`.
2. If `p < 0`, apply enough `S` moves to make it non-negative.
3. Repeatedly:
   - If `p >= q`, let `k = p / q` and `r = p % q`.
     - If `r = 0`, the cost is `3*k - 1` (only rotations remain).
     - Otherwise add `3*k` to the answer and continue with `(r, q)`.
   - If `p < q`, let `k = q / p` and `r = q % p`, add `k` to the answer and
     continue with `(p, r)`.
4. If the denominator becomes zero, one final rotation is needed.

This procedure yields the minimal number of moves because each step mimics the
shortest way to decrease the tangle fraction using the allowed operations.

The total time is `O(n)` to process the moves plus `O(log max(p,q))` for the
reduction.
