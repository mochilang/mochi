# TFSETS - Triple-Free Sets

[Problem Link](https://www.spoj.com/problems/TFSETS/)

For a set \(S\) of positive integers to be *strongly triple-free*, it may not contain
both \(x\) and \(2x\), nor both \(x\) and \(3x\) for any \(x\).
Let \(F(n)\) denote the number of strongly triple-free subsets of \(\{1,\dots,n\}\)
modulo \(10^9+1\).

## Algorithm

1. Every integer can be written as \(m\cdot2^a3^b\) where \(m\) is not divisible by 2 or 3.
   Numbers sharing the same \(m\) form an independent component because edges only join
   numbers whose ratio is 2 or 3.  For a fixed component the available numbers are
   \(\{2^a3^b \mid 2^a3^b \le \lfloor n/m \rfloor\}\).
2. The graph on these numbers is a grid where horizontal edges connect consecutive powers
   of 2 and vertical edges connect consecutive powers of 3.  The number of independent
   sets in such a grid for a given limit \(k\) is denoted \(g(k)\).
3. For \(k\le 10^5\) there are only 101 distinct values of \(2^a3^b\).  For each such
   limit we precompute \(g(k)\) using dynamic programming on the grid.  The DP processes
   one row at a time with bitmasks that have no adjacent ones and runs over the smaller
   dimension (at most 11 columns), making it fast.
4. The total answer is the product over all components:
   \[
     F(n) = \prod_{\substack{1\le m\le n\\ \gcd(m,6)=1}}
             g\big(\lfloor n/m \rfloor\big) \pmod{10^9+1}.
   \]
   Using the usual floor-decomposition technique, the range of \(m\) giving the same
   value of \(\lfloor n/m \rfloor\) can be processed in \(O(\sqrt n)\) groups, and we
   count numbers not divisible by 2 or 3 in each range.

This approach runs quickly for \(n \le 10^5\).
