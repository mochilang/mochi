# NCKLCE - Another Necklace Problem

The necklace is a circular array of beads.  Supported operations rotate the
necklace, flip it, swap two positions, paint a clockwise interval with a color
and count the number of color segments either on the whole necklace or on a
clockwise interval.

## Algorithm

We keep the beads in a segment tree with lazy propagation.  Each node stores

* the color at the leftmost position of the segment,
* the color at the rightmost position,
* the number of color segments inside the segment,
* and a lazy value for range painting.

Combining two nodes is done by summing their segment counts and subtracting one
if the boundary colors are equal.  Painting a range sets the node to one segment
with the specified color and propagates the lazy value to children when needed.

Rotation and flip operations are handled by an `offset` and a `rev` flag instead
of modifying the tree.  Mapping a logical position to a physical index uses these
values.  Painting and counting over logical intervals are converted into at most
two physical intervals, depending on wrap around and orientation.

`C` queries use the whole range; if the first and last colors are equal the
resulting segment count is decreased by one to account for the circular border.

The complexity of each update or query is `O(log n)`.
