# EXCHANGE

[Problem on SPOJ](https://www.spoj.com/problems/EXCHANGE/)

We have three currencies and two operations.  Operation **A** converts the same
percentage of Mone and Luck to Rpin.  Operation **B** converts some Rpin to
Mone and Luck where the amounts satisfy `m = Rate * l` and
`m * a_i + l * b_i = x`.

If we buy using operation B on day `i` and later sell on day `j`, the amount of
Rpin grows by the factor

```
(r_i * a_j + b_j) / (r_i * a_i + b_i)
```

where `r_i` is `Rate_i`.  The optimal strategy is to choose sell days `j > i`
that maximise `(r_i * a_j + b_j)` and possibly repeat the process.

Let `best[i]` be the maximum multiplier obtainable from day `i` to the end when
starting with one Rpin.  For day `i` we need the best value of
`(r_i * a_j + b_j) * best[j]` over all `j > i`.  This is a query for the maximum
of lines `y = (a_j * best[j]) * x + (b_j * best[j])` at `x = r_i`.

We process the days backwards while maintaining a Li Chao segment tree of these
lines.  Each iteration queries the tree for `x = Rate_i`, divides by the cost of
buying on day `i`, and inserts the new line for day `i`.

The answer for each test case is `S * best[0]` formatted with three decimals.
