# SPOJ 1465 - On the Way to Find Chris

[Problem statement](https://www.spoj.com/problems/CHRIS/)

Blue Mary starts from Chris' house (node `c`) and knows the locations of Shermie (`s`) and Yashiro (`y`). She first walks to the closer of the two; if Chris is not there she walks to the other. Distances are along unique paths of the weighted tree. For any triple of nodes the search time is

```
min(dist(c,s), dist(c,y)) + dist(s,y)
```

### Algorithm

For three nodes in a tree the intersection of their pairwise paths is a single node `m`. Let the distances from `m` to the three nodes be `a ≥ b ≥ c`. Choosing Chris' house on the shortest branch `c` maximizes the search time which becomes `a + 2·b + c`.

Thus, for every node `v` we need the three longest distances to leaves reached through distinct neighbours. Let these distances be `h1 ≥ h2 ≥ h3`. The best time with center `v` is `h1 + 2·h2 + h3`.

To compute all `hi` efficiently:

1. Perform a DFS to compute for every node the longest downward distance to a leaf for each child (array `down`) and record its parent.
2. Perform a second DFS to propagate the best upward distance (`up`) through the parent, using the top two child depths.
3. For each node gather the distances via all neighbours: `up[v]` for the parent side and `down[child] + weight` for each child. Keep the three largest values and compute `h1 + 2·h2 + h3`.
4. The answer is the maximum over all nodes.

The complexity is `O(n)` per test case and uses `O(n)` memory.
