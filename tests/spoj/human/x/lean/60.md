# SPOJ DANCE - The Gordian Dance

Link: https://www.spoj.com/problems/DANCE/

## Algorithm

The configuration of the two ropes can be described by a **rational tangle**
represented by a fraction `p/q`.

* Move `S` (swap middle dancers) transforms the tangle by `x ↦ x + 1`.
* Move `R` (rotate the square 90° clockwise) transforms it by `x ↦ -1/x`.

Starting from `x = 0` we process the given sequence of moves and obtain a
fraction `p/q` (we allow `q = 0` to denote infinity).  To find the minimal
number of additional moves to return to the untangled horizontal configuration
(`0`), we reduce the fraction using an Euclidean-like process:

1. Normalize `p/q` to lowest terms with `q > 0`.
2. If `p < 0`, apply enough `S` moves to make `p ≥ 0`.
3. Repeatedly:
   * If `p ≥ q`, let `k = p / q` and `r = p % q`.
     - If `r = 0`, the answer increases by `3*k - 1` (only rotations remain).
     - Otherwise add `3*k` and continue with `(r, q)`.
   * If `p < q`, let `k = q / p` and `r = q % p`; add `k` and continue with
     `(p, r)`.
4. If the denominator becomes `0`, one extra rotation is needed.

Processing the moves is `O(n)` and the reduction is `O(log max(p, q))`.
