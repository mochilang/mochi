package main

import (
	"encoding/json"
	"mochi/runtime/vm"
	"os"
)

var progData = []byte(`{"Funcs":[{"Code":[{"Op":0,"A":0,"B":0,"C":0,"D":0,"Val":{"Tag":1,"Int":30,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":7},{"Op":1,"A":1,"B":0,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":7},{"Op":29,"A":2,"B":0,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":8},{"Op":1,"A":3,"B":2,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":8},{"Op":1,"A":4,"B":1,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":9},{"Op":24,"A":5,"B":1,"C":1,"D":4,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":9},{"Op":1,"A":6,"B":5,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":9},{"Op":29,"A":7,"B":0,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":10},{"Op":50,"A":8,"B":7,"C":3,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":10},{"Op":0,"A":9,"B":0,"C":0,"D":0,"Val":{"Tag":1,"Int":1000,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":10},{"Op":54,"A":10,"B":8,"C":9,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":10},{"Op":1,"A":11,"B":10,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":10},{"Op":0,"A":12,"B":0,"C":0,"D":0,"Val":{"Tag":3,"Int":0,"Float":0,"Str":"duration_us","Bool":false,"List":null,"Map":null,"Func":null},"Line":13},{"Op":0,"A":13,"B":0,"C":0,"D":0,"Val":{"Tag":3,"Int":0,"Float":0,"Str":"output","Bool":false,"List":null,"Map":null,"Func":null},"Line":14},{"Op":1,"A":14,"B":12,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":13},{"Op":1,"A":15,"B":11,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":13},{"Op":1,"A":16,"B":13,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":14},{"Op":1,"A":17,"B":6,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":14},{"Op":19,"A":18,"B":2,"C":14,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":12},{"Op":30,"A":18,"B":0,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":12},{"Op":26,"A":0,"B":0,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":0}],"NumRegs":19,"NumParams":0,"Name":"main","Line":0},{"Code":[{"Op":0,"A":1,"B":0,"C":0,"D":0,"Val":{"Tag":1,"Int":1,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":2},{"Op":10,"A":2,"B":0,"C":1,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":2},{"Op":13,"A":2,"B":4,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":2},{"Op":26,"A":0,"B":0,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":2},{"Op":0,"A":4,"B":0,"C":0,"D":0,"Val":{"Tag":1,"Int":1,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":3,"A":5,"B":0,"C":4,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":1,"A":3,"B":5,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":24,"A":6,"B":1,"C":1,"D":3,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":0,"A":8,"B":0,"C":0,"D":0,"Val":{"Tag":1,"Int":2,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":3,"A":9,"B":0,"C":8,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":1,"A":7,"B":9,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":24,"A":10,"B":1,"C":1,"D":7,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":2,"A":11,"B":6,"C":10,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":26,"A":11,"B":0,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":3},{"Op":26,"A":0,"B":0,"C":0,"D":0,"Val":{"Tag":0,"Int":0,"Float":0,"Str":"","Bool":false,"List":null,"Map":null,"Func":null},"Line":0}],"NumRegs":12,"NumParams":1,"Name":"fib","Line":1}],"Types":null,"file":"bench/out/tmp.mochi","source":["fun fib(n: int): int {","  if n \u003c= 1 { return n }","  return fib(n - 1) + fib(n - 2)","}","","// let n = 10","let n = 30","let start = now()","let result = fib(n)","let duration = (now() - start) / 1000","","json({","    \"duration_us\": duration,","    \"output\": result,","})",""]}`)

func main() {
	var p vm.Program
	if err := json.Unmarshal(progData, &p); err != nil {
		panic(err)
	}
	m := vm.New(&p, os.Stdout)
	if err := m.Run(); err != nil {
		panic(err)
	}
}
