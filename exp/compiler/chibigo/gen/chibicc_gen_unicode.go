// Code generated by ccgo from chibicc sources; DO NOT EDIT.

package chibigo

import (
	"modernc.org/libc"
	"unsafe"
)

func encode_utf8(tls *libc.TLS, buf uintptr, c uint32_t) int32 { /* unicode.c:4:5: */
	if c <= uint32_t(0x7F) {
		*(*int8)(unsafe.Pointer(buf)) = int8(c)
		return 1
	}

	if c <= uint32_t(0x7FF) {
		*(*int8)(unsafe.Pointer(buf)) = int8(uint32_t(0b11000000) | c>>6)
		*(*int8)(unsafe.Pointer(buf + 1)) = int8(uint32_t(0b10000000) | c&uint32_t(0b00111111))
		return 2
	}

	if c <= uint32_t(0xFFFF) {
		*(*int8)(unsafe.Pointer(buf)) = int8(uint32_t(0b11100000) | c>>12)
		*(*int8)(unsafe.Pointer(buf + 1)) = int8(uint32_t(0b10000000) | c>>6&uint32_t(0b00111111))
		*(*int8)(unsafe.Pointer(buf + 2)) = int8(uint32_t(0b10000000) | c&uint32_t(0b00111111))
		return 3
	}

	*(*int8)(unsafe.Pointer(buf)) = int8(uint32_t(0b11110000) | c>>18)
	*(*int8)(unsafe.Pointer(buf + 1)) = int8(uint32_t(0b10000000) | c>>12&uint32_t(0b00111111))
	*(*int8)(unsafe.Pointer(buf + 2)) = int8(uint32_t(0b10000000) | c>>6&uint32_t(0b00111111))
	*(*int8)(unsafe.Pointer(buf + 3)) = int8(uint32_t(0b10000000) | c&uint32_t(0b00111111))
	return 4
}

// Read a UTF-8-encoded Unicode code point from a source file.
// We assume that source files are always in UTF-8.
//
// UTF-8 is a variable-width encoding in which one code point is
// encoded in one to four bytes. One byte UTF-8 code points are
// identical to ASCII. Non-ASCII characters are encoded using more
// than one byte.
func decode_utf8(tls *libc.TLS, new_pos uintptr, p uintptr) uint32_t { /* unicode.c:37:10: */
	if int32(uint8(*(*int8)(unsafe.Pointer(p)))) < 128 {
		*(*uintptr)(unsafe.Pointer(new_pos)) = p + uintptr(1)
		return uint32_t(*(*int8)(unsafe.Pointer(p)))
	}

	var start uintptr = p
	var len int32
	var c uint32_t

	if int32(uint8(*(*int8)(unsafe.Pointer(p)))) >= 0b11110000 {
		len = 4
		c = uint32_t(int32(*(*int8)(unsafe.Pointer(p))) & 0b111)
	} else if int32(uint8(*(*int8)(unsafe.Pointer(p)))) >= 0b11100000 {
		len = 3
		c = uint32_t(int32(*(*int8)(unsafe.Pointer(p))) & 0b1111)
	} else if int32(uint8(*(*int8)(unsafe.Pointer(p)))) >= 0b11000000 {
		len = 2
		c = uint32_t(int32(*(*int8)(unsafe.Pointer(p))) & 0b11111)
	} else {
		error_at(tls, start, ts+12104, 0)
	}

	{
		var i int32 = 1
		for ; i < len; i++ {
			if int32(uint8(*(*int8)(unsafe.Pointer(p + uintptr(i)))))>>6 != 0b10 {
				error_at(tls, start, ts+12104, 0)
			}
			c = c<<6 | uint32_t(int32(*(*int8)(unsafe.Pointer(p + uintptr(i))))&0b111111)
		}
	}

	*(*uintptr)(unsafe.Pointer(new_pos)) = p + uintptr(len)
	return c
}

func in_range(tls *libc.TLS, range1 uintptr, c uint32_t) uint8 { /* unicode.c:70:13: */
	{
		var i int32 = 0
		for ; *(*uint32_t)(unsafe.Pointer(range1 + uintptr(i)*4)) != libc.Uint32FromInt32(-1); i = i + 2 {
			if *(*uint32_t)(unsafe.Pointer(range1 + uintptr(i)*4)) <= c && c <= *(*uint32_t)(unsafe.Pointer(range1 + uintptr(i+1)*4)) {
				return uint8(1)
			}
		}
	}
	return uint8(0)
}

// [https://www.sigbus.info/n1570#D] C11 allows not only ASCII but
// some multibyte characters in certan Unicode ranges to be used in an
// identifier.
//
// This function returns true if a given character is acceptable as
// the first character of an identifier.
//
// For example, ¾ (U+00BE) is a valid identifier because characters in
// 0x00BE-0x00C0 are allowed, while neither ⟘ (U+27D8) nor '　'
// (U+3000, full-width space) are allowed because they are out of range.
func is_ident1(tls *libc.TLS, c uint32_t) uint8 { /* unicode.c:87:6: */

	return in_range(tls, uintptr(unsafe.Pointer(&range1)), c)
}

var range1 = [107]uint32_t{
	uint32_t('_'), uint32_t('_'), uint32_t('a'), uint32_t('z'), uint32_t('A'), uint32_t('Z'), uint32_t('$'), uint32_t('$'),
	uint32_t(0x00A8), uint32_t(0x00A8), uint32_t(0x00AA), uint32_t(0x00AA), uint32_t(0x00AD), uint32_t(0x00AD), uint32_t(0x00AF), uint32_t(0x00AF),
	uint32_t(0x00B2), uint32_t(0x00B5), uint32_t(0x00B7), uint32_t(0x00BA), uint32_t(0x00BC), uint32_t(0x00BE), uint32_t(0x00C0), uint32_t(0x00D6),
	uint32_t(0x00D8), uint32_t(0x00F6), uint32_t(0x00F8), uint32_t(0x00FF), uint32_t(0x0100), uint32_t(0x02FF), uint32_t(0x0370), uint32_t(0x167F),
	uint32_t(0x1681), uint32_t(0x180D), uint32_t(0x180F), uint32_t(0x1DBF), uint32_t(0x1E00), uint32_t(0x1FFF), uint32_t(0x200B), uint32_t(0x200D),
	uint32_t(0x202A), uint32_t(0x202E), uint32_t(0x203F), uint32_t(0x2040), uint32_t(0x2054), uint32_t(0x2054), uint32_t(0x2060), uint32_t(0x206F),
	uint32_t(0x2070), uint32_t(0x20CF), uint32_t(0x2100), uint32_t(0x218F), uint32_t(0x2460), uint32_t(0x24FF), uint32_t(0x2776), uint32_t(0x2793),
	uint32_t(0x2C00), uint32_t(0x2DFF), uint32_t(0x2E80), uint32_t(0x2FFF), uint32_t(0x3004), uint32_t(0x3007), uint32_t(0x3021), uint32_t(0x302F),
	uint32_t(0x3031), uint32_t(0x303F), uint32_t(0x3040), uint32_t(0xD7FF), uint32_t(0xF900), uint32_t(0xFD3D), uint32_t(0xFD40), uint32_t(0xFDCF),
	uint32_t(0xFDF0), uint32_t(0xFE1F), uint32_t(0xFE30), uint32_t(0xFE44), uint32_t(0xFE47), uint32_t(0xFFFD),
	uint32_t(0x10000), uint32_t(0x1FFFD), uint32_t(0x20000), uint32_t(0x2FFFD), uint32_t(0x30000), uint32_t(0x3FFFD), uint32_t(0x40000), uint32_t(0x4FFFD),
	uint32_t(0x50000), uint32_t(0x5FFFD), uint32_t(0x60000), uint32_t(0x6FFFD), uint32_t(0x70000), uint32_t(0x7FFFD), uint32_t(0x80000), uint32_t(0x8FFFD),
	uint32_t(0x90000), uint32_t(0x9FFFD), uint32_t(0xA0000), uint32_t(0xAFFFD), uint32_t(0xB0000), uint32_t(0xBFFFD), uint32_t(0xC0000), uint32_t(0xCFFFD),
	uint32_t(0xD0000), uint32_t(0xDFFFD), uint32_t(0xE0000), uint32_t(0xEFFFD), libc.Uint32FromInt32(-1),
} /* unicode.c:88:19 */

// Returns true if a given character is acceptable as a non-first
// character of an identifier.
func is_ident2(tls *libc.TLS, c uint32_t) uint8 { /* unicode.c:110:6: */

	return uint8(libc.Bool32(is_ident1(tls, c) != 0 || in_range(tls, uintptr(unsafe.Pointer(&range2)), c) != 0))
}

var range2 = [13]uint32_t{
	uint32_t('0'), uint32_t('9'), uint32_t('$'), uint32_t('$'), uint32_t(0x0300), uint32_t(0x036F), uint32_t(0x1DC0), uint32_t(0x1DFF), uint32_t(0x20D0), uint32_t(0x20FF),
	uint32_t(0xFE20), uint32_t(0xFE2F), libc.Uint32FromInt32(-1),
} /* unicode.c:111:19 */

// Returns the number of columns needed to display a given
// character in a fixed-width font.
//
// Based on https://www.cl.cam.ac.uk/~mgk25/ucs/wcwidth.c
func char_width(tls *libc.TLS, c uint32_t) int32 { /* unicode.c:123:12: */

	if in_range(tls, uintptr(unsafe.Pointer(&range11)), c) != 0 {
		return 0
	}

	if in_range(tls, uintptr(unsafe.Pointer(&range21)), c) != 0 {
		return 2
	}
	return 1
}

var range11 = [289]uint32_t{
	uint32_t(0x0000), uint32_t(0x001F), uint32_t(0x007f), uint32_t(0x00a0), uint32_t(0x0300), uint32_t(0x036F), uint32_t(0x0483), uint32_t(0x0486),
	uint32_t(0x0488), uint32_t(0x0489), uint32_t(0x0591), uint32_t(0x05BD), uint32_t(0x05BF), uint32_t(0x05BF), uint32_t(0x05C1), uint32_t(0x05C2),
	uint32_t(0x05C4), uint32_t(0x05C5), uint32_t(0x05C7), uint32_t(0x05C7), uint32_t(0x0600), uint32_t(0x0603), uint32_t(0x0610), uint32_t(0x0615),
	uint32_t(0x064B), uint32_t(0x065E), uint32_t(0x0670), uint32_t(0x0670), uint32_t(0x06D6), uint32_t(0x06E4), uint32_t(0x06E7), uint32_t(0x06E8),
	uint32_t(0x06EA), uint32_t(0x06ED), uint32_t(0x070F), uint32_t(0x070F), uint32_t(0x0711), uint32_t(0x0711), uint32_t(0x0730), uint32_t(0x074A),
	uint32_t(0x07A6), uint32_t(0x07B0), uint32_t(0x07EB), uint32_t(0x07F3), uint32_t(0x0901), uint32_t(0x0902), uint32_t(0x093C), uint32_t(0x093C),
	uint32_t(0x0941), uint32_t(0x0948), uint32_t(0x094D), uint32_t(0x094D), uint32_t(0x0951), uint32_t(0x0954), uint32_t(0x0962), uint32_t(0x0963),
	uint32_t(0x0981), uint32_t(0x0981), uint32_t(0x09BC), uint32_t(0x09BC), uint32_t(0x09C1), uint32_t(0x09C4), uint32_t(0x09CD), uint32_t(0x09CD),
	uint32_t(0x09E2), uint32_t(0x09E3), uint32_t(0x0A01), uint32_t(0x0A02), uint32_t(0x0A3C), uint32_t(0x0A3C), uint32_t(0x0A41), uint32_t(0x0A42),
	uint32_t(0x0A47), uint32_t(0x0A48), uint32_t(0x0A4B), uint32_t(0x0A4D), uint32_t(0x0A70), uint32_t(0x0A71), uint32_t(0x0A81), uint32_t(0x0A82),
	uint32_t(0x0ABC), uint32_t(0x0ABC), uint32_t(0x0AC1), uint32_t(0x0AC5), uint32_t(0x0AC7), uint32_t(0x0AC8), uint32_t(0x0ACD), uint32_t(0x0ACD),
	uint32_t(0x0AE2), uint32_t(0x0AE3), uint32_t(0x0B01), uint32_t(0x0B01), uint32_t(0x0B3C), uint32_t(0x0B3C), uint32_t(0x0B3F), uint32_t(0x0B3F),
	uint32_t(0x0B41), uint32_t(0x0B43), uint32_t(0x0B4D), uint32_t(0x0B4D), uint32_t(0x0B56), uint32_t(0x0B56), uint32_t(0x0B82), uint32_t(0x0B82),
	uint32_t(0x0BC0), uint32_t(0x0BC0), uint32_t(0x0BCD), uint32_t(0x0BCD), uint32_t(0x0C3E), uint32_t(0x0C40), uint32_t(0x0C46), uint32_t(0x0C48),
	uint32_t(0x0C4A), uint32_t(0x0C4D), uint32_t(0x0C55), uint32_t(0x0C56), uint32_t(0x0CBC), uint32_t(0x0CBC), uint32_t(0x0CBF), uint32_t(0x0CBF),
	uint32_t(0x0CC6), uint32_t(0x0CC6), uint32_t(0x0CCC), uint32_t(0x0CCD), uint32_t(0x0CE2), uint32_t(0x0CE3), uint32_t(0x0D41), uint32_t(0x0D43),
	uint32_t(0x0D4D), uint32_t(0x0D4D), uint32_t(0x0DCA), uint32_t(0x0DCA), uint32_t(0x0DD2), uint32_t(0x0DD4), uint32_t(0x0DD6), uint32_t(0x0DD6),
	uint32_t(0x0E31), uint32_t(0x0E31), uint32_t(0x0E34), uint32_t(0x0E3A), uint32_t(0x0E47), uint32_t(0x0E4E), uint32_t(0x0EB1), uint32_t(0x0EB1),
	uint32_t(0x0EB4), uint32_t(0x0EB9), uint32_t(0x0EBB), uint32_t(0x0EBC), uint32_t(0x0EC8), uint32_t(0x0ECD), uint32_t(0x0F18), uint32_t(0x0F19),
	uint32_t(0x0F35), uint32_t(0x0F35), uint32_t(0x0F37), uint32_t(0x0F37), uint32_t(0x0F39), uint32_t(0x0F39), uint32_t(0x0F71), uint32_t(0x0F7E),
	uint32_t(0x0F80), uint32_t(0x0F84), uint32_t(0x0F86), uint32_t(0x0F87), uint32_t(0x0F90), uint32_t(0x0F97), uint32_t(0x0F99), uint32_t(0x0FBC),
	uint32_t(0x0FC6), uint32_t(0x0FC6), uint32_t(0x102D), uint32_t(0x1030), uint32_t(0x1032), uint32_t(0x1032), uint32_t(0x1036), uint32_t(0x1037),
	uint32_t(0x1039), uint32_t(0x1039), uint32_t(0x1058), uint32_t(0x1059), uint32_t(0x1160), uint32_t(0x11FF), uint32_t(0x135F), uint32_t(0x135F),
	uint32_t(0x1712), uint32_t(0x1714), uint32_t(0x1732), uint32_t(0x1734), uint32_t(0x1752), uint32_t(0x1753), uint32_t(0x1772), uint32_t(0x1773),
	uint32_t(0x17B4), uint32_t(0x17B5), uint32_t(0x17B7), uint32_t(0x17BD), uint32_t(0x17C6), uint32_t(0x17C6), uint32_t(0x17C9), uint32_t(0x17D3),
	uint32_t(0x17DD), uint32_t(0x17DD), uint32_t(0x180B), uint32_t(0x180D), uint32_t(0x18A9), uint32_t(0x18A9), uint32_t(0x1920), uint32_t(0x1922),
	uint32_t(0x1927), uint32_t(0x1928), uint32_t(0x1932), uint32_t(0x1932), uint32_t(0x1939), uint32_t(0x193B), uint32_t(0x1A17), uint32_t(0x1A18),
	uint32_t(0x1B00), uint32_t(0x1B03), uint32_t(0x1B34), uint32_t(0x1B34), uint32_t(0x1B36), uint32_t(0x1B3A), uint32_t(0x1B3C), uint32_t(0x1B3C),
	uint32_t(0x1B42), uint32_t(0x1B42), uint32_t(0x1B6B), uint32_t(0x1B73), uint32_t(0x1DC0), uint32_t(0x1DCA), uint32_t(0x1DFE), uint32_t(0x1DFF),
	uint32_t(0x200B), uint32_t(0x200F), uint32_t(0x202A), uint32_t(0x202E), uint32_t(0x2060), uint32_t(0x2063), uint32_t(0x206A), uint32_t(0x206F),
	uint32_t(0x20D0), uint32_t(0x20EF), uint32_t(0x302A), uint32_t(0x302F), uint32_t(0x3099), uint32_t(0x309A), uint32_t(0xA806), uint32_t(0xA806),
	uint32_t(0xA80B), uint32_t(0xA80B), uint32_t(0xA825), uint32_t(0xA826), uint32_t(0xFB1E), uint32_t(0xFB1E), uint32_t(0xFE00), uint32_t(0xFE0F),
	uint32_t(0xFE20), uint32_t(0xFE23), uint32_t(0xFEFF), uint32_t(0xFEFF), uint32_t(0xFFF9), uint32_t(0xFFFB), uint32_t(0x10A01), uint32_t(0x10A03),
	uint32_t(0x10A05), uint32_t(0x10A06), uint32_t(0x10A0C), uint32_t(0x10A0F), uint32_t(0x10A38), uint32_t(0x10A3A), uint32_t(0x10A3F), uint32_t(0x10A3F),
	uint32_t(0x1D167), uint32_t(0x1D169), uint32_t(0x1D173), uint32_t(0x1D182), uint32_t(0x1D185), uint32_t(0x1D18B), uint32_t(0x1D1AA), uint32_t(0x1D1AD),
	uint32_t(0x1D242), uint32_t(0x1D244), uint32_t(0xE0001), uint32_t(0xE0001), uint32_t(0xE0020), uint32_t(0xE007F), uint32_t(0xE0100), uint32_t(0xE01EF),
	libc.Uint32FromInt32(-1),
} /* unicode.c:124:19 */
var range21 = [29]uint32_t{
	uint32_t(0x1100), uint32_t(0x115F), uint32_t(0x2329), uint32_t(0x2329), uint32_t(0x232A), uint32_t(0x232A), uint32_t(0x2E80), uint32_t(0x303E),
	uint32_t(0x3040), uint32_t(0xA4CF), uint32_t(0xAC00), uint32_t(0xD7A3), uint32_t(0xF900), uint32_t(0xFAFF), uint32_t(0xFE10), uint32_t(0xFE19),
	uint32_t(0xFE30), uint32_t(0xFE6F), uint32_t(0xFF00), uint32_t(0xFF60), uint32_t(0xFFE0), uint32_t(0xFFE6), uint32_t(0x1F000), uint32_t(0x1F644),
	uint32_t(0x20000), uint32_t(0x2FFFD), uint32_t(0x30000), uint32_t(0x3FFFD), libc.Uint32FromInt32(-1),
} /* unicode.c:167:19 */

// Returns the number of columns needed to display a given
// string in a fixed-width font.
func display_width(tls *libc.TLS, p uintptr, len int32) int32 { /* unicode.c:181:5: */
	bp := tls.Alloc(8)
	defer tls.Free(8)
	*(*uintptr)(unsafe.Pointer(bp)) = p

	var start uintptr = *(*uintptr)(unsafe.Pointer(bp /* p */))
	var w int32 = 0
	for (int64(*(*uintptr)(unsafe.Pointer(bp)))-int64(start))/1 < int64(len) {
		var c uint32_t = decode_utf8(tls, bp, *(*uintptr)(unsafe.Pointer(bp /* p */)))
		w = w + char_width(tls, c)
	}
	return w
}
