package erlcode_test

import (
	"bytes"
	"strings"
	"testing"

	erlcode "mochi/compile/erl"
	"mochi/parser"
)

func TestErlangCompiler_Print(t *testing.T) {
	prog, err := parser.ParseString("print(\"hello\")")
	if err != nil {
		t.Fatalf("parse error: %v", err)
	}
	c := erlcode.New(nil)
	code, err := c.Compile(prog)
	if err != nil {
		t.Fatalf("compile error: %v", err)
	}
	got := strings.TrimSpace(string(code))
	want := strings.TrimSpace(`%% Generated by Mochi Erlang compiler
-module(main).
-export([main/0]).

main() ->
    io:format("~p~n", ["hello"]),
    ok.`)
	if !bytes.Equal([]byte(got), []byte(want)) {
		t.Fatalf("unexpected output\n--- got ---\n%s\n--- want ---\n%s", got, want)
	}
}
